dmpJsonp(["hlsjs_stable"],{355:function(e,t,r){"use strict";function a(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function n(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function o(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function s(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function l(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function u(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function d(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function f(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function h(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function c(){this.attributes({resource:null,autoplay:!1,autoplayAllowed:!1,dependencies:null}),this.currentSource=null,this.decodeErrorCount=0,this.freezeErrorCount=0,this.decodeErrorDate=[null,null,null],this.pendingRecovery=!1,this._createHlsSource=function(e){null!==this.currentSource&&(this.currentSource.destroy(),this._unbindSourceEvents()),this.currentSource=J.createNew(this.videoTag,e,this.attr.dependencies.Hlsjs),this.currentSource.disableLevelCapping=B.a.isVR360Enabled(),this._bindSourceEvents()},this._bindSourceEvents=function(){if(!this.currentSource.disableLevelCapping){this.computeAutoLevelCapping=this.currentSource.computeAutoLevelCapping.bind(this.currentSource),this.on(y.a.PLAYER_SIZE_CHANGED,this.computeAutoLevelCapping);var e=B.a.window();"function"==typeof e.matchMedia&&(this.mediaQuery=e.matchMedia("screen and (min-resolution: 2dppx)"),this.mediaQuery&&this.mediaQuery.addListener(this.computeAutoLevelCapping))}this.currentSource.on("level_state_change",this._onSourceLevelStateChange,this),this.currentSource.on("level_state_changed",this._onSourceLevelStateChanged,this),this.currentSource.on("fatal_error",this._onSourceFatalError,this),this.currentSource.on(y.a.STREAM_TECH_CHANGE_REQUESTED,this._onSourceStreamTechChangeRequested,this),this.currentSource.on(y.a.STREAM_TECH_CHANGED,this._onSourceStreamTechChanged,this)},this._unbindSourceEvents=function(){this.currentSource.disableLevelCapping||(this.off(y.a.PLAYER_SIZE_CHANGED,this.computeAutoLevelCapping),this.mediaQuery&&(this.mediaQuery.removeListener(this.computeAutoLevelCapping),this.mediaQuery=null),this.computeAutoLevelCapping=null),this.currentSource.off("level_state_change",this._onSourceLevelStateChange),this.currentSource.off("level_state_changed",this._onSourceLevelStateChanged),this.currentSource.off("fatal_error",this._onSourceFatalError,this),this.currentSource.off(y.a.STREAM_TECH_CHANGE_REQUESTED,this._onSourceStreamTechChangeRequested,this),this.currentSource.off(y.a.STREAM_TECH_CHANGED,this._onSourceStreamTechChanged,this)},this._onSourceLevelStateChange=function(e){var t={adaptive:e.adaptive,quality:this.qualityList.getQualityForLevel(e.levelIndex)};this.notifyQualityChangeConfirmed(t)},this._onSourceLevelStateChanged=function(e){var t=this.currentSource.getLiveEdgeDelay();t>0&&this.liveEdgeDelay!==t&&(this.liveEdgeDelay=t,this.trigger(y.a.LIVE_EDGE_DELAY_CHANGED,{delay:this.liveEdgeDelay}));var r={adaptive:e.adaptive,quality:this.qualityList.getQualityForLevel(e.levelIndex)};this.decodeErrorDate=[null,null,null],this.notifyQualityChanged(r)},this._onSourceFatalError=function(e){this.videoSlotStarted&&this._handleError(e.error)},this._onSourceStreamTechChangeRequested=function(e){this.trigger(y.a.STREAM_TECH_CHANGE_REQUESTED,{streamTech:e.streamTech})},this._onSourceStreamTechChanged=function(e){this.trigger(y.a.STREAM_TECH_CHANGED,{streamTech:e.streamTech})},this.waitForQualityList=function(){var e=this,t=this.attr.resource||ie()(this.attr.qualities.auto,{type:ee.a.HLS}),r=$.Deferred();if(null!=t)this._createHlsSource(t),this.currentSource.waitForManifest().then(function(t){var a=te.a.createFromLevels(t.manifestData.levels,t.resource);if("videogames"===B.a.metadata("channel")&&"live"===B.a.metadata("stream_type")){var i=a.getHighestQuality();null!==i&&(i.tag="Source")}r.resolve(e.setQualityList(a))}).fail(function(e){return r.reject(e)});else{var a=new te.a;r.resolve(this.setQualityList(a))}return r.promise()},this.getStats=function(e,t){if(!this.currentSource)return{};var r={decodeError:this.decodeErrorCount,freezeError:this.freezeErrorCount},a=this.currentSource.streamComment();if(a&&(r.comment=a),this.videoTag)if("function"==typeof this.videoTag.getVideoPlaybackQuality){var i=this.videoTag.getVideoPlaybackQuality();r.droppedVideoFrames=i.droppedVideoFrames,r.corruptedVideoFrames=i.corruptedVideoFrames}else{var n=this.videoTag.webkitDroppedFrameCount;n&&(r.droppedVideoFrames=n)}var o=this.currentSource.streamStats(t);o&&(r.stream=o),this.trigger(y.a.QUALITY_STATS_RESPONDED,r)},this.changeQuality=function(e,t){var r=this,a=t.isStartup,i=t.isReplay,n=t.isRecovering,o=t.prefetch,s=null;s=n?"recover":i?"replay":a?"start":"current";var l=e.quality,u=this.qualityList.getLevelForQualityName(l.name),d={prefetch:o,heuristic:!1};a&&this.qualityChosenFromPlayerSize&&(d.heuristic=!0),this.pendingRecovery=n,this.currentSource.setLevel(u,e.adaptive,s,d).then(function(){a&&!o&&r.videoTag.play()})},this.handleFirstSequenceStarted=function(){this.off(y.a.SEQUENCE_STARTED,this.handleFirstSequenceStarted),this.setup()},this.handleInitialQualitySet=function(e){this.changeQuality(e,{isStartup:!0,isReplay:!1,isRecovering:!1,prefetch:!0})},this.handleLoadedmetadataEvent=function(){if(this.trigger(y.a.VIDEO_LOADED_METADATA,{videoTagSelector:this.attr.videoTagSelector}),this.pendingRecovery){this.pendingRecovery=!1;var e={adaptive:this.currentSource.hls.autoLevelEnabled,quality:this.qualityList.getQualityForLevel(this.currentSource.hls.loadLevel)};this.notifyQualityChangeConfirmed(e,!0),this.notifyQualityChanged(e)}},this.handleErrorEvent=function(e){var t=e.target.error||{},r=null;switch(t.code){case t.MEDIA_ERR_ABORTED:r=v.MEDIA_ERR_ABORTED;break;case t.MEDIA_ERR_NETWORK:r=v.MEDIA_ERR_NETWORK;break;case t.MEDIA_ERR_DECODE:r=v.MEDIA_ERR_DECODE;break;case t.MEDIA_ERR_SRC_NOT_SUPPORTED:r=v.MEDIA_ERR_SRC_NOT_SUPPORTED;break;default:r=v.PLAYER_ERR_UNKNOWN}this._handleError(r)},this._handleError=function(e){if(oe.warn("error received:",e),e===v.MEDIA_ERR_DECODE||"mediaErrorbufferAppendError"===e){var t=Date.now(),r=(this.decodeErrorCount+2)%3,a=this.decodeErrorDate[r];if(!a||t-a>3e3)return this.decodeErrorCount%2&&this.swapAudioCodec(),this.decodeErrorCount++,this.decodeErrorDate[r]=t,this.recoverDecodingError()}if("mediaErrorbufferStalledError"===e){var i=Date.now(),n=++this.freezeErrorCount,o=this.freezeErrorDate;if(this.freezeErrorDate=i,n<3&&(!o||i-o>1e4))return this.recoverDecodingError()}this.triggerQualitySwitcherError(e)},this.recoverDecodingError=function(){oe.log("try to recover video decoding error"),this.currentSource.recoverDecodingError()},this.swapAudioCodec=function(){oe.log("try to swap audio codec"),this.currentSource.swapAudioCodec()},this.streamCell=function(){return this.currentSource.streamCell()},this.streamTech=function(){return this.currentSource?this.currentSource.streamTech():L.a.HLS_JS},this.after("initialize",function(){oe.log("Initialized"),this.attr.autoplay&&this.attr.autoplayAllowed?this.handleFirstSequenceStarted():this.on(y.a.SEQUENCE_STARTED,this.handleFirstSequenceStarted),this.trigger(y.a.CAN_PLAY_ONE_SOURCE,{ok:!0}),this.on(y.a.VIDEO_ENDED,function(){this.currentSource.detachVideo()}),this.on(y.a.AD_WILL_START,function(e,t){var r=t.type,a=t.position;"linear"!==r||"midroll"!==a&&"adbreak"!==a||this.currentSource.detachVideo()}),this.on(y.a.CHROMECAST_REMOTE_ENABLED,function(){this.unbindMediaEvents(),this.currentSource.detachVideo()}),this.on(y.a.CHROMECAST_SESSION_STOPPED,function(){this.resetQualityState(),this.bindMediaEvents()}),this.on(y.a.LOAD_VIDEO,function(){this.teardown()})}),this.after("teardown",function(){oe.log("Torn down"),this.currentSource&&(this._unbindSourceEvents(),this.currentSource.destroy(),this.currentSource=null)})}Object.defineProperty(t,"__esModule",{value:!0});var v=r(14),g=r.n(v),p=r(24),y=r.n(p),m=r(402),E=r.n(m),b=r(136),_=r.n(b),R=function(){function e(e,t){for(var r=0;r<t.length;r++){var a=t[r];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}return function(t,r,a){return r&&e(t.prototype,r),a&&e(t,a),t}}(),S=function(){function e(t,r){a(this,e),this.meta=t||{},this.streamTech=r}return R(e,[{key:"load",value:function e(t){throw new ReferenceError("Failed to invoke P2PLoader.load(): method must be overridden")}},{key:"getMeta",value:function e(t){return this.meta.hasOwnProperty(t)?this.meta[t]:null}},{key:"getConfig",value:function e(){throw new ReferenceError("Failed to invoke P2PLoader.getConfig(): method must be overridden")}},{key:"getStats",value:function e(){throw new ReferenceError("Failed to invoke P2PLoader.getStats(): method must be overridden")}},{key:"setRunEnvContext",value:function e(t){this.runEnvContext=t}},{key:"getRunEnvContext",value:function e(){return this.runEnvContext}},{key:"destroy",value:function e(){this.meta=null,this.streamTech=null,this.runEnvContext=null}}]),e}(),T=S,L=r(345),A=r(339),k=function(){function e(e,t){for(var r=0;r<t.length;r++){var a=t[r];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}return function(t,r,a){return r&&e(t.prototype,r),a&&e(t,a),t}}(),D=function e(t,r,a){null===t&&(t=Function.prototype);var i=Object.getOwnPropertyDescriptor(t,r);if(void 0===i){var n=Object.getPrototypeOf(t);return null===n?void 0:e(n,r,a)}if("value"in i)return i.value;var o=i.get;if(void 0!==o)return o.call(a)},w=function(e){function t(e){return i(this,t),n(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,L.a.HLS_JS_P5))}return o(t,e),k(t,[{key:"load",value:function e(t){var r=this,a=this.getMeta("live"),i=a?A.default.loadPeer5Live:A.default.loadPeer5Vod;return i().done(function(e){r.peer5=e,r.peer5.isInitialized()||r.peer5.init();var t=r.getMeta("mobile"),a=!t;r.peer5.configure({upload:a}),r.setRunEnvContext({mobile:t,upload:a})})}},{key:"getConfig",value:function e(){var t=this.peer5;return t?{fLoader:t.HlsJsFragmentLoader,pLoader:t.HlsJsPlaylistLoader,maxMaxBufferLength:t.getConfig("MEDIA_MAXBUFFER"),maxBufferLength:t.getConfig("MEDIA_MAXBUFFER")}:{}}},{key:"getStats",value:function e(){var t=this.peer5;if(!t)return{};var r=t.getStats(),a=t.version;return{HTTPDL:r.totalHttpDownloaded,P2PDL:r.totalP2PDownloaded,P2PUL:r.totalP2PUploaded,Peers:r.numOfPeers,P2PVersion:a}}},{key:"destroy",value:function e(){D(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"destroy",this).call(this),this.peer5.destroy(),this.peer5=null}}]),t}(T),O=w,P=function(){function e(e,t){for(var r=0;r<t.length;r++){var a=t[r];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}return function(t,r,a){return r&&e(t.prototype,r),a&&e(t,a),t}}(),C=function e(t,r,a){null===t&&(t=Function.prototype);var i=Object.getOwnPropertyDescriptor(t,r);if(void 0===i){var n=Object.getPrototypeOf(t);return null===n?void 0:e(n,r,a)}if("value"in i)return i.value;var o=i.get;if(void 0!==o)return o.call(a)},M=function(e){function t(e){return s(this,t),l(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,L.a.HLS_JS_SR))}return u(t,e),P(t,[{key:"load",value:function e(t){var r=this;return A.default.loadStreamroot().done(function(e){var a=r.getMeta("mobile"),i={streamrootKey:"ry-zfftvewq",rangeRequestEnabled:r.getMeta("live"),contentId:r.getMeta("id"),mobileBrowserEnabled:a};r.streamroot=new e(i,t),r.streamroot.peerAgent.p2pUploadOn=!a,r.setRunEnvContext({mobile:a,upload:r.streamroot.peerAgent.p2pUploadOn})})}},{key:"getConfig",value:function e(){var t=this.streamroot;return t?{maxBufferSize:0}:{}}},{key:"getStats",value:function e(){var t=this.streamroot,r=t?t.peerAgent:null;if(!r)return{};var a=r.stats;return{HTTPDL:a.cdn,P2PDL:a.p2p,P2PUL:a.upload,Peers:a.peers,ABMarker:a.confLabel,P2PVersion:t.version}}},{key:"destroy",value:function e(){C(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"destroy",this).call(this),this.streamroot=null}}]),t}(T),x=M,I=r(153),F=r.n(I),N=r(13),U=r(1),B=r.n(U),G=r(64),j=r.n(G),H=r(434),V=r.n(H),W=r(372),K=function(){function e(e,t){var r=[],a=!0,i=!1,n=void 0;try{for(var o=e[Symbol.iterator](),s;!(a=(s=o.next()).done)&&(r.push(s.value),!t||r.length!==t);a=!0);}catch(e){i=!0,n=e}finally{try{!a&&o.return&&o.return()}finally{if(i)throw n}}return r}return function(t,r){if(Array.isArray(t))return t;if(Symbol.iterator in Object(t))return e(t,r);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),z=function(){function e(e,t){for(var r=0;r<t.length;r++){var a=t[r];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}return function(t,r,a){return r&&e(t.prototype,r),a&&e(t,a),t}}(),q=N.default.get("Hls"),Y={START:"start",CURRENT:"current",REPLAY:"replay",RECOVER:"recover"},X=null,Q=function(e){function t(e,r,a){d(this,t);var i=f(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return X=a,i.hlsVersion=X.version||"stable",i.videoTag=e,i.resource=r,i.boundListeners=null,i.hls=null,i.manifestData=null,i.hashParams=null,i.mseAttached=!1,i.disableLevelCapping=!1,i.startLoad=!1,i.cumDownload=0,i.cumLatency=0,i.cumMux=0,i.cumBuffer=0,i.fragNb=0,i.fragDetailsNb=0,i.logArray=[],i.logMsg=null,i.resetStats(),i.logForwarder={log:function(e){this.appendMsg("log",e)}.bind(i),warn:function(e){this.appendMsg("warn",e)}.bind(i),error:function(e){this.appendMsg("error",e)}.bind(i)},i.hlsConfig={abrBandWidthFactor:.95,abrBandWidthUpFactor:.7,autoStartLoad:!1,debug:i.logForwarder,fragLoadingMaxRetry:2,fragLoadingTimeOut:2e4,highBufferWatchdogPeriod:4,levelLoadingMaxRetry:2,levelLoadingTimeOut:15e3,liveSyncDuration:24,manifestLoadingMaxRetry:2,manifestLoadingTimeOut:3e4,maxLoadingDelay:4,maxMaxBufferLength:30,maxStarvationDelay:4,maxSeekHole:4,nudgeMaxRetry:2,nudgeOffset:.3,startFragPrefetch:"recorded"===B.a.metadata("stream_type")},i}return h(t,e),z(t,null,[{key:"createNew",value:function e(r,a,i){return new t(r,a,i)}}]),z(t,[{key:"appendMsg",value:function e(t,r){if(r){if(!this.logMsg){var a=this.logArray,i=this.stats.maxLogs||100,n=performance.now(),o=this.t0=this.t0||n,s=Math.round(n-o);a.length>=i&&a.shift(),a.push(s+","+t+": "+r)}q[t](r)}}},{key:"createNewP2PLoader",value:function e(){var t=this.getHashParam("p2p");if(!this.p2pLoader&&t){var r={id:B.a.metadata("id"),live:"live"===B.a.metadata("stream_type"),mobile:j.a.isMobile()};switch(t){case"p5":return new O(r);case"sr":return new x(r)}}return null}},{key:"waitForP2PLoader",value:function e(){var t=this;if(!this.p2pDeferred){this.p2pDeferred=$.Deferred();var r=this.createNewP2PLoader();r?(this.trigger(y.a.STREAM_TECH_CHANGE_REQUESTED,{streamTech:L.a.getAsPending(r.streamTech)}),r.load(this.hls).done(function(){var e=r.getRunEnvContext(),a=e.mobile,i=e.upload;q.log("Succeed to load the "+r.streamTech+" loader (mobile: "+a+", upload: "+i+")"),t.p2pLoader=r,t.updateHLSConfigParams(t.p2pLoader.getConfig()),t.trigger(y.a.STREAM_TECH_CHANGED,{streamTech:t.p2pLoader.streamTech})}).fail(function(){q.warn("Fail to load the "+r.streamTech+" loader, fallback on the built-in one"),t.p2pDeferred=null}).always(function(){t.p2pDeferred.resolve(t)})):this.p2pDeferred.resolve(this)}return this.p2pDeferred.promise()}},{key:"waitForManifest",value:function e(){var t=this,r=$.Deferred();return this.waitForURLResolver().done(function(){if(t.hls||(q.log("create hls.js ("+t.hlsVersion+")"),t.hls=new X(t.hlsConfig),t.bindListeners()),t.manifestData)r.resolve(t);else{var e=function e(i,n){n.fatal&&(q.error("catch fatal error at startup",n),t.hls.off(X.Events.ERROR,e),t.hls.off(X.Events.MANIFEST_PARSED,a),r.reject(n))},a=function a(i,n){q.log("succeed to parse manifest",n),t.hls.off(X.Events.ERROR,e),t.hls.off(X.Events.MANIFEST_PARSED,a),t.manifestData=n;var o=n.levels[n.firstLevel];t.parseHashParams(o.url[o.urlId]),r.resolve(t)};t.hls.on(X.Events.ERROR,e),t.hls.on(X.Events.MANIFEST_PARSED,a),t.hls.loadSource(t.manifestURL)}}).fail(function(){r.reject(),t.trigger("fatal_error",{error:v.PLAYER_ERR_CDN_RESOLVER_FAILED})}),r.promise()}},{key:"waitForURLResolver",value:function e(){var t=this,r=$.Deferred();return this.manifestData?r.resolve(this):Object(W.a)(this.resource.url,this.resource.type).then(function(e){t.manifestURL=e,t.parseHashParams(t.manifestURL),r.resolve(t)}).fail(function(){r.reject()}),r.promise()}},{key:"attachVideo",value:function e(){this.mseAttached||(q.log("Attach video to hls source"),this.hls.attachMedia(this.videoTag),this.mseAttached=!0,this.tvideo=performance.now())}},{key:"setLevel",value:function e(t,r,a){var i=this,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},o=n.prefetch,s=void 0!==o&&o,l=n.heuristic,u=void 0!==l&&l;s||this.attachVideo();var d=$.when(this.waitForManifest());return d.then(function(){var e=i.hls,n=!s,o=!1;a===Y.START?(r?(u&&(t=-1),q.log("set hls.startLevel="+t),e.startLevel=t,i.stats.startLevel=t):(q.log("set hls.loadLevel="+t),e.loadLevel=t),i.startLoad||(q.log("call hls.startLoad()"),e.startLoad(),i.computeAutoLevelCapping(),i.startLoad=!0)):a===Y.CURRENT?r?(q.log("set hls.nextLevel=-1"),e.nextLevel=-1,o=!0):e.autoLevelEnabled&&e.currentLevel===t||j.a.isIE()?(q.log("set hls.nextLevel="+t),e.nextLevel=t,o=!0):(q.log("set hls.currentLevel="+t),e.currentLevel=t):(e.startLoad(a===Y.REPLAY?0:-1),n=!1),n&&i.notifyLevelStateChange(i.hls.autoLevelEnabled,t),o&&i.notifyLevelStateChanged(i.hls.autoLevelEnabled,t)})}},{key:"getMaxLevelIndex",value:function e(){var t=Math.max(160,this.videoTag.clientWidth)*Math.max(120,this.videoTag.clientHeight),r=window.devicePixelRatio;null!=r&&(t*=r*r);var a=this.hls.levels||[],i=a.length;if(0===i)return-1;var n=0;for(n;n<i;n++){var o=a[n],s=o.width*o.height;if(s>=.85*t)break}var l=Math.min(n,i-1);return l}},{key:"notifyLevelStateChange",value:function e(t,r){this.trigger("level_state_change",{adaptive:t,levelIndex:r})}},{key:"notifyLevelStateChanged",value:function e(t,r){this.trigger("level_state_changed",{adaptive:t,levelIndex:r})}},{key:"computeAutoLevelCapping",value:function e(){if(this.hls&&this.videoTag&&!this.disableLevelCapping){var t=this.getMaxLevelIndex(),r=this.hls.autoLevelCapping;t!==r&&(q.log("new capping index:"+t),this.hls.autoLevelCapping=t,this.hls.autoLevelEnabled&&r>=0&&t>r&&(q.log("smooth switch up"),this.hls.nextLevel=-1))}}},{key:"detachVideo",value:function e(t,r){q.log("Detach video from hls source");var a=this.hls;a&&null!==a.media&&a.detachMedia(),this.tvideo=void 0,this.mseAttached=!1}},{key:"onHlsError",value:function e(t,r){switch(r.details){case X.ErrorDetails.BUFFER_NUDGE_ON_STALL:var a=this.stats;a.nudgeNb=(a.nudgeNb||0)+1;break;case X.ErrorDetails.BUFFER_SEEK_OVER_HOLE:this.stats.maxBufferHole=this.stats.maxBufferHole>0?Math.max(this.stats.maxBufferHole,r.hole):r.hole;break;case X.ErrorDetails.INTERNAL_EXCEPTION:this.stats.exceptionNb++,this.stats.exception={event:r.event,stack:r.err.stack?JSON.stringify(r.err.stack).substr(0,1e3):r.err.message}}if(r.fatal){q.error("Received fatal HLS error:",t,r);var i=this.getHTTPStats(r);null!==i&&(this.stats.http=i),this.trigger("fatal_error",{error:r.type+r.details})}else q.warn("Received non-fatal HLS error:",t,r)}},{key:"getHTTPStats",value:function e(t){if(!t||!t.response)return null;var r={},a=t.response,i=t.frag||t.context;return a&&(r.code=parseInt(a.code||0),r.msg=(a.text||"").toLowerCase()),i&&(r.url=i.url||""),r}},{key:"onLevelLoaded",value:function e(t,r){var a=this.hls.config,i=this.hls.levels[r.level];i.details.live&&(this._liveEdgeDelay=a.liveSyncDuration>0?a.liveSyncDuration:a.liveSyncDurationCount*r.details.targetduration),i.urlId>0&&(this.stats.redundant=!0)}},{key:"onCurrentFragmentChanged",value:function e(t,r){this.notifyLevelStateChanged(this.hls.autoLevelEnabled,r.frag.level)}},{key:"onFragBuffered",value:function e(t,r){var a=this.stats,i=r.stats,n=i.tparsed,o=this.tvideo,s=o?Math.max(n,o):n,l=i.tload-i.trequest,u=i.tfirst-i.trequest,d=n-i.tload,f=i.tbuffered-s,h=l+d+f,c=a.minMs=a.minMs||{},v=a.maxMs=a.maxMs||{},g=this.cumDownload+=l,p=this.cumLatency+=u,y=this.cumMux+=d,m=this.cumBuffer+=f,E=g+y+m,b=++this.fragNb;a.HTTPDL+=i.loaded;var _=8*a.HTTPDL;this.appendFragDetails(r.frag,i),a.latency=Math.round(p/b),a.avgKbps={total:Math.round(_/E),dl:Math.round(_/g),mux:Math.round(_/y),buffer:Math.round(_/m)},a.avgMs={total:Math.round(E/b),dl:Math.round(g/b),mux:Math.round(y/b),buffer:Math.round(m/b)},h&&(c.total=Math.round(c.total?Math.min(c.total,h):h),v.total=Math.round(v.total?Math.max(v.total,h):h)),l&&(c.dl=Math.round(c.dl?Math.min(c.dl,l):l),v.dl=Math.round(v.dl?Math.max(v.dl,l):l)),d&&(c.mux=Math.round(c.mux?Math.min(c.mux,d):d),v.mux=Math.round(v.mux?Math.max(v.mux,d):d)),f&&(c.buffer=Math.round(c.buffer?Math.min(c.buffer,f):f),v.buffer=Math.round(v.buffer?Math.max(v.buffer,f):f)),3===this.fragNb&&this.waitForP2PLoader()}},{key:"onFragLoadEmergencyAborted",value:function e(t,r){this.appendFragDetails(r.frag,r.stats),this.stats.emergencyNb++}},{key:"appendFragDetails",value:function e(t,r){if(this.fragDetailsNb<5){var a=this.videoTag,i=r.tparsed,n=this.tvideo,o=n?Math.max(i,n):i,s=r.tload-r.trequest,l=r.tfirst-r.trequest,u=r.loaded,d=i-r.tload,f=r.tbuffered-o,h=t.duration,c={start:Math.round(1e3*t.start),end:Math.round(1e3*(t.start+h)),l:t.level,pos:a?Math.round(1e3*a.currentTime):-1};l>0&&(c.lat=Math.round(l)),s>0&&(c.DLdur=Math.round(s)),u>0&&(c.len=u),u>0&&(c.kbps=Math.round(8*u/(s+d+f))),r.aborted&&(c.aborted=!0),d>0&&(c.mux=Math.round(d)),f>0&&(c.buffer=Math.round(f));var v=this.stats,g=v.frags=v.frags||{},p=g.minDuration;g.minDuration=p?Math.min(Math.round(h),p):Math.round(h),g["f"+this.fragDetailsNb]=c,this.fragDetailsNb++}}},{key:"recoverDecodingError",value:function e(){var t=this,r=!this.videoTag.paused;q.log("playing state before recovery:",r);var a=function e(a,i){t.hls.off(X.Events.MEDIA_ATTACHED,e),t.hls.startLoad(),r&&(q.log("video was playing before recovery, relaunch playback"),t.videoTag.play())};this.hls.recoverMediaError(),this.hls.on(X.Events.MEDIA_ATTACHED,a)}},{key:"swapAudioCodec",value:function e(){this.hls.swapAudioCodec()}},{key:"bindListeners",value:function e(){null==this.boundListeners&&(this.boundListeners={onCurrentFragmentChanged:this.onCurrentFragmentChanged.bind(this),onFragBuffered:this.onFragBuffered.bind(this),onFragLoadEmergencyAborted:this.onFragLoadEmergencyAborted.bind(this),onHlsError:this.onHlsError.bind(this),onLevelLoaded:this.onLevelLoaded.bind(this)},this.hls.on(X.Events.FRAG_CHANGED,this.boundListeners.onCurrentFragmentChanged),this.hls.on(X.Events.FRAG_BUFFERED,this.boundListeners.onFragBuffered),this.hls.on(X.Events.FRAG_LOAD_EMERGENCY_ABORTED,this.boundListeners.onFragLoadEmergencyAborted),this.hls.on(X.Events.ERROR,this.boundListeners.onHlsError),this.hls.on(X.Events.LEVEL_LOADED,this.boundListeners.onLevelLoaded))}},{key:"unbindListeners",value:function e(){null!=this.boundListeners&&(this.hls.off(X.Events.FRAG_CHANGED,this.boundListeners.onCurrentFragmentChanged),this.hls.off(X.Events.FRAG_BUFFERED,this.boundListeners.onFragBuffered),this.hls.off(X.Events.FRAG_LOAD_EMERGENCY_ABORTED,this.boundListeners.onFragLoadEmergencyAborted),this.hls.off(X.Events.ERROR,this.boundListeners.onHlsError),this.hls.off(X.Events.LEVEL_LOADED,this.boundListeners.onLevelLoaded),this.boundListeners=null)}},{key:"streamCell",value:function e(){return this.getHashParam("cell")}},{key:"streamComment",value:function e(){return this.getHashParam("comment")}},{key:"getHashParam",value:function e(t){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,a=this.hashParams;if(a){var i=null!==r&&a[r]?a[r]:a;return i[t]?i[t]:null}return null}},{key:"parseHashParams",value:function e(t){if(!this.hashParams){var r=b.Location.parse(t),a=r.hash,i=void 0===a?null:a;if(i){var n=this.hashParams={},o=this.onHashParamParsed.bind(this),s=b.Location.parseQueryString(i,!0);for(var l in s){var u=l.split("_"),d=K(u,2),f=d[0],h=d[1],c=void 0===h?null:h;null===c?(n[l]=s[l],o(l,s[l])):(n[f]||(n[f]={}),n[f][c]=s[l],o(c,s[l],f))}q.log("Parsed hash-params:",n)}}}},{key:"onHashParamParsed",value:function e(t,r){var a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;switch(a){case"hls":this.updateHLSConfigParam(t,r,!0);break;case"ab":case"qos":this.stats[t]=r}}},{key:"updateHLSConfigParams",value:function e(t){var r=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(t)for(var a in t){var i=t[a];this.updateHLSConfigParam(a,i,r)}}},{key:"updateHLSConfigParam",value:function e(t,r){var a=arguments.length>2&&void 0!==arguments[2]&&arguments[2];"function"==typeof r?q.log("update hlsjs config param: "+t+"=function(){}"):q.log("update hlsjs config param: "+t+"="+r);var i=this.hls?this.hls.config:this.hlsConfig;isNaN(r)||"boolean"==typeof r||(r=parseFloat(r)),i[t]=r,a&&(this.stats[t]=r)}},{key:"streamStats",value:function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r=t.verbose||!1;if(this.p2pLoader)try{return F()({},this.stats,this.p2pLoader.getStats())}catch(e){}return r&&(this.logMsg||(this.logMsg=V.a.compressToBase64(this.logArray.join("\n")),this.logArray=[]),this.stats.logs=this.logMsg),this.stats}},{key:"streamTech",value:function e(){return this.p2pLoader?this.p2pLoader.streamTech:"hls.js"}},{key:"getLiveEdgeDelay",value:function e(){return this._liveEdgeDelay||0}},{key:"resetStats",value:function e(){this.stats={version:this.hlsVersion,HTTPDL:0,emergencyNb:0,exceptionNb:0,latency:0}}},{key:"destroy",value:function e(){q.log("Destroy hls source"),this.resetStats(),this.detachVideo(),this.unbindListeners();var t=this.hls;t&&(t.destroy(),this.hls=null);var r=this.p2pLoader;r&&(q.log("Destroy the "+r.streamTech+" loader"),r.destroy(),this.p2pLoader=null),X=null,this.hlsVersion=null,this.manifestData=null,this.p2pDeferred=null,this.hashParams=null,this.hlsConfig=null,this.startLoad=!1}}]),t}(m.Events),J=Q,Z=r(65),ee=r.n(Z),te=r(373),re=r(315),ae=r(40),ie=r.n(ae),ne=r(403),oe=N.default.get("DynamicQuality"),se=t.default=Object(re.component)(ne.a,c)},415:function(e,t){!function(r){if("object"==typeof t&&void 0!==e)e.exports=r();else if("function"==typeof define&&define.amd)define([],r);else{var a;a="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this,a.Hls=r()}}(function(){var e,t,r;return function e(t,r,a){function i(o,s){if(!r[o]){if(!t[o]){var l="function"==typeof require&&require;if(!s&&l)return l(o,!0);if(n)return n(o,!0);var u=new Error("Cannot find module '"+o+"'");throw u.code="MODULE_NOT_FOUND",u}var d=r[o]={exports:{}};t[o][0].call(d.exports,function(e){var r=t[o][1][e];return i(r||e)},d,d.exports,e,t,r,a)}return r[o].exports}for(var n="function"==typeof require&&require,o=0;o<a.length;o++)i(a[o]);return i}({1:[function(e,t,r){function a(){this._events=this._events||{},this._maxListeners=this._maxListeners||void 0}function i(e){return"function"==typeof e}function n(e){return"number"==typeof e}function o(e){return"object"==typeof e&&null!==e}function s(e){return void 0===e}t.exports=a,a.EventEmitter=a,a.prototype._events=void 0,a.prototype._maxListeners=void 0,a.defaultMaxListeners=10,a.prototype.setMaxListeners=function(e){if(!n(e)||e<0||isNaN(e))throw TypeError("n must be a positive number");return this._maxListeners=e,this},a.prototype.emit=function(e){var t,r,a,n,l,u;if(this._events||(this._events={}),"error"===e&&(!this._events.error||o(this._events.error)&&!this._events.error.length)){if((t=arguments[1])instanceof Error)throw t;var d=new Error('Uncaught, unspecified "error" event. ('+t+")");throw d.context=t,d}if(r=this._events[e],s(r))return!1;if(i(r))switch(arguments.length){case 1:r.call(this);break;case 2:r.call(this,arguments[1]);break;case 3:r.call(this,arguments[1],arguments[2]);break;default:n=Array.prototype.slice.call(arguments,1),r.apply(this,n)}else if(o(r))for(n=Array.prototype.slice.call(arguments,1),u=r.slice(),a=u.length,l=0;l<a;l++)u[l].apply(this,n);return!0},a.prototype.addListener=function(e,t){var r;if(!i(t))throw TypeError("listener must be a function");return this._events||(this._events={}),this._events.newListener&&this.emit("newListener",e,i(t.listener)?t.listener:t),this._events[e]?o(this._events[e])?this._events[e].push(t):this._events[e]=[this._events[e],t]:this._events[e]=t,o(this._events[e])&&!this._events[e].warned&&(r=s(this._maxListeners)?a.defaultMaxListeners:this._maxListeners)&&r>0&&this._events[e].length>r&&(this._events[e].warned=!0,console.error("(node) warning: possible EventEmitter memory leak detected. %d listeners added. Use emitter.setMaxListeners() to increase limit.",this._events[e].length),"function"==typeof console.trace&&console.trace()),this},a.prototype.on=a.prototype.addListener,a.prototype.once=function(e,t){function r(){this.removeListener(e,r),a||(a=!0,t.apply(this,arguments))}if(!i(t))throw TypeError("listener must be a function");var a=!1;return r.listener=t,this.on(e,r),this},a.prototype.removeListener=function(e,t){var r,a,n,s;if(!i(t))throw TypeError("listener must be a function");if(!this._events||!this._events[e])return this;if(r=this._events[e],n=r.length,a=-1,r===t||i(r.listener)&&r.listener===t)delete this._events[e],this._events.removeListener&&this.emit("removeListener",e,t);else if(o(r)){for(s=n;s-- >0;)if(r[s]===t||r[s].listener&&r[s].listener===t){a=s;break}if(a<0)return this;1===r.length?(r.length=0,delete this._events[e]):r.splice(a,1),this._events.removeListener&&this.emit("removeListener",e,t)}return this},a.prototype.removeAllListeners=function(e){var t,r;if(!this._events)return this;if(!this._events.removeListener)return 0===arguments.length?this._events={}:this._events[e]&&delete this._events[e],this;if(0===arguments.length){for(t in this._events)"removeListener"!==t&&this.removeAllListeners(t);return this.removeAllListeners("removeListener"),this._events={},this}if(r=this._events[e],i(r))this.removeListener(e,r);else if(r)for(;r.length;)this.removeListener(e,r[r.length-1]);return delete this._events[e],this},a.prototype.listeners=function(e){var t;return t=this._events&&this._events[e]?i(this._events[e])?[this._events[e]]:this._events[e].slice():[]},a.prototype.listenerCount=function(e){if(this._events){var t=this._events[e];if(i(t))return 1;if(t)return t.length}return 0},a.listenerCount=function(e,t){return e.listenerCount(t)}},{}],2:[function(t,r,a){!function(t){var i=/^((?:[^\/;?#]+:)?)(\/\/[^\/\;?#]*)?(.*?)??(;.*?)?(\?.*?)?(#.*?)?$/,n=/^([^\/;?#]*)(.*)$/,o=/(?:\/|^)\.(?=\/)/g,s=/(?:\/|^)\.\.\/(?!\.\.\/).*?(?=\/)/g,l={buildAbsoluteURL:function(e,t,r){if(r=r||{},e=e.trim(),!(t=t.trim())){if(!r.alwaysNormalize)return e;var a=this.parseURL(e);if(!o)throw new Error("Error trying to parse base URL.");return a.path=l.normalizePath(a.path),l.buildURLFromParts(a)}var i=this.parseURL(t);if(!i)throw new Error("Error trying to parse relative URL.");if(i.scheme)return r.alwaysNormalize?(i.path=l.normalizePath(i.path),l.buildURLFromParts(i)):t;var o=this.parseURL(e);if(!o)throw new Error("Error trying to parse base URL.");if(!o.netLoc&&o.path&&"/"!==o.path[0]){var s=n.exec(o.path);o.netLoc=s[1],o.path=s[2]}o.netLoc&&!o.path&&(o.path="/");var u={scheme:o.scheme,netLoc:i.netLoc,path:null,params:i.params,query:i.query,fragment:i.fragment};if(!i.netLoc&&(u.netLoc=o.netLoc,"/"!==i.path[0]))if(i.path){var d=o.path,f=d.substring(0,d.lastIndexOf("/")+1)+i.path;u.path=l.normalizePath(f)}else u.path=o.path,i.params||(u.params=o.params,i.query||(u.query=o.query));return null===u.path&&(u.path=r.alwaysNormalize?l.normalizePath(i.path):i.path),l.buildURLFromParts(u)},parseURL:function(e){var t=i.exec(e);return t?{scheme:t[1]||"",netLoc:t[2]||"",path:t[3]||"",params:t[4]||"",query:t[5]||"",fragment:t[6]||""}:null},normalizePath:function(e){for(e=e.split("").reverse().join("").replace(o,"");e.length!==(e=e.replace(s,"")).length;);return e.split("").reverse().join("")},buildURLFromParts:function(e){return e.scheme+e.netLoc+e.path+e.params+e.query+e.fragment}};"object"==typeof a&&"object"==typeof r?r.exports=l:"function"==typeof e&&e.amd?e([],function(){return l}):"object"==typeof a?a.URLToolkit=l:t.URLToolkit=l}(this)},{}],3:[function(e,t,r){var a=arguments[3],i=arguments[4],n=arguments[5],o=JSON.stringify;t.exports=function(e,t){function r(e){p[e]=!0;for(var t in i[e][1]){var a=i[e][1][t];p[a]||r(a)}}for(var s,l=Object.keys(n),u=0,d=l.length;u<d;u++){var f=l[u],h=n[f].exports;if(h===e||h&&h.default===e){s=f;break}}if(!s){s=Math.floor(Math.pow(16,8)*Math.random()).toString(16);for(var c={},u=0,d=l.length;u<d;u++){var f=l[u];c[f]=f}i[s]=[Function(["require","module","exports"],"("+e+")(self)"),c]}var v=Math.floor(Math.pow(16,8)*Math.random()).toString(16),g={};g[s]=s,i[v]=[Function(["require"],"var f = require("+o(s)+");(f.default ? f.default : f)(self);"),g];var p={};r(v);var y="("+a+")({"+Object.keys(p).map(function(e){return o(e)+":["+i[e][0]+","+o(i[e][1])+"]"}).join(",")+"},{},["+o(v)+"])",m=window.URL||window.webkitURL||window.mozURL||window.msURL,E=new Blob([y],{type:"text/javascript"});if(t&&t.bare)return E;var b=m.createObjectURL(E),_=new Worker(b);return _.objectURL=b,_}},{}],4:[function(e,t,r){"use strict";function a(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(r,"__esModule",{value:!0}),r.hlsDefaultConfig=void 0;var i=e(5),n=a(i),o=e(6),s=a(o),l=e(7),u=a(l),d=e(8),f=a(d),h=e(48),c=a(h),v=r.hlsDefaultConfig={autoStartLoad:!0,startPosition:-1,defaultAudioCodec:void 0,debug:!1,capLevelOnFPSDrop:!1,capLevelToPlayerSize:!1,initialLiveManifestSize:1,maxBufferLength:30,maxBufferSize:6e7,maxBufferHole:.5,maxSeekHole:2,lowBufferWatchdogPeriod:.5,highBufferWatchdogPeriod:3,nudgeOffset:.1,nudgeMaxRetry:3,maxFragLookUpTolerance:.25,liveSyncDurationCount:3,liveMaxLatencyDurationCount:1/0,liveSyncDuration:void 0,liveMaxLatencyDuration:void 0,maxMaxBufferLength:600,enableWorker:!0,enableSoftwareAES:!0,manifestLoadingTimeOut:1e4,manifestLoadingMaxRetry:1,manifestLoadingRetryDelay:1e3,manifestLoadingMaxRetryTimeout:64e3,startLevel:void 0,levelLoadingTimeOut:1e4,levelLoadingMaxRetry:4,levelLoadingRetryDelay:1e3,levelLoadingMaxRetryTimeout:64e3,fragLoadingTimeOut:2e4,fragLoadingMaxRetry:6,fragLoadingRetryDelay:1e3,fragLoadingMaxRetryTimeout:64e3,fragLoadingLoopThreshold:3,startFragPrefetch:!1,fpsDroppedMonitoringPeriod:5e3,fpsDroppedMonitoringThreshold:.2,appendErrorMaxRetry:3,loader:c.default,fLoader:void 0,pLoader:void 0,xhrSetup:void 0,fetchSetup:void 0,abrController:n.default,bufferController:s.default,capLevelController:u.default,fpsController:f.default,stretchShortVideoTrack:!1,forceKeyFrameOnDiscontinuity:!0,abrEwmaFastLive:3,abrEwmaSlowLive:9,abrEwmaFastVoD:3,abrEwmaSlowVoD:9,abrEwmaDefaultEstimate:5e5,abrBandWidthFactor:.95,abrBandWidthUpFactor:.7,abrMaxWithRealBitrate:!1,maxStarvationDelay:4,maxLoadingDelay:4,minAutoBitrate:0}},{48:48,5:5,6:6,7:7,8:8}],5:[function(e,t,r){"use strict";function a(e){return e&&e.__esModule?e:{default:e}}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function n(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function o(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(r,"__esModule",{value:!0});var s=function(){function e(e,t){for(var r=0;r<t.length;r++){var a=t[r];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}return function(t,r,a){return r&&e(t.prototype,r),a&&e(t,a),t}}(),l=e(30),u=a(l),d=e(29),f=a(d),h=e(32),c=a(h),v=e(28),g=e(46),p=e(44),y=a(p),m=function(e){function t(e){i(this,t);var r=n(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,u.default.FRAG_LOADING,u.default.FRAG_LOADED,u.default.FRAG_BUFFERED,u.default.ERROR));return r.lastLoadedFragLevel=0,r._nextAutoLevel=-1,r.hls=e,r.onCheck=r._abandonRulesCheck.bind(r),r}return o(t,e),s(t,[{key:"destroy",value:function e(){this.clearTimer(),f.default.prototype.destroy.call(this)}},{key:"onFragLoading",value:function e(t){var r=t.frag;if("main"===r.type){if(this.timer||(this.timer=setInterval(this.onCheck,100)),!this._bwEstimator){var a=this.hls,i=t.frag.level,n=a.levels[i].details.live,o=a.config,s=void 0,l=void 0;n?(s=o.abrEwmaFastLive,l=o.abrEwmaSlowLive):(s=o.abrEwmaFastVoD,l=o.abrEwmaSlowVoD),this._bwEstimator=new y.default(a,l,s,o.abrEwmaDefaultEstimate)}this.fragCurrent=r}}},{key:"_abandonRulesCheck",value:function e(){var t=this.hls,r=t.media,a=this.fragCurrent,i=a.loader,n=t.minAutoLevel;if(!i||i.stats&&i.stats.aborted)return g.logger.warn("frag loader destroy or aborted, disarm abandonRules"),void this.clearTimer();var o=i.stats;if(r&&(!r.paused&&0!==r.playbackRate||!r.readyState)&&a.autoLevel&&a.level){var s=performance.now()-o.trequest,l=Math.abs(r.playbackRate);if(s>500*a.duration/l){var d=t.levels,f=Math.max(1,o.bw?o.bw/8:1e3*o.loaded/s),h=d[a.level],v=h.realBitrate?Math.max(h.realBitrate,h.bitrate):h.bitrate,p=o.total?o.total:Math.max(o.loaded,Math.round(a.duration*v/8)),y=r.currentTime,m=(p-o.loaded)/f,E=(c.default.bufferInfo(r,y,t.config.maxBufferHole).end-y)/l;if(E<2*a.duration/l&&m>E){var b=void 0,_=void 0;for(_=a.level-1;_>n;_--){var R=d[_].realBitrate?Math.max(d[_].realBitrate,d[_].bitrate):d[_].bitrate;if((b=a.duration*R/(6.4*f))<E)break}b<m&&(g.logger.warn("loading too slow, abort fragment loading and switch to level "+_+":fragLoadedDelay["+_+"]<fragLoadedDelay["+(a.level-1)+"];bufferStarvationDelay:"+b.toFixed(1)+"<"+m.toFixed(1)+":"+E.toFixed(1)),t.nextLoadLevel=_,this._bwEstimator.sample(s,o.loaded),i.abort(),this.clearTimer(),t.trigger(u.default.FRAG_LOAD_EMERGENCY_ABORTED,{frag:a,stats:o}))}}}}},{key:"onFragLoaded",value:function e(t){var r=t.frag;if("main"===r.type&&!isNaN(r.sn)){if(this.clearTimer(),this.lastLoadedFragLevel=r.level,this._nextAutoLevel=-1,this.hls.config.abrMaxWithRealBitrate){var a=this.hls.levels[r.level],i=(a.loaded?a.loaded.bytes:0)+t.stats.loaded,n=(a.loaded?a.loaded.duration:0)+t.frag.duration;a.loaded={bytes:i,duration:n},a.realBitrate=Math.round(8*i/n)}if(t.frag.bitrateTest){var o=t.stats;o.tparsed=o.tbuffered=o.tload,this.onFragBuffered(t)}}}},{key:"onFragBuffered",value:function e(t){var r=t.stats,a=t.frag;if(!(!0===r.aborted||1!==a.loadCounter||"main"!==a.type||isNaN(a.sn)||a.bitrateTest&&r.tload!==r.tbuffered)){var i=r.tparsed-r.trequest;g.logger.log("latency/loading/parsing/append/kbps:"+Math.round(r.tfirst-r.trequest)+"/"+Math.round(r.tload-r.tfirst)+"/"+Math.round(r.tparsed-r.tload)+"/"+Math.round(r.tbuffered-r.tparsed)+"/"+Math.round(8*r.loaded/(r.tbuffered-r.trequest))),this._bwEstimator.sample(i,r.loaded),r.bwEstimate=this._bwEstimator.getEstimate(),a.bitrateTest?this.bitrateTestDelay=i/1e3:this.bitrateTestDelay=0}}},{key:"onError",value:function e(t){switch(t.details){case v.ErrorDetails.FRAG_LOAD_ERROR:case v.ErrorDetails.FRAG_LOAD_TIMEOUT:this.clearTimer()}}},{key:"clearTimer",value:function e(){this.timer&&(clearInterval(this.timer),this.timer=null)}},{key:"_findBestLevel",value:function e(t,r,a,i,n,o,s,l,u){for(var d=n;d>=i;d--){var f=u[d],h=f.details,c=h?h.totalduration/h.fragments.length:r,v=!!h&&h.live,p=void 0;p=d<=t?s*a:l*a;var y=u[d].realBitrate?Math.max(u[d].realBitrate,u[d].bitrate):u[d].bitrate,m=y*c/p;if(g.logger.trace("level/adjustedbw/bitrate/avgDuration/maxFetchDuration/fetchDuration: "+d+"/"+Math.round(p)+"/"+y+"/"+c+"/"+o+"/"+m),p>y&&(!m||v&&!this.bitrateTestDelay||m<o))return d}return-1}},{key:"nextAutoLevel",get:function e(){var t=this._nextAutoLevel,r=this._bwEstimator;if(!(-1===t||r&&r.canEstimate()))return t;var a=this._nextABRAutoLevel;return-1!==t&&(a=Math.min(t,a)),a},set:function e(t){this._nextAutoLevel=t}},{key:"_nextABRAutoLevel",get:function e(){var t=this.hls,r=t.maxAutoLevel,a=t.levels,i=t.config,n=t.minAutoLevel,o=t.media,s=this.lastLoadedFragLevel,l=this.fragCurrent?this.fragCurrent.duration:0,u=o?o.currentTime:0,d=o&&0!==o.playbackRate?Math.abs(o.playbackRate):1,f=this._bwEstimator?this._bwEstimator.getEstimate():i.abrEwmaDefaultEstimate,h=(c.default.bufferInfo(o,u,i.maxBufferHole).end-u)/d,v=this._findBestLevel(s,l,f,n,r,h,i.abrBandWidthFactor,i.abrBandWidthUpFactor,a);if(v>=0)return v;g.logger.trace("rebuffering expected to happen, lets try to find a quality level minimizing the rebuffering");var p=l?Math.min(l,i.maxStarvationDelay):i.maxStarvationDelay,y=i.abrBandWidthFactor,m=i.abrBandWidthUpFactor;if(0===h){var E=this.bitrateTestDelay;if(E){var b=l?Math.min(l,i.maxLoadingDelay):i.maxLoadingDelay;p=b-E,g.logger.trace("bitrate test took "+Math.round(1e3*E)+"ms, set first fragment max fetchDuration to "+Math.round(1e3*p)+" ms"),y=m=1}}return v=this._findBestLevel(s,l,f,n,r,h+p,y,m,a),Math.max(v,0)}}]),t}(f.default);r.default=m},{28:28,29:29,30:30,32:32,44:44,46:46}],6:[function(e,t,r){"use strict";function a(e){return e&&e.__esModule?e:{default:e}}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function n(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function o(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(r,"__esModule",{value:!0});var s=function(){function e(e,t){for(var r=0;r<t.length;r++){var a=t[r];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}return function(t,r,a){return r&&e(t.prototype,r),a&&e(t,a),t}}(),l=e(30),u=a(l),d=e(29),f=a(d),h=e(46),c=e(28),v=function(e){function t(e){i(this,t);var r=n(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,u.default.MEDIA_ATTACHING,u.default.MEDIA_DETACHING,u.default.MANIFEST_PARSED,u.default.BUFFER_RESET,u.default.BUFFER_APPENDING,u.default.BUFFER_CODECS,u.default.BUFFER_EOS,u.default.BUFFER_FLUSHING,u.default.LEVEL_PTS_UPDATED,u.default.LEVEL_UPDATED));return r._msDuration=null,r._levelDuration=null,r.onsbue=r.onSBUpdateEnd.bind(r),r.onsbe=r.onSBUpdateError.bind(r),r.pendingTracks={},r.tracks={},r}return o(t,e),s(t,[{key:"destroy",value:function e(){f.default.prototype.destroy.call(this)}},{key:"onLevelPtsUpdated",value:function e(t){var r=t.type,a=this.tracks.audio;if("audio"===r&&a&&"audio/mpeg"===a.container){var i=this.sourceBuffer.audio,n=Math.abs(i.timestampOffset-t.start);if(n>.1){var o=i.updating;try{i.abort()}catch(e){o=!0,h.logger.warn("can not abort audio buffer: "+e)}o?this.audioTimestampOffset=t.start:(h.logger.warn("change mpeg audio timestamp offset from "+i.timestampOffset+" to "+t.start),i.timestampOffset=t.start)}}}},{key:"onManifestParsed",value:function e(t){var r=t.audio,a=t.video,i=0;t.altAudio&&(r||a)&&(i=(r?1:0)+(a?1:0),h.logger.log(i+" sourceBuffer(s) expected")),this.sourceBufferNb=i}},{key:"onMediaAttaching",value:function e(t){var r=this.media=t.media;if(r){var a=this.mediaSource=new MediaSource;this.onmso=this.onMediaSourceOpen.bind(this),this.onmse=this.onMediaSourceEnded.bind(this),this.onmsc=this.onMediaSourceClose.bind(this),a.addEventListener("sourceopen",this.onmso),a.addEventListener("sourceended",this.onmse),a.addEventListener("sourceclose",this.onmsc),r.src=URL.createObjectURL(a)}}},{key:"onMediaDetaching",value:function e(){h.logger.log("media source detaching");var t=this.mediaSource;if(t){if("open"===t.readyState)try{t.endOfStream()}catch(e){h.logger.warn("onMediaDetaching:"+e.message+" while calling endOfStream")}t.removeEventListener("sourceopen",this.onmso),t.removeEventListener("sourceended",this.onmse),t.removeEventListener("sourceclose",this.onmsc),this.media&&(URL.revokeObjectURL(this.media.src),this.media.removeAttribute("src"),this.media.load()),this.mediaSource=null,this.media=null,this.pendingTracks={},this.tracks={},this.sourceBuffer={},this.flushRange=[],this.segments=[],this.appended=0}this.onmso=this.onmse=this.onmsc=null,this.hls.trigger(u.default.MEDIA_DETACHED)}},{key:"onMediaSourceOpen",value:function e(){h.logger.log("media source opened"),this.hls.trigger(u.default.MEDIA_ATTACHED,{media:this.media});var t=this.mediaSource;t&&t.removeEventListener("sourceopen",this.onmso),this.checkPendingTracks()}},{key:"checkPendingTracks",value:function e(){var t=this.pendingTracks,r=Object.keys(t).length;r&&(this.sourceBufferNb<=r||0===this.sourceBufferNb)&&(this.createSourceBuffers(t),this.pendingTracks={},this.doAppending())}},{key:"onMediaSourceClose",value:function e(){h.logger.log("media source closed")}},{key:"onMediaSourceEnded",value:function e(){h.logger.log("media source ended")}},{key:"onSBUpdateEnd",value:function e(){if(this.audioTimestampOffset){var t=this.sourceBuffer.audio;h.logger.warn("change mpeg audio timestamp offset from "+t.timestampOffset+" to "+this.audioTimestampOffset),t.timestampOffset=this.audioTimestampOffset,delete this.audioTimestampOffset}this._needsFlush&&this.doFlush(),this._needsEos&&this.checkEos(),this.appending=!1;var r=this.parent,a=this.segments.reduce(function(e,t){return t.parent===r?e+1:e},0);this.hls.trigger(u.default.BUFFER_APPENDED,{parent:r,pending:a}),this._needsFlush||this.doAppending(),this.updateMediaElementDuration()}},{key:"onSBUpdateError",value:function e(t){h.logger.error("sourceBuffer error:",t),this.hls.trigger(u.default.ERROR,{type:c.ErrorTypes.MEDIA_ERROR,details:c.ErrorDetails.BUFFER_APPENDING_ERROR,fatal:!1})}},{key:"onBufferReset",value:function e(){var t=this.sourceBuffer;for(var r in t){var a=t[r];try{this.mediaSource.removeSourceBuffer(a),a.removeEventListener("updateend",this.onsbue),a.removeEventListener("error",this.onsbe)}catch(e){}}this.sourceBuffer={},this.flushRange=[],this.segments=[],this.appended=0}},{key:"onBufferCodecs",value:function e(t){if(0===Object.keys(this.sourceBuffer).length){for(var r in t)this.pendingTracks[r]=t[r];var a=this.mediaSource;a&&"open"===a.readyState&&this.checkPendingTracks()}}},{key:"createSourceBuffers",value:function e(t){var r=this.sourceBuffer,a=this.mediaSource;for(var i in t)if(!r[i]){var n=t[i],o=n.levelCodec||n.codec,s=n.container+";codecs="+o;h.logger.log("creating sourceBuffer("+s+")");try{var l=r[i]=a.addSourceBuffer(s);l.addEventListener("updateend",this.onsbue),l.addEventListener("error",this.onsbe),this.tracks[i]={codec:o,container:n.container},n.buffer=l}catch(e){h.logger.error("error while trying to add sourceBuffer:"+e.message),this.hls.trigger(u.default.ERROR,{type:c.ErrorTypes.MEDIA_ERROR,details:c.ErrorDetails.BUFFER_ADD_CODEC_ERROR,fatal:!1,err:e,mimeType:s})}}this.hls.trigger(u.default.BUFFER_CREATED,{tracks:t})}},{key:"onBufferAppending",value:function e(t){this._needsFlush||(this.segments?this.segments.push(t):this.segments=[t],this.doAppending())}},{key:"onBufferAppendFail",value:function e(t){h.logger.error("sourceBuffer error:",t.event),this.hls.trigger(u.default.ERROR,{type:c.ErrorTypes.MEDIA_ERROR,details:c.ErrorDetails.BUFFER_APPENDING_ERROR,fatal:!1})}},{key:"onBufferEos",value:function e(t){var r=this.sourceBuffer,a=t.type;for(var i in r)a&&i!==a||r[i].ended||(r[i].ended=!0,h.logger.log(i+" sourceBuffer now EOS"));this.checkEos()}},{key:"checkEos",value:function e(){var t=this.sourceBuffer,r=this.mediaSource;if(!r||"open"!==r.readyState)return void(this._needsEos=!1);for(var a in t){var i=t[a];if(!i.ended)return;if(i.updating)return void(this._needsEos=!0)}h.logger.log("all media data available, signal endOfStream() to MediaSource and stop loading fragment");try{r.endOfStream()}catch(e){h.logger.warn("exception while calling mediaSource.endOfStream()")}this._needsEos=!1}},{key:"onBufferFlushing",value:function e(t){this.flushRange.push({start:t.startOffset,end:t.endOffset,type:t.type}),this.flushBufferCounter=0,this.doFlush()}},{key:"onLevelUpdated",value:function e(t){var r=t.details;0!==r.fragments.length&&(this._levelDuration=r.totalduration+r.fragments[0].start,this.updateMediaElementDuration())}},{key:"updateMediaElementDuration",value:function e(){var t=this.media,r=this.mediaSource,a=this.sourceBuffer,i=this._levelDuration;if(null!==i&&t&&r&&a&&0!==t.readyState&&"open"===r.readyState){for(var n in a)if(a[n].updating)return;null===this._msDuration&&(this._msDuration=r.duration);var o=t.duration;(i>this._msDuration&&i>o||o===1/0||isNaN(o))&&(h.logger.log("Updating mediasource duration to "+i.toFixed(3)),this._msDuration=r.duration=i)}}},{key:"doFlush",value:function e(){for(;this.flushRange.length;){var t=this.flushRange[0];if(!this.flushBuffer(t.start,t.end,t.type))return void(this._needsFlush=!0);this.flushRange.shift(),this.flushBufferCounter=0}if(0===this.flushRange.length){this._needsFlush=!1;var r=0,a=this.sourceBuffer;try{for(var i in a)r+=a[i].buffered.length}catch(e){h.logger.error("error while accessing sourceBuffer.buffered")}this.appended=r,this.hls.trigger(u.default.BUFFER_FLUSHED)}}},{key:"doAppending",value:function e(){var t=this.hls,r=this.sourceBuffer,a=this.segments;if(Object.keys(r).length){if(this.media.error)return this.segments=[],void h.logger.error("trying to append although a media error occured, flush segment and abort");if(this.appending)return;if(a&&a.length){var i=a.shift();try{var n=i.type,o=r[n];o?o.updating?a.unshift(i):(o.ended=!1,this.parent=i.parent,o.appendBuffer(i.data),this.appendError=0,this.appended++,this.appending=!0):this.onSBUpdateEnd()}catch(e){h.logger.error("error while trying to append buffer:"+e.message),a.unshift(i);var s={type:c.ErrorTypes.MEDIA_ERROR,parent:i.parent};if(22===e.code)return this.segments=[],s.details=c.ErrorDetails.BUFFER_FULL_ERROR,s.fatal=!1,void t.trigger(u.default.ERROR,s);if(this.appendError?this.appendError++:this.appendError=1,s.details=c.ErrorDetails.BUFFER_APPEND_ERROR,this.appendError>t.config.appendErrorMaxRetry)return h.logger.log("fail "+t.config.appendErrorMaxRetry+" times to append segment in sourceBuffer"),a=[],s.fatal=!0,void t.trigger(u.default.ERROR,s);s.fatal=!1,t.trigger(u.default.ERROR,s)}}}}},{key:"flushBuffer",value:function e(t,r,a){var i,n,o,s,l,u,d=this.sourceBuffer;if(Object.keys(d).length){if(h.logger.log("flushBuffer,pos/start/end: "+this.media.currentTime.toFixed(3)+"/"+t+"/"+r),this.flushBufferCounter<this.appended){for(var f in d)if(!a||f===a){if(i=d[f],i.ended=!1,i.updating)return h.logger.warn("cannot flush, sb updating in progress"),!1;try{for(n=0;n<i.buffered.length;n++)if(o=i.buffered.start(n),s=i.buffered.end(n),-1!==navigator.userAgent.toLowerCase().indexOf("firefox")&&r===Number.POSITIVE_INFINITY?(l=t,u=r):(l=Math.max(o,t),u=Math.min(s,r)),Math.min(u,s)-l>.5)return this.flushBufferCounter++,h.logger.log("flush "+f+" ["+l+","+u+"], of ["+o+","+s+"], pos:"+this.media.currentTime),i.remove(l,u),!1}catch(e){h.logger.warn("exception while accessing sourcebuffer, it might have been removed from MediaSource")}}}else h.logger.warn("abort flushing too many retries");h.logger.log("buffer flushed")}return!0}}]),t}(f.default);r.default=v},{28:28,29:29,30:30,46:46}],7:[function(e,t,r){"use strict";function a(e){return e&&e.__esModule?e:{default:e}}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function n(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function o(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(r,"__esModule",{value:!0});var s=function(){function e(e,t){for(var r=0;r<t.length;r++){var a=t[r];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}return function(t,r,a){return r&&e(t.prototype,r),a&&e(t,a),t}}(),l=e(30),u=a(l),d=e(29),f=a(d),h=function(e){function t(e){return i(this,t),n(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,u.default.FPS_DROP_LEVEL_CAPPING,u.default.MEDIA_ATTACHING,u.default.MANIFEST_PARSED))}return o(t,e),s(t,[{key:"destroy",value:function e(){this.hls.config.capLevelToPlayerSize&&(this.media=this.restrictedLevels=null,this.autoLevelCapping=Number.POSITIVE_INFINITY,this.timer&&(this.timer=clearInterval(this.timer)))}},{key:"onFpsDropLevelCapping",value:function e(r){t.isLevelAllowed(r.droppedLevel,this.restrictedLevels)&&this.restrictedLevels.push(r.droppedLevel)}},{key:"onMediaAttaching",value:function e(t){this.media=t.media instanceof HTMLVideoElement?t.media:null}},{key:"onManifestParsed",value:function e(t){var r=this.hls;this.restrictedLevels=[],r.config.capLevelToPlayerSize&&(this.autoLevelCapping=Number.POSITIVE_INFINITY,this.levels=t.levels,r.firstLevel=this.getMaxLevel(t.firstLevel),clearInterval(this.timer),this.timer=setInterval(this.detectPlayerSize.bind(this),1e3),this.detectPlayerSize())}},{key:"detectPlayerSize",value:function e(){if(this.media){var t=this.levels?this.levels.length:0;if(t){var r=this.hls;r.autoLevelCapping=this.getMaxLevel(t-1),r.autoLevelCapping>this.autoLevelCapping&&r.streamController.nextLevelSwitch(),this.autoLevelCapping=r.autoLevelCapping}}}},{key:"getMaxLevel",value:function e(r){var a=this;if(!this.levels)return-1;var i=this.levels.filter(function(e,i){return t.isLevelAllowed(i,a.restrictedLevels)&&i<=r});return t.getMaxLevelByMediaSize(i,this.mediaWidth,this.mediaHeight)}},{key:"mediaWidth",get:function e(){var r=void 0,a=this.media;return a&&(r=a.width||a.clientWidth||a.offsetWidth,r*=t.contentScaleFactor),r}},{key:"mediaHeight",get:function e(){var r=void 0,a=this.media;return a&&(r=a.height||a.clientHeight||a.offsetHeight,r*=t.contentScaleFactor),r}}],[{key:"isLevelAllowed",value:function e(t){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];return-1===r.indexOf(t)}},{key:"getMaxLevelByMediaSize",value:function e(t,r,a){if(!t||t&&!t.length)return-1;for(var i=function e(t,r){return!r||(t.width!==r.width||t.height!==r.height)},n=t.length-1,o=0;o<t.length;o+=1){var s=t[o];if((s.width>=r||s.height>=a)&&i(s,t[o+1])){n=o;break}}return n}},{key:"contentScaleFactor",get:function e(){var t=1;try{t=window.devicePixelRatio}catch(e){}return t}}]),t}(f.default);r.default=h},{29:29,30:30}],8:[function(e,t,r){"use strict";function a(e){return e&&e.__esModule?e:{default:e}}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function n(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function o(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(r,"__esModule",{value:!0});var s=function(){function e(e,t){for(var r=0;r<t.length;r++){var a=t[r];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}return function(t,r,a){return r&&e(t.prototype,r),a&&e(t,a),t}}(),l=e(30),u=a(l),d=e(29),f=a(d),h=e(46),c=function(e){function t(e){return i(this,t),n(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,u.default.MEDIA_ATTACHING))}return o(t,e),s(t,[{key:"destroy",value:function e(){this.timer&&clearInterval(this.timer),this.isVideoPlaybackQualityAvailable=!1}},{key:"onMediaAttaching",value:function e(t){var r=this.hls.config;if(r.capLevelOnFPSDrop){var a=this.video=t.media instanceof HTMLVideoElement?t.media:null;"function"==typeof a.getVideoPlaybackQuality&&(this.isVideoPlaybackQualityAvailable=!0),clearInterval(this.timer),this.timer=setInterval(this.checkFPSInterval.bind(this),r.fpsDroppedMonitoringPeriod)}}},{key:"checkFPS",value:function e(t,r,a){var i=performance.now();if(r){if(this.lastTime){var n=i-this.lastTime,o=a-this.lastDroppedFrames,s=r-this.lastDecodedFrames,l=1e3*o/n,d=this.hls;if(d.trigger(u.default.FPS_DROP,{currentDropped:o,currentDecoded:s,totalDroppedFrames:a}),l>0&&o>d.config.fpsDroppedMonitoringThreshold*s){var f=d.currentLevel;h.logger.warn("drop FPS ratio greater than max allowed value for currentLevel: "+f),f>0&&(-1===d.autoLevelCapping||d.autoLevelCapping>=f)&&(f-=1,d.trigger(u.default.FPS_DROP_LEVEL_CAPPING,{level:f,droppedLevel:d.currentLevel}),d.autoLevelCapping=f,d.streamController.nextLevelSwitch())}}this.lastTime=i,this.lastDroppedFrames=a,this.lastDecodedFrames=r}}},{key:"checkFPSInterval",value:function e(){var t=this.video;if(t)if(this.isVideoPlaybackQualityAvailable){var r=t.getVideoPlaybackQuality();this.checkFPS(t,r.totalVideoFrames,r.droppedVideoFrames)}else this.checkFPS(t,t.webkitDecodedFrameCount,t.webkitDroppedFrameCount)}}]),t}(f.default);r.default=c},{29:29,30:30,46:46}],9:[function(e,t,r){"use strict";function a(e){return e&&e.__esModule?e:{default:e}}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function n(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function o(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(r,"__esModule",{value:!0});var s=function(){function e(e,t){for(var r=0;r<t.length;r++){var a=t[r];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}return function(t,r,a){return r&&e(t.prototype,r),a&&e(t,a),t}}(),l=e(30),u=a(l),d=e(29),f=a(d),h=e(22),c=a(h),v=function(e){function t(e){i(this,t);var r=n(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,u.default.MEDIA_ATTACHED,u.default.MEDIA_DETACHING,u.default.FRAG_PARSING_METADATA));return r.id3Track=void 0,r.media=void 0,r}return o(t,e),s(t,[{key:"destroy",value:function e(){f.default.prototype.destroy.call(this)}},{key:"onMediaAttached",value:function e(t){this.media=t.media,this.media&&(this.id3Track=this.media.addTextTrack("metadata","id3"),this.id3Track.mode="hidden")}},{key:"onMediaDetaching",value:function e(){this.media=void 0}},{key:"onFragParsingMetadata",value:function e(t){for(var r=t.frag,a=t.samples,i=window.WebKitDataCue||window.VTTCue||window.TextTrackCue,n=0;n<a.length;n++){var o=c.default.getID3Frames(a[n].data);if(o){var s=a[n].pts,l=n<a.length-1?a[n+1].pts:r.endPTS;s===l&&(l+=1e-4);for(var u=0;u<o.length;u++){var d=o[u];if(!c.default.isTimeStampFrame(d)){var f=new i(s,l,"");f.value=d,this.id3Track.addCue(f)}}}}}}]),t}(f.default);r.default=v},{22:22,29:29,30:30}],10:[function(e,t,r){"use strict";function a(e){return e&&e.__esModule?e:{default:e}}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function n(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function o(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(r,"__esModule",{value:!0});var s=function(){function e(e,t){for(var r=0;r<t.length;r++){var a=t[r];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}return function(t,r,a){return r&&e(t.prototype,r),a&&e(t,a),t}}(),l=e(30),u=a(l),d=e(29),f=a(d),h=e(46),c=e(28),v=e(32),g=a(v),p=function(e){function t(e){i(this,t);var r=n(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,u.default.MANIFEST_LOADED,u.default.LEVEL_LOADED,u.default.FRAG_LOADED,u.default.ERROR));return r.ontick=r.tick.bind(r),r._manualLevel=-1,r}return o(t,e),s(t,[{key:"destroy",value:function e(){this.timer&&(clearTimeout(this.timer),this.timer=null),this._manualLevel=-1}},{key:"startLoad",value:function e(){this.canload=!0;var t=this._levels;t&&t.forEach(function(e){e.loadError=0;var t=e.details;t&&t.live&&(e.details=void 0)}),this.timer&&this.tick()}},{key:"stopLoad",value:function e(){this.canload=!1}},{key:"onManifestLoaded",value:function e(t){var r=[],a=[],i,n={},o=!1,s=!1,l=this.hls,d=/chrome|firefox/.test(navigator.userAgent.toLowerCase()),f=function e(t,r){return MediaSource.isTypeSupported(t+"/mp4;codecs="+r)};if(t.levels.forEach(function(e){e.videoCodec&&(o=!0),d&&e.audioCodec&&-1!==e.audioCodec.indexOf("mp4a.40.34")&&(e.audioCodec=void 0),(e.audioCodec||e.attrs&&e.attrs.AUDIO)&&(s=!0);var t=n[e.bitrate];void 0===t?(n[e.bitrate]=r.length,e.url=[e.url],e.urlId=0,r.push(e)):r[t].url.push(e.url)}),o&&s?r.forEach(function(e){e.videoCodec&&a.push(e)}):a=r,a=a.filter(function(e){var t=e.audioCodec,r=e.videoCodec;return(!t||f("audio",t))&&(!r||f("video",r))}),a.length){i=a[0].bitrate,a.sort(function(e,t){return e.bitrate-t.bitrate}),this._levels=a;for(var v=0;v<a.length;v++)if(a[v].bitrate===i){this._firstLevel=v,h.logger.log("manifest loaded,"+a.length+" level(s) found, first bitrate:"+i);break}l.trigger(u.default.MANIFEST_PARSED,{levels:a,firstLevel:this._firstLevel,stats:t.stats,audio:s,video:o,altAudio:t.audioTracks.length>0})}else l.trigger(u.default.ERROR,{type:c.ErrorTypes.MEDIA_ERROR,details:c.ErrorDetails.MANIFEST_INCOMPATIBLE_CODECS_ERROR,fatal:!0,url:l.url,reason:"no level with compatible codecs found in manifest"})}},{key:"setLevelInternal",value:function e(t){var r=this._levels,a=this.hls;if(t>=0&&t<r.length){if(this.timer&&(clearTimeout(this.timer),this.timer=null),this._level!==t){h.logger.log("switching to level "+t),this._level=t;var i=r[t];i.level=t,a.trigger(u.default.LEVEL_SWITCH,i),a.trigger(u.default.LEVEL_SWITCHING,i)}var n=r[t],o=n.details;if(!o||!0===o.live){var s=n.urlId;a.trigger(u.default.LEVEL_LOADING,{url:n.url[s],level:t,id:s})}}else a.trigger(u.default.ERROR,{type:c.ErrorTypes.OTHER_ERROR,details:c.ErrorDetails.LEVEL_SWITCH_ERROR,level:t,fatal:!1,reason:"invalid level idx"})}},{key:"onError",value:function e(t){if(!t.fatal){var r=t.details,a=this.hls,i=void 0,n=void 0,o=!1;switch(r){case c.ErrorDetails.FRAG_LOAD_ERROR:case c.ErrorDetails.FRAG_LOAD_TIMEOUT:case c.ErrorDetails.FRAG_LOOP_LOADING_ERROR:case c.ErrorDetails.KEY_LOAD_ERROR:case c.ErrorDetails.KEY_LOAD_TIMEOUT:i=t.frag.level;break;case c.ErrorDetails.LEVEL_LOAD_ERROR:case c.ErrorDetails.LEVEL_LOAD_TIMEOUT:i=t.context.level,o=!0;break;case c.ErrorDetails.REMUX_ALLOC_ERROR:i=t.level}if(void 0!==i){n=this._levels[i],n.loadError?n.loadError++:n.loadError=1;var s=n.url.length;if(s>1&&n.loadError<s)n.urlId=(n.urlId+1)%s,n.details=void 0,h.logger.warn("level controller,"+r+" for level "+i+": switching to redundant stream id "+n.urlId);else{var l=-1===this._manualLevel&&i;if(l)h.logger.warn("level controller,"+r+": switch-down for next fragment"),a.nextAutoLevel=Math.max(0,i-1);else if(n&&n.details&&n.details.live)h.logger.warn("level controller,"+r+" on live stream, discard"),o&&(this._level=void 0);else if(r===c.ErrorDetails.LEVEL_LOAD_ERROR||r===c.ErrorDetails.LEVEL_LOAD_TIMEOUT){var u=a.media,d=u&&g.default.isBuffered(u,u.currentTime)&&g.default.isBuffered(u,u.currentTime+.5);if(d){var f=a.config.levelLoadingRetryDelay;h.logger.warn("level controller,"+r+", but media buffered, retry in "+f+"ms"),this.timer=setTimeout(this.ontick,f),t.levelRetry=!0}else h.logger.error("cannot recover "+r+" error"),this._level=void 0,this.timer&&(clearTimeout(this.timer),this.timer=null),t.fatal=!0}}}}}},{key:"onFragLoaded",value:function e(t){var r=t.frag;if(r&&"main"===r.type){var a=this._levels[r.level];a&&(a.loadError=0)}}},{key:"onLevelLoaded",value:function e(t){var r=t.level;if(r===this._level){var a=this._levels[r];a.loadError=0;var i=t.details;if(i.live){var n=1e3*(i.averagetargetduration?i.averagetargetduration:i.targetduration),o=a.details;o&&i.endSN===o.endSN&&(n/=2,h.logger.log("same live playlist, reload twice faster")),n-=performance.now()-t.stats.trequest,n=Math.max(1e3,Math.round(n)),h.logger.log("live playlist, reload in "+n+" ms"),this.timer=setTimeout(this.ontick,n)}else this.timer=null}}},{key:"tick",value:function e(){var t=this._level;if(void 0!==t&&this.canload){var r=this._levels[t];if(r&&r.url){var a=r.urlId;this.hls.trigger(u.default.LEVEL_LOADING,{url:r.url[a],level:t,id:a})}}}},{key:"levels",get:function e(){return this._levels}},{key:"level",get:function e(){return this._level},set:function e(t){var r=this._levels;r&&r.length>t&&(this._level===t&&void 0!==r[t].details||this.setLevelInternal(t))}},{key:"manualLevel",get:function e(){return this._manualLevel},set:function e(t){this._manualLevel=t,void 0===this._startLevel&&(this._startLevel=t),-1!==t&&(this.level=t)}},{key:"firstLevel",get:function e(){return this._firstLevel},set:function e(t){this._firstLevel=t}},{key:"startLevel",get:function e(){if(void 0===this._startLevel){var t=this.hls.config.startLevel;return void 0!==t?t:this._firstLevel}return this._startLevel},set:function e(t){this._startLevel=t}},{key:"nextLoadLevel",get:function e(){return-1!==this._manualLevel?this._manualLevel:this.hls.nextAutoLevel},set:function e(t){this.level=t,-1===this._manualLevel&&(this.hls.nextAutoLevel=t)}}]),t}(f.default);r.default=p},{28:28,29:29,30:30,32:32,46:46}],11:[function(e,t,r){"use strict";function a(e){return e&&e.__esModule?e:{default:e}}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function n(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function o(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(r,"__esModule",{value:!0});var s=function(){function e(e,t){for(var r=0;r<t.length;r++){var a=t[r];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}return function(t,r,a){return r&&e(t.prototype,r),a&&e(t,a),t}}(),l=e(43),u=a(l),d=e(32),f=a(d),h=e(20),c=a(h),v=e(30),g=a(v),p=e(29),y=a(p),m=e(33),E=a(m),b=e(47),_=a(b),R=e(28),S=e(46),T={STOPPED:"STOPPED",IDLE:"IDLE",KEY_LOADING:"KEY_LOADING",FRAG_LOADING:"FRAG_LOADING",FRAG_LOADING_WAITING_RETRY:"FRAG_LOADING_WAITING_RETRY",WAITING_LEVEL:"WAITING_LEVEL",PARSING:"PARSING",PARSED:"PARSED",BUFFER_FLUSHING:"BUFFER_FLUSHING",ENDED:"ENDED",ERROR:"ERROR"},L=function(e){function t(e){i(this,t);var r=n(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,g.default.MEDIA_ATTACHED,g.default.MEDIA_DETACHING,g.default.MANIFEST_LOADING,g.default.MANIFEST_PARSED,g.default.LEVEL_LOADED,g.default.KEY_LOADED,g.default.FRAG_LOADED,g.default.FRAG_LOAD_EMERGENCY_ABORTED,g.default.FRAG_PARSING_INIT_SEGMENT,g.default.FRAG_PARSING_DATA,g.default.FRAG_PARSED,g.default.ERROR,g.default.AUDIO_TRACK_SWITCHING,g.default.AUDIO_TRACK_SWITCHED,g.default.BUFFER_CREATED,g.default.BUFFER_APPENDED,g.default.BUFFER_FLUSHED));return r.config=e.config,r.audioCodecSwap=!1,r.ticks=0,r._state=T.STOPPED,r.ontick=r.tick.bind(r),r}return o(t,e),s(t,[{key:"destroy",value:function e(){this.stopLoad(),this.timer&&(clearInterval(this.timer),this.timer=null),y.default.prototype.destroy.call(this),this.state=T.STOPPED}},{key:"startLoad",value:function e(t){if(this.levels){var r=this.lastCurrentTime,a=this.hls;if(this.stopLoad(),this.timer||(this.timer=setInterval(this.ontick,100)),this.level=-1,this.fragLoadError=0,!this.startFragRequested){var i=a.startLevel;-1===i&&(i=0,this.bitrateTest=!0),this.level=a.nextLoadLevel=i,this.loadedmetadata=!1}r>0&&-1===t&&(S.logger.log("override startPosition with lastCurrentTime @"+r.toFixed(3)),t=r),this.state=T.IDLE,this.nextLoadPosition=this.startPosition=this.lastCurrentTime=t,this.tick()}else this.forceStartLoad=!0,this.state=T.STOPPED}},{key:"stopLoad",value:function e(){var t=this.fragCurrent;t&&(t.loader&&t.loader.abort(),this.fragCurrent=null),this.fragPrevious=null,this.demuxer&&(this.demuxer.destroy(),this.demuxer=null),this.state=T.STOPPED,this.forceStartLoad=!1}},{key:"tick",value:function e(){1===++this.ticks&&(this.doTick(),this.ticks>1&&setTimeout(this.tick,1),this.ticks=0)}},{key:"doTick",value:function e(){switch(this.state){case T.ERROR:break;case T.BUFFER_FLUSHING:this.fragLoadError=0;break;case T.IDLE:this._doTickIdle();break;case T.WAITING_LEVEL:var t=this.levels[this.level];t&&t.details&&(this.state=T.IDLE);break;case T.FRAG_LOADING_WAITING_RETRY:var r=performance.now(),a=this.retryDate;(!a||r>=a||this.media&&this.media.seeking)&&(S.logger.log("mediaController: retryDate reached, switch back to IDLE state"),this.state=T.IDLE);break;case T.ERROR:case T.STOPPED:case T.FRAG_LOADING:case T.PARSING:case T.PARSED:case T.ENDED:}this._checkBuffer(),this._checkFragmentChanged()}},{key:"_doTickIdle",value:function e(){var t=this.hls,r=t.config,a=this.media;if(void 0===this.levelLastLoaded||a||!this.startFragRequested&&r.startFragPrefetch){var i=void 0;i=this.loadedmetadata?a.currentTime:this.nextLoadPosition;var n=t.nextLoadLevel,o=this.levels[n];if(o){var s=o.bitrate,l=void 0;l=s?Math.max(8*r.maxBufferSize/s,r.maxBufferLength):r.maxBufferLength,l=Math.min(l,r.maxMaxBufferLength);var u=f.default.bufferInfo(this.mediaBuffer?this.mediaBuffer:a,i,r.maxBufferHole),d=u.len;if(!(d>=l)){S.logger.trace("buffer length of "+d.toFixed(3)+" is below max of "+l.toFixed(3)+". checking for more payload ..."),this.level=t.nextLoadLevel=n;var h=o.details;if(void 0===h||h.live&&this.levelLastLoaded!==n)return void(this.state=T.WAITING_LEVEL);var c=this.fragPrevious;if(!h.live&&c&&c.sn===h.endSN&&d&&!u.nextStart){var v=Math.min(a.duration,c.start+c.duration);if(v-Math.max(u.end,c.start)<=Math.max(.2,c.duration)){var p={};return this.altAudio&&(p.type="video"),this.hls.trigger(g.default.BUFFER_EOS,p),void(this.state=T.ENDED)}}this._fetchPayloadOrEos(i,u,h)}}}}},{key:"_fetchPayloadOrEos",value:function e(t,r,a){var i=this.fragPrevious,n=this.level,o=a.fragments,s=o.length;if(0!==s){var l=o[0].start,u=o[s-1].start+o[s-1].duration,d=r.end,f=void 0;if(a.initSegment&&!a.initSegment.data)f=a.initSegment;else if(a.live){var h=this.config.initialLiveManifestSize;if(s<h)return void S.logger.warn("Can not start playback of a level, reason: not enough fragments "+s+" < "+h);if(null===(f=this._ensureFragmentAtLivePoint(a,d,l,u,i,o,s)))return}else d<l&&(f=o[0]);f||(f=this._findFragment(l,i,s,o,d,u,a)),f&&this._loadFragmentOrKey(f,n,a,t,d)}}},{key:"_ensureFragmentAtLivePoint",value:function e(t,r,a,i,n,o,s){var l=this.hls.config,u=this.media,d=void 0,f=void 0!==l.liveMaxLatencyDuration?l.liveMaxLatencyDuration:l.liveMaxLatencyDurationCount*t.targetduration;if(r<Math.max(a-l.maxFragLookUpTolerance,i-f)){var h=this.liveSyncPosition=this.computeLivePosition(a,t);S.logger.log("buffer end: "+r.toFixed(3)+" is located too far from the end of live sliding playlist, reset currentTime to : "+h.toFixed(3)),r=h,u&&u.readyState&&u.duration>h&&(u.currentTime=h)}if(t.PTSKnown&&r>i&&u&&u.readyState)return null;if(this.startFragRequested&&!t.PTSKnown){if(n){var c=n.sn+1;c>=t.startSN&&c<=t.endSN&&(d=o[c-t.startSN],S.logger.log("live playlist, switching playlist, load frag with next SN: "+d.sn))}d||(d=o[Math.min(s-1,Math.round(s/2))],S.logger.log("live playlist, switching playlist, unknown, load middle frag : "+d.sn))}return d}},{key:"_findFragment",value:function e(t,r,a,i,n,o,s){var l=this.hls.config,d=void 0,f=void 0,h=l.maxFragLookUpTolerance,c=r?i[r.sn-i[0].sn+1]:void 0,v=function e(t){var r=Math.min(h,t.duration);return t.start+t.duration-r<=n?1:t.start-r>n&&t.start?-1:0};if(n<o?(n>o-h&&(h=0),f=c&&!v(c)?c:u.default.search(i,v)):f=i[a-1],f){d=f;var g=d.sn-s.startSN,p=r&&d.level===r.level,y=i[g-1],m=i[g+1];if(r&&d.sn===r.sn)if(p&&!d.backtracked)if(d.sn<s.endSN){var E=r.deltaPTS;E&&E>l.maxBufferHole&&r.dropped&&g?(d=y,S.logger.warn("SN just loaded, with large PTS gap between audio and video, maybe frag is not starting with a keyframe ? load previous one to try to overcome this"),r.loadCounter--):(d=m,S.logger.log("SN just loaded, load next one: "+d.sn))}else d=null;else d.backtracked&&(m&&m.backtracked?(S.logger.warn("Already backtracked from fragment "+m.sn+", will not backtrack to fragment "+d.sn+". Loading fragment "+m.sn),d=m):(S.logger.warn("Loaded fragment with dropped frames, backtracking 1 segment to find a keyframe"),d.dropped=0,y?(y.loadCounter&&y.loadCounter--,d=y,d.backtracked=!0):d=null))}return d}},{key:"_loadFragmentOrKey",value:function e(t,r,a,i,n){var o=this.hls,s=o.config;if(!t.decryptdata||null==t.decryptdata.uri||null!=t.decryptdata.key){if(S.logger.log("Loading "+t.sn+" of ["+a.startSN+" ,"+a.endSN+"],level "+r+", currentTime:"+i.toFixed(3)+",bufferEnd:"+n.toFixed(3)),void 0!==this.fragLoadIdx?this.fragLoadIdx++:this.fragLoadIdx=0,t.loadCounter){t.loadCounter++;var l=s.fragLoadingLoopThreshold;if(t.loadCounter>l&&Math.abs(this.fragLoadIdx-t.loadIdx)<l)return void o.trigger(g.default.ERROR,{type:R.ErrorTypes.MEDIA_ERROR,details:R.ErrorDetails.FRAG_LOOP_LOADING_ERROR,fatal:!1,frag:t})}else t.loadCounter=1;return t.loadIdx=this.fragLoadIdx,this.fragCurrent=t,this.startFragRequested=!0,isNaN(t.sn)||(this.nextLoadPosition=t.start+t.duration),t.autoLevel=o.autoLevelEnabled,t.bitrateTest=this.bitrateTest,o.trigger(g.default.FRAG_LOADING,{frag:t}),this.demuxer||(this.demuxer=new c.default(o,"main")),void(this.state=T.FRAG_LOADING)}S.logger.log("Loading key for "+t.sn+" of ["+a.startSN+" ,"+a.endSN+"],level "+r),this.state=T.KEY_LOADING,o.trigger(g.default.KEY_LOADING,{frag:t})}},{key:"getBufferedFrag",value:function e(t){return u.default.search(this._bufferedFrags,function(e){return t<e.startPTS?-1:t>e.endPTS?1:0})}},{key:"followingBufferedFrag",value:function e(t){return t?this.getBufferedFrag(t.endPTS+.5):null}},{key:"_checkFragmentChanged",value:function e(){var t,r,a=this.media;if(a&&a.readyState&&!1===a.seeking&&(r=a.currentTime,r>a.playbackRate*this.lastCurrentTime&&(this.lastCurrentTime=r),f.default.isBuffered(a,r)?t=this.getBufferedFrag(r):f.default.isBuffered(a,r+.1)&&(t=this.getBufferedFrag(r+.1)),t)){var i=t;if(i!==this.fragPlaying){this.hls.trigger(g.default.FRAG_CHANGED,{frag:i});var n=i.level;this.fragPlaying&&this.fragPlaying.level===n||this.hls.trigger(g.default.LEVEL_SWITCHED,{level:n}),this.fragPlaying=i}}}},{key:"immediateLevelSwitch",value:function e(){if(S.logger.log("immediateLevelSwitch"),!this.immediateSwitch){this.immediateSwitch=!0;var t=this.media,r=void 0;t?(r=t.paused,t.pause()):r=!0,this.previouslyPaused=r}var a=this.fragCurrent;a&&a.loader&&a.loader.abort(),this.fragCurrent=null,this.fragLoadIdx+=2*this.config.fragLoadingLoopThreshold,this.flushMainBuffer(0,Number.POSITIVE_INFINITY)}},{key:"immediateLevelSwitchEnd",value:function e(){var t=this.media;t&&t.buffered.length&&(this.immediateSwitch=!1,f.default.isBuffered(t,t.currentTime)&&(t.currentTime-=1e-4),this.previouslyPaused||t.play())}},{key:"nextLevelSwitch",value:function e(){var t=this.media;if(t&&t.readyState){var r=void 0,a=void 0,i=void 0;if(this.fragLoadIdx+=2*this.config.fragLoadingLoopThreshold,a=this.getBufferedFrag(t.currentTime),a&&a.startPTS>1&&this.flushMainBuffer(0,a.startPTS-1),t.paused)r=0;else{var n=this.hls.nextLoadLevel,o=this.levels[n],s=this.fragLastKbps;r=s&&this.fragCurrent?this.fragCurrent.duration*o.bitrate/(1e3*s)+1:0}if((i=this.getBufferedFrag(t.currentTime+r))&&(i=this.followingBufferedFrag(i))){var l=this.fragCurrent;l&&l.loader&&l.loader.abort(),this.fragCurrent=null,this.flushMainBuffer(i.startPTS,Number.POSITIVE_INFINITY)}}}},{key:"flushMainBuffer",value:function e(t,r){this.state=T.BUFFER_FLUSHING;var a={startOffset:t,endOffset:r};this.altAudio&&(a.type="video"),this.hls.trigger(g.default.BUFFER_FLUSHING,a)}},{key:"onMediaAttached",value:function e(t){var r=this.media=this.mediaBuffer=t.media;this.onvseeking=this.onMediaSeeking.bind(this),this.onvseeked=this.onMediaSeeked.bind(this),this.onvended=this.onMediaEnded.bind(this),r.addEventListener("seeking",this.onvseeking),r.addEventListener("seeked",this.onvseeked),r.addEventListener("ended",this.onvended);var a=this.config;this.levels&&a.autoStartLoad&&this.hls.startLoad(a.startPosition)}},{key:"onMediaDetaching",value:function e(){var t=this.media;t&&t.ended&&(S.logger.log("MSE detaching and video ended, reset startPosition"),this.startPosition=this.lastCurrentTime=0);var r=this.levels;r&&r.forEach(function(e){e.details&&e.details.fragments.forEach(function(e){e.loadCounter=void 0,e.backtracked=void 0})}),t&&(t.removeEventListener("seeking",this.onvseeking),t.removeEventListener("seeked",this.onvseeked),t.removeEventListener("ended",this.onvended),this.onvseeking=this.onvseeked=this.onvended=null),this.media=this.mediaBuffer=null,this.loadedmetadata=!1,this.stopLoad()}},{key:"onMediaSeeking",value:function e(){var t=this.media,r=t?t.currentTime:void 0,a=this.config;isNaN(r)||S.logger.log("media seeking to "+r.toFixed(3));var i=this.mediaBuffer?this.mediaBuffer:t,n=f.default.bufferInfo(i,r,this.config.maxBufferHole);if(this.state===T.FRAG_LOADING){var o=this.fragCurrent;if(0===n.len&&o){var s=a.maxFragLookUpTolerance,l=o.start-s,u=o.start+o.duration+s;r<l||r>u?(o.loader&&(S.logger.log("seeking outside of buffer while fragment load in progress, cancel fragment load"),o.loader.abort()),this.fragCurrent=null,this.fragPrevious=null,this.state=T.IDLE):S.logger.log("seeking outside of buffer but within currently loaded fragment range")}}else this.state===T.ENDED&&(0===n.len&&(this.fragPrevious=0),this.state=T.IDLE);t&&(this.lastCurrentTime=r),this.state!==T.FRAG_LOADING&&void 0!==this.fragLoadIdx&&(this.fragLoadIdx+=2*a.fragLoadingLoopThreshold),this.loadedmetadata||(this.nextLoadPosition=this.startPosition=r),this.tick()}},{key:"onMediaSeeked",value:function e(){var t=this.media,r=t?t.currentTime:void 0;isNaN(r)||S.logger.log("media seeked to "+r.toFixed(3)),this.tick()}},{key:"onMediaEnded",value:function e(){S.logger.log("media ended"),this.startPosition=this.lastCurrentTime=0}},{key:"onManifestLoading",value:function e(){S.logger.log("trigger BUFFER_RESET"),this.hls.trigger(g.default.BUFFER_RESET),this._bufferedFrags=[],this.stalled=!1,this.startPosition=this.lastCurrentTime=0}},{key:"onManifestParsed",value:function e(t){var r=!1,a=!1,i;t.levels.forEach(function(e){(i=e.audioCodec)&&(-1!==i.indexOf("mp4a.40.2")&&(r=!0),-1!==i.indexOf("mp4a.40.5")&&(a=!0))}),this.audioCodecSwitch=r&&a,this.audioCodecSwitch&&S.logger.log("both AAC/HE-AAC audio found in levels; declaring level codec as HE-AAC"),this.levels=t.levels,this.startLevelLoaded=!1,this.startFragRequested=!1;var n=this.config;(n.autoStartLoad||this.forceStartLoad)&&this.hls.startLoad(n.startPosition)}},{key:"onLevelLoaded",value:function e(t){var r=t.details,a=t.level,i=this.levels[a],n=r.totalduration,o=0;if(S.logger.log("level "+a+" loaded ["+r.startSN+","+r.endSN+"],duration:"+n),this.levelLastLoaded=a,r.live){var s=i.details;s&&r.fragments.length>0?(E.default.mergeDetails(s,r),o=r.fragments[0].start,this.liveSyncPosition=this.computeLivePosition(o,s),r.PTSKnown?S.logger.log("live playlist sliding:"+o.toFixed(3)):S.logger.log("live playlist - outdated PTS, unknown sliding")):(r.PTSKnown=!1,S.logger.log("live playlist - first load, unknown sliding"))}else r.PTSKnown=!1;if(i.details=r,this.hls.trigger(g.default.LEVEL_UPDATED,{details:r,level:a}),!1===this.startFragRequested){if(-1===this.startPosition||-1===this.lastCurrentTime){var l=r.startTimeOffset;isNaN(l)?r.live?(this.startPosition=this.computeLivePosition(o,r),S.logger.log("configure startPosition to "+this.startPosition)):this.startPosition=0:(l<0&&(S.logger.log("negative start time offset "+l+", count from end of last fragment"),l=o+n+l),S.logger.log("start time offset found in playlist, adjust startPosition to "+l),this.startPosition=l),this.lastCurrentTime=this.startPosition}this.nextLoadPosition=this.startPosition}this.state===T.WAITING_LEVEL&&(this.state=T.IDLE),this.tick()}},{key:"onKeyLoaded",value:function e(){this.state===T.KEY_LOADING&&(this.state=T.IDLE,this.tick())}},{key:"onFragLoaded",value:function e(t){var r=this.fragCurrent,a=t.frag;if(this.state===T.FRAG_LOADING&&r&&"main"===a.type&&a.level===r.level&&a.sn===r.sn){var i=t.stats,n=this.levels[r.level],o=n.details;if(S.logger.log("Loaded  "+r.sn+" of ["+o.startSN+" ,"+o.endSN+"],level "+r.level),this.bitrateTest=!1,this.stats=i,!0===a.bitrateTest&&this.hls.nextLoadLevel)this.state=T.IDLE,this.startFragRequested=!1,i.tparsed=i.tbuffered=performance.now(),this.hls.trigger(g.default.FRAG_BUFFERED,{stats:i,frag:r,id:"main"}),this.tick();else if("initSegment"===a.sn)this.state=T.IDLE,i.tparsed=i.tbuffered=performance.now(),o.initSegment.data=t.payload,this.hls.trigger(g.default.FRAG_BUFFERED,{stats:i,frag:r,id:"main"}),this.tick();else{this.state=T.PARSING;var s=o.totalduration,l=r.level,u=r.sn,d=this.config.defaultAudioCodec||n.audioCodec;this.audioCodecSwap&&(S.logger.log("swapping playlist audio codec"),void 0===d&&(d=this.lastAudioCodec),d&&(d=-1!==d.indexOf("mp4a.40.5")?"mp4a.40.2":"mp4a.40.5")),this.pendingBuffering=!0,this.appended=!1,S.logger.log("Parsing "+u+" of ["+o.startSN+" ,"+o.endSN+"],level "+l+", cc "+r.cc);var f=this.demuxer;f||(f=this.demuxer=new c.default(this.hls,"main"));var h=this.media,v=h&&h.seeking,p=!v&&(o.PTSKnown||!o.live),y=o.initSegment?o.initSegment.data:[];f.push(t.payload,y,d,n.videoCodec,r,s,p,void 0)}}this.fragLoadError=0}},{key:"onFragParsingInitSegment",value:function e(t){var r=this.fragCurrent,a=t.frag;if(r&&"main"===t.id&&a.sn===r.sn&&a.level===r.level&&this.state===T.PARSING){var i=t.tracks,n,o;if(i.audio&&this.altAudio&&delete i.audio,o=i.audio){var s=this.levels[this.level].audioCodec,l=navigator.userAgent.toLowerCase();s&&this.audioCodecSwap&&(S.logger.log("swapping playlist audio codec"),s=-1!==s.indexOf("mp4a.40.5")?"mp4a.40.2":"mp4a.40.5"),this.audioCodecSwitch&&1!==o.metadata.channelCount&&-1===l.indexOf("firefox")&&(s="mp4a.40.5"),-1!==l.indexOf("android")&&"audio/mpeg"!==o.container&&(s="mp4a.40.2",S.logger.log("Android: force audio codec to "+s)),o.levelCodec=s,o.id=t.id}o=i.video,o&&(o.levelCodec=this.levels[this.level].videoCodec,o.id=t.id),this.hls.trigger(g.default.BUFFER_CODECS,i);for(n in i){o=i[n],S.logger.log("main track:"+n+",container:"+o.container+",codecs[level/parsed]=["+o.levelCodec+"/"+o.codec+"]");var u=o.initSegment;u&&(this.appended=!0,this.pendingBuffering=!0,this.hls.trigger(g.default.BUFFER_APPENDING,{type:n,data:u,parent:"main",content:"initSegment"}))}this.tick()}}},{key:"onFragParsingData",value:function e(t){var r=this,a=this.fragCurrent,i=t.frag;if(a&&"main"===t.id&&i.sn===a.sn&&i.level===a.level&&("audio"!==t.type||!this.altAudio)&&this.state===T.PARSING){var n=this.levels[this.level],o=a;if(isNaN(t.endPTS)&&(t.endPTS=t.startPTS+a.duration,t.endDTS=t.startDTS+a.duration),S.logger.log("Parsed "+t.type+",PTS:["+t.startPTS.toFixed(3)+","+t.endPTS.toFixed(3)+"],DTS:["+t.startDTS.toFixed(3)+"/"+t.endDTS.toFixed(3)+"],nb:"+t.nb+",dropped:"+(t.dropped||0)),"video"===t.type)if(o.dropped=t.dropped,o.dropped){if(!o.backtracked)return S.logger.warn("missing video frame(s), backtracking fragment"),o.backtracked=!0,this.nextLoadPosition=t.startPTS,this.state=T.IDLE,this.fragPrevious=o,void this.tick();S.logger.warn("Already backtracked on this fragment, appending with the gap")}else o.backtracked=!1;var s=E.default.updateFragPTSDTS(n.details,o,t.startPTS,t.endPTS,t.startDTS,t.endDTS),l=this.hls;l.trigger(g.default.LEVEL_PTS_UPDATED,{details:n.details,level:this.level,drift:s,type:t.type,start:t.startPTS,end:t.endPTS}),[t.data1,t.data2].forEach(function(e){e&&e.length&&r.state===T.PARSING&&(r.appended=!0,r.pendingBuffering=!0,l.trigger(g.default.BUFFER_APPENDING,{type:t.type,data:e,parent:"main",content:"data"}))}),this.tick()}}},{key:"onFragParsed",value:function e(t){var r=this.fragCurrent,a=t.frag;r&&"main"===t.id&&a.sn===r.sn&&a.level===r.level&&this.state===T.PARSING&&(this.stats.tparsed=performance.now(),this.state=T.PARSED,this._checkAppendedParsed())}},{key:"onAudioTrackSwitching",value:function e(t){var r=!!t.url,a=t.id;if(!r){if(this.mediaBuffer!==this.media){S.logger.log("switching on main audio, use media.buffered to schedule main fragment loading"),this.mediaBuffer=this.media;var i=this.fragCurrent;i.loader&&(S.logger.log("switching to main audio track, cancel main fragment load"),i.loader.abort()),this.fragCurrent=null,this.fragPrevious=null,this.demuxer&&(this.demuxer.destroy(),this.demuxer=null),this.state=T.IDLE}var n=this.hls;n.trigger(g.default.BUFFER_FLUSHING,{startOffset:0,endOffset:Number.POSITIVE_INFINITY,type:"audio"}),n.trigger(g.default.AUDIO_TRACK_SWITCHED,{id:a}),this.altAudio=!1}}},{key:"onAudioTrackSwitched",value:function e(t){var r=t.id,a=!!this.hls.audioTracks[r].url;if(a){var i=this.videoBuffer;i&&this.mediaBuffer!==i&&(S.logger.log("switching on alternate audio, use video.buffered to schedule main fragment loading"),this.mediaBuffer=i)}this.altAudio=a,this.tick()}},{key:"onBufferCreated",value:function e(t){var r=t.tracks,a=void 0,i=void 0,n=!1;for(var o in r){var s=r[o];"main"===s.id?(i=o,a=s,"video"===o&&(this.videoBuffer=r[o].buffer)):n=!0}n&&a?(S.logger.log("alternate track found, use "+i+".buffered to schedule main fragment loading"),this.mediaBuffer=a.buffer):this.mediaBuffer=this.media}},{key:"onBufferAppended",value:function e(t){if("main"===t.parent){var r=this.state;r!==T.PARSING&&r!==T.PARSED||(this.pendingBuffering=t.pending>0,this._checkAppendedParsed())}}},{key:"_checkAppendedParsed",value:function e(){if(!(this.state!==T.PARSED||this.appended&&this.pendingBuffering)){var t=this.fragCurrent;if(t){var r=this.mediaBuffer?this.mediaBuffer:this.media;S.logger.log("main buffered : "+_.default.toString(r.buffered));var a=this._bufferedFrags.filter(function(e){return f.default.isBuffered(r,(e.startPTS+e.endPTS)/2)});a.push(t),this._bufferedFrags=a.sort(function(e,t){return e.startPTS-t.startPTS}),this.fragPrevious=t;var i=this.stats;i.tbuffered=performance.now(),this.fragLastKbps=Math.round(8*i.total/(i.tbuffered-i.tfirst)),this.hls.trigger(g.default.FRAG_BUFFERED,{stats:i,frag:t,id:"main"}),this.state=T.IDLE}this.tick()}}},{key:"onError",value:function e(t){var r=t.frag||this.fragCurrent;if(!r||"main"===r.type){var a=this.media,i=a&&f.default.isBuffered(a,a.currentTime)&&f.default.isBuffered(a,a.currentTime+.5);switch(t.details){case R.ErrorDetails.FRAG_LOAD_ERROR:case R.ErrorDetails.FRAG_LOAD_TIMEOUT:case R.ErrorDetails.KEY_LOAD_ERROR:case R.ErrorDetails.KEY_LOAD_TIMEOUT:if(!t.fatal){var n=this.fragLoadError;n?n++:n=1;var o=this.config;if(n<=o.fragLoadingMaxRetry||i||r.autoLevel&&r.level){this.fragLoadError=n,r.loadCounter=0;var s=Math.min(Math.pow(2,n-1)*o.fragLoadingRetryDelay,o.fragLoadingMaxRetryTimeout);S.logger.warn("mediaController: frag loading failed, retry in "+s+" ms"),this.retryDate=performance.now()+s,this.loadedmetadata||(this.startFragRequested=!1,this.nextLoadPosition=this.startPosition),this.state=T.FRAG_LOADING_WAITING_RETRY}else S.logger.error("mediaController: "+t.details+" reaches max retry, redispatch as fatal ..."),t.fatal=!0,this.state=T.ERROR}break;case R.ErrorDetails.FRAG_LOOP_LOADING_ERROR:t.fatal||(i?(this._reduceMaxBufferLength(r.duration),this.state=T.IDLE):r.autoLevel&&0!==r.level||(t.fatal=!0,this.state=T.ERROR));break;case R.ErrorDetails.LEVEL_LOAD_ERROR:case R.ErrorDetails.LEVEL_LOAD_TIMEOUT:this.state!==T.ERROR&&(t.fatal?(this.state=T.ERROR,S.logger.warn("streamController: "+t.details+",switch to "+this.state+" state ...")):t.levelRetry||this.state!==T.WAITING_LEVEL||(this.state=T.IDLE));break;case R.ErrorDetails.BUFFER_FULL_ERROR:"main"!==t.parent||this.state!==T.PARSING&&this.state!==T.PARSED||(i?(this._reduceMaxBufferLength(this.config.maxBufferLength),this.state=T.IDLE):(S.logger.warn("buffer full error also media.currentTime is not buffered, flush everything"),this.fragCurrent=null,this.flushMainBuffer(0,Number.POSITIVE_INFINITY)))}}}},{key:"_reduceMaxBufferLength",value:function e(t){var r=this.config;r.maxMaxBufferLength>=t&&(r.maxMaxBufferLength/=2,S.logger.warn("main:reduce max buffer length to "+r.maxMaxBufferLength+"s"),this.fragLoadIdx+=2*r.fragLoadingLoopThreshold)}},{key:"_checkBuffer",value:function e(){var t=this.media,r=this.config;if(t&&t.readyState){var a=t.currentTime,i=this.mediaBuffer?this.mediaBuffer:t,n=i.buffered;if(!this.loadedmetadata&&n.length){this.loadedmetadata=!0;var o=t.seeking?a:this.startPosition,s=f.default.isBuffered(i,o),l=n.start(0);(a!==o||!s&&Math.abs(o-l)<r.maxSeekHole)&&(S.logger.log("target start position:"+o),s||(o=l,S.logger.log("target start position not buffered, seek to buffered.start(0) "+o)),S.logger.log("adjust currentTime from "+a+" to "+o),t.currentTime=o)}else if(this.immediateSwitch)this.immediateLevelSwitchEnd();else{var u=f.default.bufferInfo(t,a,0),d=!(t.paused||t.ended||0===t.buffered.length),h=.5,c=a!==this.lastCurrentTime;if(c)this.stallReported&&(S.logger.warn("playback not stuck anymore @"+a+", after "+Math.round(performance.now()-this.stalled)+"ms"),this.stallReported=!1),this.stalled=void 0,this.nudgeRetry=0;else if(d){var v=performance.now(),p=this.hls;if(this.stalled){var y=v-this.stalled,m=u.len,E=this.nudgeRetry||0;if(m<=.5&&y>1e3*r.lowBufferWatchdogPeriod){this.stallReported||(this.stallReported=!0,S.logger.warn("playback stalling in low buffer @"+a),p.trigger(g.default.ERROR,{type:R.ErrorTypes.MEDIA_ERROR,details:R.ErrorDetails.BUFFER_STALLED_ERROR,fatal:!1,buffer:m}));var b=u.nextStart,_=b-a;if(b&&_<r.maxSeekHole&&_>0){this.nudgeRetry=++E;var T=E*r.nudgeOffset;S.logger.log("adjust currentTime from "+t.currentTime+" to next buffered @ "+b+" + nudge "+T),t.currentTime=b+T,this.stalled=void 0,p.trigger(g.default.ERROR,{type:R.ErrorTypes.MEDIA_ERROR,details:R.ErrorDetails.BUFFER_SEEK_OVER_HOLE,fatal:!1,hole:b+T-a})}}else if(m>.5&&y>1e3*r.highBufferWatchdogPeriod)if(this.stallReported||(this.stallReported=!0,S.logger.warn("playback stalling in high buffer @"+a),p.trigger(g.default.ERROR,{type:R.ErrorTypes.MEDIA_ERROR,details:R.ErrorDetails.BUFFER_STALLED_ERROR,fatal:!1,buffer:m})),this.stalled=void 0,this.nudgeRetry=++E,E<r.nudgeMaxRetry){var L=t.currentTime,A=L+E*r.nudgeOffset;S.logger.log("adjust currentTime from "+L+" to "+A),t.currentTime=A,p.trigger(g.default.ERROR,{type:R.ErrorTypes.MEDIA_ERROR,details:R.ErrorDetails.BUFFER_NUDGE_ON_STALL,fatal:!1})}else S.logger.error("still stuck in high buffer @"+a+" after "+r.nudgeMaxRetry+", raise fatal error"),p.trigger(g.default.ERROR,{type:R.ErrorTypes.MEDIA_ERROR,details:R.ErrorDetails.BUFFER_STALLED_ERROR,fatal:!0})}else this.stalled=v,this.stallReported=!1}}}}},{key:"onFragLoadEmergencyAborted",value:function e(){this.state=T.IDLE,this.loadedmetadata||(this.startFragRequested=!1,this.nextLoadPosition=this.startPosition),this.tick()}},{key:"onBufferFlushed",value:function e(){var t=this.mediaBuffer?this.mediaBuffer:this.media;this._bufferedFrags=this._bufferedFrags.filter(function(e){return f.default.isBuffered(t,(e.startPTS+e.endPTS)/2)}),this.fragLoadIdx+=2*this.config.fragLoadingLoopThreshold,this.state=T.IDLE,this.fragPrevious=null}},{key:"swapAudioCodec",value:function e(){this.audioCodecSwap=!this.audioCodecSwap}},{key:"computeLivePosition",value:function e(t,r){var a=void 0!==this.config.liveSyncDuration?this.config.liveSyncDuration:this.config.liveSyncDurationCount*r.targetduration;return t+Math.max(0,r.totalduration-a)}},{key:"state",set:function e(t){if(this.state!==t){var r=this.state;this._state=t,S.logger.log("main stream:"+r+"->"+t),this.hls.trigger(g.default.STREAM_STATE_TRANSITION,{previousState:r,nextState:t})}},get:function e(){return this._state}},{key:"currentLevel",get:function e(){var t=this.media;if(t){var r=this.getBufferedFrag(t.currentTime);if(r)return r.level}return-1}},{key:"nextBufferedFrag",get:function e(){var t=this.media;return t?this.followingBufferedFrag(this.getBufferedFrag(t.currentTime)):null}},{key:"nextLevel",get:function e(){var t=this.nextBufferedFrag;return t?t.level:-1}},{key:"liveSyncPosition",get:function e(){return this._liveSyncPosition},set:function e(t){this._liveSyncPosition=t}}]),t}(y.default);r.default=L},{20:20,28:28,29:29,30:30,32:32,33:33,43:43,46:46,47:47}],12:[function(e,t,r){"use strict";function a(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(r,"__esModule",{value:!0});var i=function(){function e(e,t){for(var r=0;r<t.length;r++){var a=t[r];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}return function(t,r,a){return r&&e(t.prototype,r),a&&e(t,a),t}}(),n=function(){function e(t,r){a(this,e),this.subtle=t,this.aesIV=r}return i(e,[{key:"decrypt",value:function e(t,r){return this.subtle.decrypt({name:"AES-CBC",iv:this.aesIV},r,t)}}]),e}();r.default=n},{}],13:[function(e,t,r){"use strict";function a(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(r,"__esModule",{value:!0});var i=function(){function e(e,t){for(var r=0;r<t.length;r++){var a=t[r];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}return function(t,r,a){return r&&e(t.prototype,r),a&&e(t,a),t}}(),n=function(){function e(){a(this,e),this.rcon=[0,1,2,4,8,16,32,64,128,27,54],this.subMix=[new Uint32Array(256),new Uint32Array(256),new Uint32Array(256),new Uint32Array(256)],this.invSubMix=[new Uint32Array(256),new Uint32Array(256),new Uint32Array(256),new Uint32Array(256)],this.sBox=new Uint32Array(256),this.invSBox=new Uint32Array(256),this.key=new Uint32Array(0),this.initTable()}return i(e,[{key:"uint8ArrayToUint32Array_",value:function e(t){for(var r=new DataView(t),a=new Uint32Array(4),i=0;i<4;i++)a[i]=r.getUint32(4*i);return a}},{key:"initTable",value:function e(){var t=this.sBox,r=this.invSBox,a=this.subMix,i=a[0],n=a[1],o=a[2],s=a[3],l=this.invSubMix,u=l[0],d=l[1],f=l[2],h=l[3],c=new Uint32Array(256),v=0,g=0,p=0;for(p=0;p<256;p++)c[p]=p<128?p<<1:p<<1^283;for(p=0;p<256;p++){var y=g^g<<1^g<<2^g<<3^g<<4;y=y>>>8^255&y^99,t[v]=y,r[y]=v;var m=c[v],E=c[m],b=c[E],_=257*c[y]^16843008*y;i[v]=_<<24|_>>>8,n[v]=_<<16|_>>>16,o[v]=_<<8|_>>>24,s[v]=_,_=16843009*b^65537*E^257*m^16843008*v,u[y]=_<<24|_>>>8,d[y]=_<<16|_>>>16,f[y]=_<<8|_>>>24,h[y]=_,v?(v=m^c[c[c[b^m]]],g^=c[c[g]]):v=g=1}}},{key:"expandKey",value:function e(t){for(var r=this.uint8ArrayToUint32Array_(t),a=!0,i=0;i<r.length&&a;)a=r[i]===this.key[i],i++;if(!a){this.key=r;var n=this.keySize=r.length;if(4!==n&&6!==n&&8!==n)throw new Error("Invalid aes key size="+n);var o=this.ksRows=4*(n+6+1),s=void 0,l=void 0,u=this.keySchedule=new Uint32Array(o),d=this.invKeySchedule=new Uint32Array(o),f=this.sBox,h=this.rcon,c=this.invSubMix,v=c[0],g=c[1],p=c[2],y=c[3],m=void 0,E=void 0;for(s=0;s<o;s++)s<n?m=u[s]=r[s]:(E=m,s%n==0?(E=E<<8|E>>>24,E=f[E>>>24]<<24|f[E>>>16&255]<<16|f[E>>>8&255]<<8|f[255&E],E^=h[s/n|0]<<24):n>6&&s%n==4&&(E=f[E>>>24]<<24|f[E>>>16&255]<<16|f[E>>>8&255]<<8|f[255&E]),u[s]=m=(u[s-n]^E)>>>0);for(l=0;l<o;l++)s=o-l,E=3&l?u[s]:u[s-4],d[l]=l<4||s<=4?E:v[f[E>>>24]]^g[f[E>>>16&255]]^p[f[E>>>8&255]]^y[f[255&E]],d[l]=d[l]>>>0}}},{key:"networkToHostOrderSwap",value:function e(t){return t<<24|(65280&t)<<8|(16711680&t)>>8|t>>>24}},{key:"decrypt",value:function e(t,r,a){for(var i=this.keySize+6,n=this.invKeySchedule,o=this.invSBox,s=this.invSubMix,l=s[0],u=s[1],d=s[2],f=s[3],h=this.uint8ArrayToUint32Array_(a),c=h[0],v=h[1],g=h[2],p=h[3],y=new Int32Array(t),m=new Int32Array(y.length),E=void 0,b=void 0,_=void 0,R=void 0,S=void 0,T=void 0,L=void 0,A=void 0,k=void 0,D=void 0,w=void 0,O=void 0,P,C,M=this.networkToHostOrderSwap;r<y.length;){for(k=M(y[r]),D=M(y[r+1]),w=M(y[r+2]),O=M(y[r+3]),S=k^n[0],T=O^n[1],L=w^n[2],A=D^n[3],P=4,C=1;C<i;C++)E=l[S>>>24]^u[T>>16&255]^d[L>>8&255]^f[255&A]^n[P],b=l[T>>>24]^u[L>>16&255]^d[A>>8&255]^f[255&S]^n[P+1],_=l[L>>>24]^u[A>>16&255]^d[S>>8&255]^f[255&T]^n[P+2],R=l[A>>>24]^u[S>>16&255]^d[T>>8&255]^f[255&L]^n[P+3],S=E,T=b,L=_,A=R,P+=4;E=o[S>>>24]<<24^o[T>>16&255]<<16^o[L>>8&255]<<8^o[255&A]^n[P],b=o[T>>>24]<<24^o[L>>16&255]<<16^o[A>>8&255]<<8^o[255&S]^n[P+1],_=o[L>>>24]<<24^o[A>>16&255]<<16^o[S>>8&255]<<8^o[255&T]^n[P+2],R=o[A>>>24]<<24^o[S>>16&255]<<16^o[T>>8&255]<<8^o[255&L]^n[P+3],P+=3,m[r]=M(E^c),m[r+1]=M(R^v),m[r+2]=M(_^g),m[r+3]=M(b^p),c=k,v=D,g=w,p=O,r+=4}return m.buffer}},{key:"destroy",value:function e(){this.key=void 0,this.keySize=void 0,this.ksRows=void 0,this.sBox=void 0,this.invSBox=void 0,this.subMix=void 0,this.invSubMix=void 0,this.keySchedule=void 0,this.invKeySchedule=void 0,this.rcon=void 0}}]),e}();r.default=n},{}],14:[function(e,t,r){"use strict";function a(e){return e&&e.__esModule?e:{default:e}}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(r,"__esModule",{value:!0});var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var a=t[r];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}return function(t,r,a){return r&&e(t.prototype,r),a&&e(t,a),t}}(),o=e(12),s=a(o),l=e(15),u=a(l),d=e(13),f=a(d),h=e(28),c=e(46),v=function(){function e(t,r){i(this,e),this.observer=t,this.config=r,this.logEnabled=!0;try{var a=crypto||self.crypto;this.subtle=a.subtle||a.webkitSubtle}catch(e){}this.disableWebCrypto=!this.subtle}return n(e,[{key:"isSync",value:function e(){return this.disableWebCrypto&&this.config.enableSoftwareAES}},{key:"decrypt",value:function e(t,r,a,i){var n=this;if(this.disableWebCrypto&&this.config.enableSoftwareAES){this.logEnabled&&(c.logger.log("JS AES decrypt"),this.logEnabled=!1);var o=this.decryptor;o||(this.decryptor=o=new f.default),o.expandKey(r),i(o.decrypt(t,0,a))}else{this.logEnabled&&(c.logger.log("WebCrypto AES decrypt"),this.logEnabled=!1);var l=this.subtle;this.key!==r&&(this.key=r,this.fastAesKey=new u.default(l,r)),this.fastAesKey.expandKey().then(function(e){var o=new s.default(l,a);o.decrypt(t,e).catch(function(e){n.onWebCryptoError(e,t,r,a,i)}).then(function(e){i(e)})}).catch(function(e){n.onWebCryptoError(e,t,r,a,i)})}}},{key:"onWebCryptoError",value:function e(t,r,a,i,n){this.config.enableSoftwareAES?(c.logger.log("WebCrypto Error, disable WebCrypto API"),this.disableWebCrypto=!0,this.logEnabled=!0,this.decrypt(r,a,i,n)):(c.logger.error("decrypting error : "+t.message),this.observer.trigger(Event.ERROR,{type:h.ErrorTypes.MEDIA_ERROR,details:h.ErrorDetails.FRAG_DECRYPT_ERROR,fatal:!0,reason:t.message}))}},{key:"destroy",value:function e(){var t=this.decryptor;t&&(t.destroy(),this.decryptor=void 0)}}]),e}();r.default=v},{12:12,13:13,15:15,28:28,46:46}],15:[function(e,t,r){"use strict";function a(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(r,"__esModule",{value:!0});var i=function(){function e(e,t){for(var r=0;r<t.length;r++){var a=t[r];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}return function(t,r,a){return r&&e(t.prototype,r),a&&e(t,a),t}}(),n=function(){function e(t,r){a(this,e),this.subtle=t,this.key=r}return i(e,[{key:"expandKey",value:function e(){return this.subtle.importKey("raw",this.key,{name:"AES-CBC"},!1,["encrypt","decrypt"])}}]),e}();r.default=n},{}],16:[function(e,t,r){"use strict";function a(e){return e&&e.__esModule?e:{default:e}}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(r,"__esModule",{value:!0});var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var a=t[r];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}return function(t,r,a){return r&&e(t.prototype,r),a&&e(t,a),t}}(),o=e(17),s=a(o),l=e(46),u=e(22),d=a(u),f=function(){function e(t,r,a){i(this,e),this.observer=t,this.config=a,this.remuxer=r}return n(e,[{key:"resetInitSegment",value:function e(t,r,a,i){this._audioTrack={container:"audio/adts",type:"audio",id:-1,sequenceNumber:0,isAAC:!0,samples:[],len:0,manifestCodec:r,duration:i,inputTimeScale:9e4}}},{key:"resetTimeStamp",value:function e(){}},{key:"append",value:function e(t,r,a,i){for(var n=this._audioTrack,o=d.default.getID3Data(t,0),u=90*d.default.getTimeStamp(o),f=0,h=u,c=t.length,v=o.length,g=[{pts:h,dts:h,data:o}];v<c-1;)if(s.default.isHeader(t,v)&&v+5<c){s.default.initTrackConfig(n,this.observer,t,v,n.manifestCodec);var p=s.default.appendFrame(n,t,v,u,f);if(!p){l.logger.log("Unable to parse AAC frame");break}v+=p.length,h=p.sample.pts,f++}else d.default.isHeader(t,v)?(o=d.default.getID3Data(t,v),g.push({pts:h,dts:h,data:o}),v+=o.length):v++;this.remuxer.remux(n,{samples:[]},{samples:g,inputTimeScale:9e4},{samples:[]},r,a,i)}},{key:"destroy",value:function e(){}}],[{key:"probe",value:function e(t){var r,a,i=d.default.getID3Data(t,0);if(i&&void 0!==d.default.getTimeStamp(i))for(r=i.length,a=Math.min(t.length-1,r+100);r<a;r++)if(s.default.isHeader(t,r))return!0;return!1}}]),e}();r.default=f},{17:17,22:22,46:46}],17:[function(e,t,r){"use strict";var a=e(46),i=e(28),n={getAudioConfig:function e(t,r,n,o){var s,l,u,d,f,h=navigator.userAgent.toLowerCase(),c=o,v=[96e3,88200,64e3,48e3,44100,32e3,24e3,22050,16e3,12e3,11025,8e3,7350];return s=1+((192&r[n+2])>>>6),(l=(60&r[n+2])>>>2)>v.length-1?void t.trigger(Event.ERROR,{type:i.ErrorTypes.MEDIA_ERROR,details:i.ErrorDetails.FRAG_PARSING_ERROR,fatal:!0,reason:"invalid ADTS sampling index:"+l}):(d=(1&r[n+2])<<2,d|=(192&r[n+3])>>>6,a.logger.log("manifest codec:"+o+",ADTS data:type:"+s+",sampleingIndex:"+l+"["+v[l]+"Hz],channelConfig:"+d),/firefox/i.test(h)?l>=6?(s=5,f=new Array(4),u=l-3):(s=2,f=new Array(2),u=l):-1!==h.indexOf("android")?(s=2,f=new Array(2),u=l):(s=5,f=new Array(4),o&&(-1!==o.indexOf("mp4a.40.29")||-1!==o.indexOf("mp4a.40.5"))||!o&&l>=6?u=l-3:((o&&-1!==o.indexOf("mp4a.40.2")&&l>=6&&1===d||!o&&1===d)&&(s=2,f=new Array(2)),u=l)),f[0]=s<<3,f[0]|=(14&l)>>1,f[1]|=(1&l)<<7,f[1]|=d<<3,5===s&&(f[1]|=(14&u)>>1,f[2]=(1&u)<<7,f[2]|=8,f[3]=0),{config:f,samplerate:v[l],channelCount:d,codec:"mp4a.40."+s,manifestCodec:c})},isHeader:function e(t,r){return r+1<t.length&&255===t[r]&&240==(246&t[r+1])},initTrackConfig:function e(t,r,i,n,o){if(!t.samplerate){var s=this.getAudioConfig(r,i,n,o);t.config=s.config,t.samplerate=s.samplerate,t.channelCount=s.channelCount,t.codec=s.codec,t.manifestCodec=s.manifestCodec,a.logger.log("parsed codec:"+t.codec+",rate:"+s.samplerate+",nb channel:"+s.channelCount)}},getFrameDuration:function e(t){return 9216e4/t},appendFrame:function e(t,r,a,i,n){var o=this.getFrameDuration(t.samplerate),s=this.parseFrameHeader(r,a,i,n,o);if(s){var l=s.stamp,u=s.headerLength,d=s.frameLength,f={unit:r.subarray(a+u,a+u+d),pts:l,dts:l};return t.samples.push(f),t.len+=d,{sample:f,length:d+u}}},parseFrameHeader:function e(t,r,a,i,n){var o,s,l,u=t.length;if(o=1&t[r+1]?7:9,s=(3&t[r+3])<<11|t[r+4]<<3|(224&t[r+5])>>>5,(s-=o)>0&&r+o+s<=u)return l=a+i*n,{headerLength:o,frameLength:s,stamp:l}}};t.exports=n},{28:28,46:46}],18:[function(e,t,r){"use strict";function a(e){return e&&e.__esModule?e:{default:e}}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(r,"__esModule",{value:!0});var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var a=t[r];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}return function(t,r,a){return r&&e(t.prototype,r),a&&e(t,a),t}}(),o=e(30),s=a(o),l=e(28),u=e(14),d=a(u),f=e(16),h=a(f),c=e(24),v=a(c),g=e(27),p=a(g),y=e(23),m=a(y),E=e(40),b=a(E),_=e(41),R=a(_),S=function(){function e(t,r,a,n){i(this,e),this.observer=t,this.typeSupported=r,this.config=a,this.vendor=n}return n(e,[{key:"destroy",value:function e(){var t=this.demuxer;t&&t.destroy()}},{key:"push",value:function e(t,r,a,i,n,o,l,u,f,h,c,v){if(t.byteLength>0&&null!=r&&null!=r.key&&"AES-128"===r.method){var g=this.decrypter;null==g&&(g=this.decrypter=new d.default(this.observer,this.config));var p=this,y;try{y=performance.now()}catch(e){y=Date.now()}g.decrypt(t,r.key.buffer,r.iv.buffer,function(e){var t;try{t=performance.now()}catch(e){t=Date.now()}p.observer.trigger(s.default.FRAG_DECRYPTED,{stats:{tstart:y,tdecrypt:t}}),p.pushDecrypted(new Uint8Array(e),r,new Uint8Array(a),i,n,o,l,u,f,h,c,v)})}else this.pushDecrypted(new Uint8Array(t),r,new Uint8Array(a),i,n,o,l,u,f,h,c,v)}},{key:"pushDecrypted",value:function e(t,r,a,i,n,o,u,d,f,c,g,y){var E=this.demuxer;if(!E||u&&!this.probe(t)){var _=this.observer,S=this.typeSupported,T=this.config,L=[{demux:p.default,remux:b.default},{demux:m.default,remux:b.default},{demux:h.default,remux:b.default},{demux:v.default,remux:R.default}];for(var A in L){var k=L[A],D=k.demux.probe;if(D(t)){var w=this.remuxer=new k.remux(_,T,S,this.vendor);E=new k.demux(_,w,T,S),this.probe=D;break}}if(!E)return void _.trigger(s.default.ERROR,{type:l.ErrorTypes.MEDIA_ERROR,details:l.ErrorDetails.FRAG_PARSING_ERROR,fatal:!0,reason:"no demux matching with content found"});this.demuxer=E}var O=this.remuxer;(u||d)&&(E.resetInitSegment(a,i,n,c),O.resetInitSegment()),u&&(E.resetTimeStamp(y),O.resetTimeStamp(y)),"function"==typeof E.setDecryptData&&E.setDecryptData(r),E.append(t,o,f,g)}}]),e}();r.default=S},{14:14,16:16,23:23,24:24,27:27,28:28,30:30,40:40,41:41}],19:[function(e,t,r){"use strict";function a(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(r,"__esModule",{value:!0});var i=e(18),n=a(i),o=e(30),s=a(o),l=e(46),u=e(1),d=a(u),f=function e(t){var r=new d.default;r.trigger=function e(t){for(var a=arguments.length,i=Array(a>1?a-1:0),n=1;n<a;n++)i[n-1]=arguments[n];r.emit.apply(r,[t,t].concat(i))},r.off=function e(t){for(var a=arguments.length,i=Array(a>1?a-1:0),n=1;n<a;n++)i[n-1]=arguments[n];r.removeListener.apply(r,[t].concat(i))};var a=function e(r,a){t.postMessage({event:r,data:a})};t.addEventListener("message",function(e){var i=e.data;switch(i.cmd){case"init":var o=JSON.parse(i.config);t.demuxer=new n.default(r,i.typeSupported,o,i.vendor);try{(0,l.enableLogs)(!0===o.debug)}catch(e){console.warn("demuxerWorker: unable to enable logs")}a("init",null);break;case"demux":t.demuxer.push(i.data,i.decryptdata,i.initSegment,i.audioCodec,i.videoCodec,i.timeOffset,i.discontinuity,i.trackSwitch,i.contiguous,i.duration,i.accurateTimeOffset,i.defaultInitPTS)}}),r.on(s.default.FRAG_DECRYPTED,a),r.on(s.default.FRAG_PARSING_INIT_SEGMENT,a),r.on(s.default.FRAG_PARSED,a),r.on(s.default.ERROR,a),r.on(s.default.FRAG_PARSING_METADATA,a),r.on(s.default.FRAG_PARSING_USERDATA,a),r.on(s.default.INIT_PTS_FOUND,a),r.on(s.default.FRAG_PARSING_DATA,function(e,r){var a=[],i={event:e,data:r};r.data1&&(i.data1=r.data1.buffer,a.push(r.data1.buffer),delete r.data1),r.data2&&(i.data2=r.data2.buffer,a.push(r.data2.buffer),delete r.data2),t.postMessage(i,a)})};r.default=f},{1:1,18:18,30:30,46:46}],20:[function(e,t,r){"use strict";function a(e){return e&&e.__esModule?e:{default:e}}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(r,"__esModule",{value:!0});var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var a=t[r];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}return function(t,r,a){return r&&e(t.prototype,r),a&&e(t,a),t}}(),o=e(30),s=a(o),l=e(18),u=a(l),d=e(19),f=a(d),h=e(46),c=e(28),v=e(1),g=a(v),p=function(){function t(r,a){i(this,t),this.hls=r,this.id=a;var n=this.observer=new g.default,o=r.config;n.trigger=function e(t){for(var r=arguments.length,a=Array(r>1?r-1:0),i=1;i<r;i++)a[i-1]=arguments[i];n.emit.apply(n,[t,t].concat(a))},n.off=function e(t){for(var r=arguments.length,a=Array(r>1?r-1:0),i=1;i<r;i++)a[i-1]=arguments[i];n.removeListener.apply(n,[t].concat(a))};var l=function(e,t){t=t||{},t.frag=this.frag,t.id=this.id,r.trigger(e,t)}.bind(this);n.on(s.default.FRAG_DECRYPTED,l),n.on(s.default.FRAG_PARSING_INIT_SEGMENT,l),n.on(s.default.FRAG_PARSING_DATA,l),n.on(s.default.FRAG_PARSED,l),n.on(s.default.ERROR,l),n.on(s.default.FRAG_PARSING_METADATA,l),n.on(s.default.FRAG_PARSING_USERDATA,l),n.on(s.default.INIT_PTS_FOUND,l);var d={mp4:MediaSource.isTypeSupported("video/mp4"),mpeg:MediaSource.isTypeSupported("audio/mpeg"),mp3:MediaSource.isTypeSupported('audio/mp4; codecs="mp3"')},v=navigator.vendor;if(o.enableWorker&&"undefined"!=typeof Worker){h.logger.log("demuxing in webworker");var p=void 0;try{var y=e(3);p=this.w=y(f.default),this.onwmsg=this.onWorkerMessage.bind(this),p.addEventListener("message",this.onwmsg),p.onerror=function(e){r.trigger(s.default.ERROR,{type:c.ErrorTypes.OTHER_ERROR,details:c.ErrorDetails.INTERNAL_EXCEPTION,fatal:!0,event:"demuxerWorker",err:{message:e.message+" ("+e.filename+":"+e.lineno+")"}})},p.postMessage({cmd:"init",typeSupported:d,vendor:v,id:a,config:JSON.stringify(o)})}catch(e){h.logger.error("error while initializing DemuxerWorker, fallback on DemuxerInline"),p&&URL.revokeObjectURL(p.objectURL),this.demuxer=new u.default(n,d,o,v),this.w=void 0}}else this.demuxer=new u.default(n,d,o,v)}return n(t,[{key:"destroy",value:function e(){var t=this.w;if(t)t.removeEventListener("message",this.onwmsg),t.terminate(),this.w=null;else{var r=this.demuxer;r&&(r.destroy(),this.demuxer=null)}var a=this.observer;a&&(a.removeAllListeners(),this.observer=null)}},{key:"push",value:function e(t,r,a,i,n,o,s,l){var u=this.w,d=isNaN(n.startDTS)?n.start:n.startDTS,f=n.decryptdata,c=this.frag,v=!(c&&n.cc===c.cc),g=!(c&&n.level===c.level),p=c&&n.sn===c.sn+1,y=!g&&p;if(v&&h.logger.log(this.id+":discontinuity detected"),g&&h.logger.log(this.id+":switch detected"),this.frag=n,u)u.postMessage({cmd:"demux",data:t,decryptdata:f,initSegment:r,audioCodec:a,videoCodec:i,timeOffset:d,discontinuity:v,trackSwitch:g,contiguous:y,duration:o,accurateTimeOffset:s,defaultInitPTS:l},[t]);else{var m=this.demuxer;m&&m.push(t,f,r,a,i,d,v,g,y,o,s,l)}}},{key:"onWorkerMessage",value:function e(t){var r=t.data,a=this.hls;switch(r.event){case"init":URL.revokeObjectURL(this.w.objectURL);break;case s.default.FRAG_PARSING_DATA:r.data.data1=new Uint8Array(r.data1),r.data2&&(r.data.data2=new Uint8Array(r.data2));default:r.data=r.data||{},r.data.frag=this.frag,r.data.id=this.id,a.trigger(r.event,r.data)}}}]),t}();r.default=p},{1:1,18:18,19:19,28:28,3:3,30:30,46:46}],21:[function(e,t,r){"use strict";function a(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(r,"__esModule",{value:!0});var i=function(){function e(e,t){for(var r=0;r<t.length;r++){var a=t[r];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}return function(t,r,a){return r&&e(t.prototype,r),a&&e(t,a),t}}(),n=e(46),o=function(){function e(t){a(this,e),this.data=t,this.bytesAvailable=t.byteLength,this.word=0,this.bitsAvailable=0}return i(e,[{key:"loadWord",value:function e(){var t=this.data,r=this.bytesAvailable,a=t.byteLength-r,i=new Uint8Array(4),n=Math.min(4,r);if(0===n)throw new Error("no bytes available");i.set(t.subarray(a,a+n)),this.word=new DataView(i.buffer).getUint32(0),this.bitsAvailable=8*n,this.bytesAvailable-=n}},{key:"skipBits",value:function e(t){var r;this.bitsAvailable>t?(this.word<<=t,this.bitsAvailable-=t):(t-=this.bitsAvailable,r=t>>3,t-=r>>3,this.bytesAvailable-=r,this.loadWord(),this.word<<=t,this.bitsAvailable-=t)}},{key:"readBits",value:function e(t){var r=Math.min(this.bitsAvailable,t),a=this.word>>>32-r;return t>32&&n.logger.error("Cannot read more than 32 bits at a time"),this.bitsAvailable-=r,this.bitsAvailable>0?this.word<<=r:this.bytesAvailable>0&&this.loadWord(),r=t-r,r>0&&this.bitsAvailable?a<<r|this.readBits(r):a}},{key:"skipLZ",value:function e(){var t;for(t=0;t<this.bitsAvailable;++t)if(0!=(this.word&2147483648>>>t))return this.word<<=t,this.bitsAvailable-=t,t;return this.loadWord(),t+this.skipLZ()}},{key:"skipUEG",value:function e(){this.skipBits(1+this.skipLZ())}},{key:"skipEG",value:function e(){this.skipBits(1+this.skipLZ())}},{key:"readUEG",value:function e(){var t=this.skipLZ();return this.readBits(t+1)-1}},{key:"readEG",value:function e(){var t=this.readUEG();return 1&t?1+t>>>1:-1*(t>>>1)}},{key:"readBoolean",value:function e(){return 1===this.readBits(1)}},{key:"readUByte",value:function e(){return this.readBits(8)}},{key:"readUShort",value:function e(){return this.readBits(16)}},{key:"readUInt",value:function e(){return this.readBits(32)}},{key:"skipScalingList",value:function e(t){var r=8,a=8,i,n;for(i=0;i<t;i++)0!==a&&(n=this.readEG(),a=(r+n+256)%256),r=0===a?r:a}},{key:"readSPS",value:function e(){var t=0,r=0,a=0,i=0,n,o,s,l,u,d,f,h,c,v=this.readUByte.bind(this),g=this.readBits.bind(this),p=this.readUEG.bind(this),y=this.readBoolean.bind(this),m=this.skipBits.bind(this),E=this.skipEG.bind(this),b=this.skipUEG.bind(this),_=this.skipScalingList.bind(this);if(v(),n=v(),o=g(5),m(3),s=v(),b(),100===n||110===n||122===n||244===n||44===n||83===n||86===n||118===n||128===n){var R=p();if(3===R&&m(1),b(),b(),m(1),y())for(h=3!==R?8:12,c=0;c<h;c++)y()&&_(c<6?16:64)}b();var S=p();if(0===S)p();else if(1===S)for(m(1),E(),E(),l=p(),c=0;c<l;c++)E();b(),m(1),u=p(),d=p(),f=g(1),0===f&&m(1),m(1),y()&&(t=p(),r=p(),a=p(),i=p());var T=[1,1];if(y()&&y()){var L=v();switch(L){case 1:T=[1,1];break;case 2:T=[12,11];break;case 3:T=[10,11];break;case 4:T=[16,11];break;case 5:T=[40,33];break;case 6:T=[24,11];break;case 7:T=[20,11];break;case 8:T=[32,11];break;case 9:T=[80,33];break;case 10:T=[18,11];break;case 11:T=[15,11];break;case 12:T=[64,33];break;case 13:T=[160,99];break;case 14:T=[4,3];break;case 15:T=[3,2];break;case 16:T=[2,1];break;case 255:T=[v()<<8|v(),v()<<8|v()]}}return{width:Math.ceil(16*(u+1)-2*t-2*r),height:(2-f)*(d+1)*16-(f?2:4)*(a+i),pixelRatio:T}}},{key:"readSliceType",value:function e(){return this.readUByte(),this.readUEG(),this.readUEG()}}]),e}();r.default=o},{46:46}],22:[function(e,t,r){"use strict";function a(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(r,"__esModule",{value:!0});var i=function(){function e(e,t){for(var r=0;r<t.length;r++){var a=t[r];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}return function(t,r,a){return r&&e(t.prototype,r),a&&e(t,a),t}}(),n=function(){function e(){a(this,e)}return i(e,null,[{key:"isHeader",value:function e(t,r){return r+10<=t.length&&73===t[r]&&68===t[r+1]&&51===t[r+2]&&t[r+3]<255&&t[r+4]<255&&t[r+6]<128&&t[r+7]<128&&t[r+8]<128&&t[r+9]<128}},{key:"isFooter",value:function e(t,r){return r+10<=t.length&&51===t[r]&&68===t[r+1]&&73===t[r+2]&&t[r+3]<255&&t[r+4]<255&&t[r+6]<128&&t[r+7]<128&&t[r+8]<128&&t[r+9]<128}},{key:"getID3Data",value:function t(r,a){for(var i=a,n=0;e.isHeader(r,a);){n+=10;var o=e._readSize(r,a+6);n+=o,e.isFooter(r,a+10)&&(n+=10),a+=n}if(n>0)return r.subarray(i,i+n)}},{key:"_readSize",value:function e(t,r){var a=0;return a=(127&t[r])<<21,a|=(127&t[r+1])<<14,a|=(127&t[r+2])<<7,a|=127&t[r+3]}},{key:"getTimeStamp",value:function t(r){for(var a=e.getID3Frames(r),i=0;i<a.length;i++){var n=a[i];if(e.isTimeStampFrame(n))return e._readTimeStamp(n)}}},{key:"isTimeStampFrame",value:function e(t){return t&&"PRIV"===t.key&&"com.apple.streaming.transportStreamTimestamp"===t.info}},{key:"_getFrameData",value:function t(r){var a=String.fromCharCode(r[0],r[1],r[2],r[3]),i=e._readSize(r,4),n=10;return{type:a,size:i,data:r.subarray(10,10+i)}}},{key:"getID3Frames",value:function t(r){for(var a=0,i=[];e.isHeader(r,a);){var n=e._readSize(r,a+6);a+=10;for(var o=a+n;a+8<o;){var s=e._getFrameData(r.subarray(a)),l=e._decodeFrame(s);l&&i.push(l),a+=s.size+10}e.isFooter(r,a)&&(a+=10)}return i}},{key:"_decodeFrame",value:function t(r){return"PRIV"===r.type?e._decodePrivFrame(r):"T"===r.type[0]?e._decodeTextFrame(r):"W"===r.type[0]?e._decodeURLFrame(r):void 0}},{key:"_readTimeStamp",value:function e(t){if(8===t.data.byteLength){var r=new Uint8Array(t.data),a=1&r[3],i=(r[4]<<23)+(r[5]<<15)+(r[6]<<7)+r[7];return i/=45,a&&(i+=47721858.84),Math.round(i)}}},{key:"_decodePrivFrame",value:function t(r){if(!(r.size<2)){var a=e._utf8ArrayToStr(r.data),i=new Uint8Array(r.data.subarray(a.length+1));return{key:r.type,info:a,data:i.buffer}}}},{key:"_decodeTextFrame",value:function t(r){if(!(r.size<2)){if("TXXX"===r.type){var a=1,i=e._utf8ArrayToStr(r.data.subarray(a));a+=i.length+1;var n=e._utf8ArrayToStr(r.data.subarray(a));return{key:r.type,info:i,data:n}}var o=e._utf8ArrayToStr(r.data.subarray(1));return{key:r.type,data:o}}}},{key:"_decodeURLFrame",value:function t(r){if("WXXX"===r.type){if(r.size<2)return;var a=1,i=e._utf8ArrayToStr(r.data.subarray(a));a+=i.length+1;var n=e._utf8ArrayToStr(r.data.subarray(a));return{key:r.type,info:i,data:n}}var o=e._utf8ArrayToStr(r.data);return{key:r.type,data:o}}},{key:"_utf8ArrayToStr",value:function e(t){for(var r=void 0,a=void 0,i="",n=0,o=t.length;n<o;){var s=t[n++];switch(s>>4){case 0:return i;case 1:case 2:case 3:case 4:case 5:case 6:case 7:i+=String.fromCharCode(s);break;case 12:case 13:r=t[n++],i+=String.fromCharCode((31&s)<<6|63&r);break;case 14:r=t[n++],a=t[n++],i+=String.fromCharCode((15&s)<<12|(63&r)<<6|(63&a)<<0)}}return i}}]),e}();r.default=n},{}],23:[function(e,t,r){"use strict";function a(e){return e&&e.__esModule?e:{default:e}}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(r,"__esModule",{value:!0});var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var a=t[r];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}return function(t,r,a){return r&&e(t.prototype,r),a&&e(t,a),t}}(),o=e(22),s=a(o),l=e(25),u=a(l),d=function(){function e(t,r,a){i(this,e),this.observer=t,this.config=a,this.remuxer=r}return n(e,[{key:"resetInitSegment",value:function e(t,r,a,i){this._audioTrack={container:"audio/mpeg",type:"audio",id:-1,sequenceNumber:0,isAAC:!1,samples:[],len:0,manifestCodec:r,duration:i,inputTimeScale:9e4}}},{key:"resetTimeStamp",value:function e(){}},{key:"append",value:function e(t,r,a,i){for(var n=s.default.getID3Data(t,0),o=90*s.default.getTimeStamp(n),l=n.length,d=t.length,f=0,h=0,c=this._audioTrack,v=[{pts:o,dts:o,data:n}];l<d;)if(u.default.isHeader(t,l)){var g=u.default.appendFrame(c,t,l,o,f);if(!g)break;l+=g.length,h=g.sample.pts,f++}else s.default.isHeader(t,l)?(n=s.default.getID3Data(t,l),v.push({pts:h,dts:h,data:n}),l+=n.length):l++;this.remuxer.remux(c,{samples:[]},{samples:v,inputTimeScale:9e4},{samples:[]},r,a,i)}},{key:"destroy",value:function e(){}}],[{key:"probe",value:function e(t){var r,a,i=s.default.getID3Data(t,0);if(i&&void 0!==s.default.getTimeStamp(i))for(r=i.length,a=Math.min(t.length-1,r+100);r<a;r++)if(u.default.isHeader(t,r))return!0;return!1}}]),e}();r.default=d},{22:22,25:25}],24:[function(e,t,r){"use strict";function a(e){return e&&e.__esModule?e:{default:e}}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(r,"__esModule",{value:!0});var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var a=t[r];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}return function(t,r,a){return r&&e(t.prototype,r),a&&e(t,a),t}}(),o=e(30),s=a(o),l=Math.pow(2,32)-1,u=function(){function e(t,r){i(this,e),this.observer=t,this.remuxer=r}return n(e,[{key:"resetTimeStamp",value:function e(t){this.initPTS=t}},{key:"resetInitSegment",value:function t(r,a,i,n){if(r&&r.byteLength){var o=this.initData=e.parseInitSegment(r),l={};o.audio&&(l.audio={container:"audio/mp4",codec:a,initSegment:n?r:null}),o.video&&(l.video={container:"video/mp4",codec:i,initSegment:n?r:null}),this.observer.trigger(s.default.FRAG_PARSING_INIT_SEGMENT,{tracks:l})}else a&&(this.audioCodec=a),i&&(this.videoCodec=i)}},{key:"append",value:function t(r,a,i,n){var o=this.initData;o||(this.resetInitSegment(r,this.audioCodec,this.videoCodec),o=this.initData);var l=void 0,u=this.initPTS;if(void 0===u){var d=e.getStartDTS(o,r);this.initPTS=u=d-a,this.observer.trigger(s.default.INIT_PTS_FOUND,{initPTS:u})}e.offsetStartDTS(o,r,u),l=e.getStartDTS(o,r),this.remuxer.remux(o.audio,o.video,null,null,l,i,n,r)}},{key:"destroy",value:function e(){}}],[{key:"probe",value:function t(r){if(r.length>=8){var a=e.bin2str(r.subarray(4,8));return["moof","ftyp","styp"].indexOf(a)>=0}return!1}},{key:"bin2str",value:function e(t){return String.fromCharCode.apply(null,t)}},{key:"readUint32",value:function e(t,r){t.data&&(r+=t.start,t=t.data);var a=t[r]<<24|t[r+1]<<16|t[r+2]<<8|t[r+3];return a<0?4294967296+a:a}},{key:"writeUint32",value:function e(t,r,a){t.data&&(r+=t.start,t=t.data),t[r]=a>>24,t[r+1]=a>>16&255,t[r+2]=a>>8&255,t[r+3]=255&a}},{key:"findBox",value:function t(r,a){var i=[],n,o,s,l,u,d,f;if(r.data?(d=r.start,l=r.end,r=r.data):(d=0,l=r.byteLength),!a.length)return null;for(n=d;n<l;)o=e.readUint32(r,n),s=e.bin2str(r.subarray(n+4,n+8)),f=o>1?n+o:l,s===a[0]&&(1===a.length?i.push({data:r,start:n+8,end:f}):(u=e.findBox({data:r,start:n+8,end:f},a.slice(1)),u.length&&(i=i.concat(u)))),n=f;return i}},{key:"parseInitSegment",value:function t(r){var a=[],i=e.findBox(r,["moov","trak"]);return i.forEach(function(t){var r=e.findBox(t,["tkhd"])[0];if(r){var i=r.data[r.start],n=0===i?12:20,o=e.readUint32(r,n),s=e.findBox(t,["mdia","mdhd"])[0];if(s){i=s.data[s.start],n=0===i?12:20;var l=e.readUint32(s,n),u=e.findBox(t,["mdia","hdlr"])[0];if(u){var d=e.bin2str(u.data.subarray(u.start+8,u.start+12)),f={soun:"audio",vide:"video"}[d];f&&(a[o]={timescale:l,type:f},a[f]={timescale:l,id:o})}}}}),a}},{key:"getStartDTS",value:function t(r,a){var i,n,o;return i=e.findBox(a,["moof","traf"]),n=[].concat.apply([],i.map(function(t){return e.findBox(t,["tfhd"]).map(function(a){var i,n,o;return i=e.readUint32(a,4),n=r[i].timescale||9e4,o=e.findBox(t,["tfdt"]).map(function(t){var r,a;return r=t.data[t.start],a=e.readUint32(t,4),1===r&&(a*=Math.pow(2,32),a+=e.readUint32(t,8)),a})[0],(o=o||1/0)/n})})),o=Math.min.apply(null,n),isFinite(o)?o:0}},{key:"offsetStartDTS",value:function t(r,a,i){e.findBox(a,["moof","traf"]).map(function(t){return e.findBox(t,["tfhd"]).map(function(a){var n=e.readUint32(a,4),o=r[n].timescale||9e4;e.findBox(t,["tfdt"]).map(function(t){var r=t.data[t.start],a=e.readUint32(t,4);if(0===r)e.writeUint32(t,4,a-i*o);else{a*=Math.pow(2,32),a+=e.readUint32(t,8),a-=i*o;var n=Math.floor(a/(l+1)),s=Math.floor(a%(l+1));e.writeUint32(t,4,n),e.writeUint32(t,8,s)}})})})}}]),e}();r.default=u},{30:30}],25:[function(e,t,r){"use strict";var a={BitratesMap:[32,64,96,128,160,192,224,256,288,320,352,384,416,448,32,48,56,64,80,96,112,128,160,192,224,256,320,384,32,40,48,56,64,80,96,112,128,160,192,224,256,320,32,48,56,64,80,96,112,128,144,160,176,192,224,256,8,16,24,32,40,48,56,64,80,96,112,128,144,160],SamplingRateMap:[44100,48e3,32e3,22050,24e3,16e3,11025,12e3,8e3],appendFrame:function e(t,r,a,i,n){if(!(a+24>r.length)){var o=this.parseHeader(r,a);if(o&&a+o.frameLength<=r.length){var s=10368e4/o.sampleRate,l=i+n*s,u={unit:r.subarray(a,a+o.frameLength),pts:l,dts:l};return t.config=[],t.channelCount=o.channelCount,t.samplerate=o.sampleRate,t.samples.push(u),t.len+=o.frameLength,{sample:u,length:o.frameLength}}}},parseHeader:function e(t,r){var i=t[r+1]>>3&3,n=t[r+1]>>1&3,o=t[r+2]>>4&15,s=t[r+2]>>2&3,l=!!(2&t[r+2]);if(1!==i&&0!==o&&15!==o&&3!==s){var u=3===i?3-n:3===n?3:4,d=1e3*a.BitratesMap[14*u+o-1],f=3===i?0:2===i?1:2,h=a.SamplingRateMap[3*f+s],c=l?1:0,v=t[r+3]>>6==3?1:2,g=3===n?(3===i?12:6)*d/h+c<<2:(3===i?144:72)*d/h+c|0;return{sampleRate:h,channelCount:v,frameLength:g}}},isHeader:function e(t,r){return r+1<t.length&&255===t[r]&&224==(224&t[r+1])&&0!=(6&t[r+1])}};t.exports=a},{}],26:[function(e,t,r){"use strict";function a(e){return e&&e.__esModule?e:{default:e}}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(r,"__esModule",{value:!0});var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var a=t[r];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}return function(t,r,a){return r&&e(t.prototype,r),a&&e(t,a),t}}(),o=e(14),s=a(o),l=function(){function e(t,r,a,n){i(this,e),this.decryptdata=a,this.discardEPB=n,this.decrypter=new s.default(t,r)}return n(e,[{key:"decryptBuffer",value:function e(t,r){this.decrypter.decrypt(t,this.decryptdata.key.buffer,this.decryptdata.iv.buffer,r)}},{key:"decryptAacSample",value:function e(t,r,a,i){var n=t[r].unit,o=n.subarray(16,n.length-n.length%16),s=o.buffer.slice(o.byteOffset,o.byteOffset+o.length),l=this;this.decryptBuffer(s,function(e){e=new Uint8Array(e),n.set(e,16),i||l.decryptAacSamples(t,r+1,a)})}},{key:"decryptAacSamples",value:function e(t,r,a){for(;;r++){if(r>=t.length)return void a();if(!(t[r].unit.length<32)){var i=this.decrypter.isSync();if(this.decryptAacSample(t,r,a,i),!i)return}}}},{key:"getAvcEncryptedData",value:function e(t){for(var r=16*Math.floor((t.length-48)/160)+16,a=new Int8Array(r),i=0,n=32;n<=t.length-16;n+=160,i+=16)a.set(t.subarray(n,n+16),i);return a}},{key:"getAvcDecryptedUnit",value:function e(t,r){r=new Uint8Array(r);for(var a=0,i=32;i<=t.length-16;i+=160,a+=16)t.set(r.subarray(a,a+16),i);return t}},{key:"decryptAvcSample",value:function e(t,r,a,i,n,o){var s=this.discardEPB(n.data),l=this.getAvcEncryptedData(s),u=this;this.decryptBuffer(l.buffer,function(e){n.data=u.getAvcDecryptedUnit(s,e),o||u.decryptAvcSamples(t,r,a+1,i)})}},{key:"decryptAvcSamples",value:function e(t,r,a,i){for(;;r++,a=0){if(r>=t.length)return void i();for(var n=t[r].units;!(a>=n.length);a++){var o=n[a];if(!(o.length<=48||1!==o.type&&5!==o.type)){var s=this.decrypter.isSync();if(this.decryptAvcSample(t,r,a,i,o,s),!s)return}}}}}]),e}();r.default=l},{14:14}],27:[function(e,t,r){"use strict";function a(e){return e&&e.__esModule?e:{default:e}}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(r,"__esModule",{value:!0});var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var a=t[r];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}return function(t,r,a){return r&&e(t.prototype,r),a&&e(t,a),t}}(),o=e(17),s=a(o),l=e(25),u=a(l),d=e(30),f=a(d),h=e(21),c=a(h),v=e(26),g=a(v),p=e(46),y=e(28),m=function(){function e(t,r,a,n){i(this,e),this.observer=t,this.config=a,this.typeSupported=n,this.remuxer=r,this.sampleAes=null}return n(e,[{key:"setDecryptData",value:function e(t){null!=t&&null!=t.key&&"SAMPLE-AES"===t.method?this.sampleAes=new g.default(this.observer,this.config,t,this.discardEPB):this.sampleAes=null}},{key:"resetInitSegment",value:function e(t,r,a,i){this.pmtParsed=!1,this._pmtId=-1,this._avcTrack={container:"video/mp2t",type:"video",id:-1,inputTimeScale:9e4,sequenceNumber:0,samples:[],len:0,dropped:0},this._audioTrack={container:"video/mp2t",type:"audio",id:-1,inputTimeScale:9e4,duration:i,sequenceNumber:0,samples:[],len:0,isAAC:!0},this._id3Track={type:"id3",id:-1,inputTimeScale:9e4,sequenceNumber:0,samples:[],len:0},this._txtTrack={type:"text",id:-1,inputTimeScale:9e4,sequenceNumber:0,samples:[],len:0},this.aacOverFlow=null,this.aacLastPTS=null,this.avcSample=null,this.audioCodec=r,this.videoCodec=a,this._duration=i}},{key:"resetTimeStamp",value:function e(){}},{key:"append",value:function e(t,r,a,i){var n,o=t.length,s,l,u,d,h,c=!1;this.contiguous=a;var v=this.pmtParsed,g=this._avcTrack,m=this._audioTrack,E=this._id3Track,b=g.id,_=m.id,R=E.id,S=this._pmtId,T=g.pesData,L=m.pesData,A=E.pesData,k=this._parsePAT,D=this._parsePMT,w=this._parsePES,O=this._parseAVCPES.bind(this),P=this._parseAACPES.bind(this),C=this._parseMPEGPES.bind(this),M=this._parseID3PES.bind(this);for(o-=o%188,n=0;n<o;n+=188)if(71===t[n]){if(s=!!(64&t[n+1]),l=((31&t[n+1])<<8)+t[n+2],(u=(48&t[n+3])>>4)>1){if((d=n+5+t[n+4])===n+188)continue}else d=n+4;switch(l){case b:s&&(T&&(h=w(T))&&O(h,!1),T={data:[],size:0}),T&&(T.data.push(t.subarray(d,n+188)),T.size+=n+188-d);break;case _:s&&(L&&(h=w(L))&&(m.isAAC?P(h):C(h)),L={data:[],size:0}),L&&(L.data.push(t.subarray(d,n+188)),L.size+=n+188-d);break;case R:s&&(A&&(h=w(A))&&M(h),A={data:[],size:0}),A&&(A.data.push(t.subarray(d,n+188)),A.size+=n+188-d);break;case 0:s&&(d+=t[d]+1),S=this._pmtId=k(t,d);break;case S:s&&(d+=t[d]+1);var x=D(t,d,!0===this.typeSupported.mpeg||!0===this.typeSupported.mp3,null!=this.sampleAes);b=x.avc,b>0&&(g.id=b),_=x.audio,_>0&&(m.id=_,m.isAAC=x.isAAC),R=x.id3,R>0&&(E.id=R),c&&!v&&(p.logger.log("reparse from beginning"),c=!1,n=-188),v=this.pmtParsed=!0;break;case 17:case 8191:break;default:c=!0}}else this.observer.trigger(f.default.ERROR,{type:y.ErrorTypes.MEDIA_ERROR,details:y.ErrorDetails.FRAG_PARSING_ERROR,fatal:!1,reason:"TS packet did not start with 0x47"});T&&(h=w(T))?(O(h,!0),g.pesData=null):g.pesData=T,L&&(h=w(L))?(m.isAAC?P(h):C(h),m.pesData=null):(L&&L.size&&p.logger.log("last AAC PES packet truncated,might overlap between fragments"),m.pesData=L),A&&(h=w(A))?(M(h),E.pesData=null):E.pesData=A,null==this.sampleAes?this.remuxer.remux(m,g,E,this._txtTrack,r,a,i):this.decryptAndRemux(m,g,E,this._txtTrack,r,a,i)}},{key:"decryptAndRemux",value:function e(t,r,a,i,n,o,s){if(t.samples&&t.isAAC){var l=this;this.sampleAes.decryptAacSamples(t.samples,0,function(){l.decryptAndRemuxAvc(t,r,a,i,n,o,s)})}else this.decryptAndRemuxAvc(t,r,a,i,n,o,s)}},{key:"decryptAndRemuxAvc",value:function e(t,r,a,i,n,o,s){if(r.samples){var l=this;this.sampleAes.decryptAvcSamples(r.samples,0,0,function(){l.remuxer.remux(t,r,a,i,n,o,s)})}else this.remuxer.remux(t,r,a,i,n,o,s)}},{key:"destroy",value:function e(){this._initPTS=this._initDTS=void 0,this._duration=0}},{key:"_parsePAT",value:function e(t,r){return(31&t[r+10])<<8|t[r+11]}},{key:"_parsePMT",value:function e(t,r,a,i){var n,o,s,l,u={audio:-1,avc:-1,id3:-1,isAAC:!0};for(n=(15&t[r+1])<<8|t[r+2],o=r+3+n-4,s=(15&t[r+10])<<8|t[r+11],r+=12+s;r<o;){switch(l=(31&t[r+1])<<8|t[r+2],t[r]){case 207:if(!i){p.logger.log("unkown stream type:"+t[r]);break}case 15:-1===u.audio&&(u.audio=l);break;case 21:-1===u.id3&&(u.id3=l);break;case 219:if(!i){p.logger.log("unkown stream type:"+t[r]);break}case 27:-1===u.avc&&(u.avc=l);break;case 3:case 4:a?-1===u.audio&&(u.audio=l,u.isAAC=!1):p.logger.log("MPEG audio found, not supported in this browser for now");break;case 36:p.logger.warn("HEVC stream type found, not supported for now");break;default:p.logger.log("unkown stream type:"+t[r])}r+=5+((15&t[r+3])<<8|t[r+4])}return u}},{key:"_parsePES",value:function e(t){var r=0,a,i,n,o,s,l,u,d,f,h=t.data;if(!t||0===t.size)return null;for(;h[0].length<19&&h.length>1;){var c=new Uint8Array(h[0].length+h[1].length);c.set(h[0]),c.set(h[1],h[0].length),h[0]=c,h.splice(1,1)}if(a=h[0],1===(n=(a[0]<<16)+(a[1]<<8)+a[2])){if((o=(a[4]<<8)+a[5])&&o>t.size-6)return null;i=a[7],192&i&&(u=536870912*(14&a[9])+4194304*(255&a[10])+16384*(254&a[11])+128*(255&a[12])+(254&a[13])/2,u>4294967295&&(u-=8589934592),64&i?(d=536870912*(14&a[14])+4194304*(255&a[15])+16384*(254&a[16])+128*(255&a[17])+(254&a[18])/2,d>4294967295&&(d-=8589934592),u-d>54e5&&(p.logger.warn(Math.round((u-d)/9e4)+"s delta between PTS and DTS, align them"),u=d)):d=u),s=a[8],f=s+9,t.size-=f,l=new Uint8Array(t.size);for(var v=0,g=h.length;v<g;v++){a=h[v];var y=a.byteLength;if(f){if(f>y){f-=y;continue}a=a.subarray(f),y-=f,f=0}l.set(a,r),r+=y}return o&&(o-=s+3),{data:l,pts:u,dts:d,len:o}}return null}},{key:"pushAccesUnit",value:function e(t,r){if(t.units.length&&t.frame){var a=r.samples,i=a.length;!this.config.forceKeyFrameOnDiscontinuity||!0===t.key||r.sps&&(i||this.contiguous)?(t.id=i,a.push(t)):r.dropped++}t.debug.length&&p.logger.log(t.pts+"/"+t.dts+":"+t.debug)}},{key:"_parseAVCPES",value:function e(t,r){var a=this,i=this._avcTrack,n=this._parseAVCNALu(t.data),o=!1,s,l=this.avcSample,u,d;t.data=null,n.forEach(function(e){switch(e.type){case 1:u=!0,l.frame=!0;var r=e.data;if(r.length>4){var n=new c.default(r).readSliceType();2!==n&&4!==n&&7!==n&&9!==n||(l.key=!0)}break;case 5:u=!0,l||(l=a.avcSample=a._createAVCSample(!0,t.pts,t.dts,"")),l.key=!0,l.frame=!0;break;case 6:u=!0,s=new c.default(a.discardEPB(e.data)),s.readUByte();for(var o=0,f=0,h=!1,v=0;!h&&s.bytesAvailable>1;){o=0;do{v=s.readUByte(),o+=v}while(255===v);f=0;do{v=s.readUByte(),f+=v}while(255===v);if(4===o&&0!==s.bytesAvailable){h=!0;var g=s.readUByte();if(181===g){var p=s.readUShort();if(49===p){var y=s.readUInt();if(1195456820===y){var m=s.readUByte();if(3===m){var E=s.readUByte(),b=s.readUByte(),_=31&E,R=[E,b];for(d=0;d<_;d++)R.push(s.readUByte()),R.push(s.readUByte()),R.push(s.readUByte());a._insertSampleInOrder(a._txtTrack.samples,{type:3,pts:t.pts,bytes:R})}}}}}else if(f<s.bytesAvailable)for(d=0;d<f;d++)s.readUByte()}break;case 7:if(u=!0,!i.sps){s=new c.default(e.data);var S=s.readSPS();i.width=S.width,i.height=S.height,i.pixelRatio=S.pixelRatio,i.sps=[e.data],i.duration=a._duration;var T=e.data.subarray(1,4),L="avc1.";for(d=0;d<3;d++){var A=T[d].toString(16);A.length<2&&(A="0"+A),L+=A}i.codec=L}break;case 8:u=!0,i.pps||(i.pps=[e.data]);break;case 9:u=!1,l&&a.pushAccesUnit(l,i),l=a.avcSample=a._createAVCSample(!1,t.pts,t.dts,"");break;case 12:u=!1;break;default:u=!1,l&&(l.debug+="unknown NAL "+e.type+" ")}if(l&&u){var k=l.units;k.push(e)}}),r&&l&&(this.pushAccesUnit(l,i),this.avcSample=null)}},{key:"_createAVCSample",value:function e(t,r,a,i){return{key:t,pts:r,dts:a,units:[],debug:i}}},{key:"_insertSampleInOrder",value:function e(t,r){var a=t.length;if(a>0){if(r.pts>=t[a-1].pts)t.push(r);else for(var i=a-1;i>=0;i--)if(r.pts<t[i].pts){t.splice(i,0,r);break}}else t.push(r)}},{key:"_getLastNalUnit",value:function e(){var t=this.avcSample,r=void 0;if(!t||0===t.units.length){var a=this._avcTrack,i=a.samples;t=i[i.length-1]}if(t){var n=t.units;r=n[n.length-1]}return r}},{key:"_parseAVCNALu",value:function e(t){var r=0,a=t.byteLength,i,n,o=this._avcTrack,s=o.naluState||0,l=s,u=[],d,f,h=-1,c;for(-1===s&&(h=0,c=31&t[0],s=0,r=1);r<a;)if(i=t[r++],s)if(1!==s)if(i)if(1===i){if(h>=0)d={data:t.subarray(h,r-s-1),type:c},u.push(d);else{var v=this._getLastNalUnit();if(v&&(l&&r<=4-l&&v.state&&(v.data=v.data.subarray(0,v.data.byteLength-l)),(n=r-s-1)>0)){var g=new Uint8Array(v.data.byteLength+n);g.set(v.data,0),g.set(t.subarray(0,n),v.data.byteLength),v.data=g}}r<a?(f=31&t[r],h=r,c=f,s=0):s=-1}else s=0;else s=3;else s=i?0:2;else s=i?0:1;if(h>=0&&s>=0&&(d={data:t.subarray(h,a),type:c,state:s},u.push(d)),0===u.length){var p=this._getLastNalUnit();if(p){var y=new Uint8Array(p.data.byteLength+t.byteLength);y.set(p.data,0),y.set(t,p.data.byteLength),p.data=y}}return o.naluState=s,u}},{key:"discardEPB",value:function e(t){for(var r=t.byteLength,a=[],i=1,n,o;i<r-2;)0===t[i]&&0===t[i+1]&&3===t[i+2]?(a.push(i+2),i+=2):i++;if(0===a.length)return t;n=r-a.length,o=new Uint8Array(n);var s=0;for(i=0;i<n;s++,i++)s===a[0]&&(s++,a.shift()),o[i]=t[s];return o}},{key:"_parseAACPES",value:function e(t){var r=this._audioTrack,a=t.data,i=t.pts,n=0,o=this.aacOverFlow,l=this.aacLastPTS,u,d,h,c,v;if(o){var g=new Uint8Array(o.byteLength+a.byteLength);g.set(o,0),g.set(a,o.byteLength),a=g}for(h=0,v=a.length;h<v-1&&!s.default.isHeader(a,h);h++);if(h){var m,E;if(h<v-1?(m="AAC PES did not start with ADTS header,offset:"+h,E=!1):(m="no ADTS header found in AAC PES",E=!0),p.logger.warn("parsing error:"+m),this.observer.trigger(f.default.ERROR,{type:y.ErrorTypes.MEDIA_ERROR,details:y.ErrorDetails.FRAG_PARSING_ERROR,fatal:E,reason:m}),E)return}if(s.default.initTrackConfig(r,this.observer,a,h,this.audioCodec),d=0,u=s.default.getFrameDuration(r.samplerate),o&&l){var b=l+u;Math.abs(b-i)>1&&(p.logger.log("AAC: align PTS for overlapping frames by "+Math.round((b-i)/90)),i=b)}for(;h<v;)if(s.default.isHeader(a,h)&&h+5<v){var _=s.default.appendFrame(r,a,h,i,d);if(!_)break;h+=_.length,c=_.sample.pts,d++}else h++;o=h<v?a.subarray(h,v):null,this.aacOverFlow=o,this.aacLastPTS=c}},{key:"_parseMPEGPES",value:function e(t){for(var r=t.data,a=r.length,i=0,n=0,o=t.pts;n<a;)if(u.default.isHeader(r,n)){var s=u.default.appendFrame(this._audioTrack,r,n,o,i);if(!s)break;n+=s.length,i++}else n++}},{key:"_parseID3PES",value:function e(t){this._id3Track.samples.push(t)}}],[{key:"probe",value:function e(t){return t.length>=564&&71===t[0]&&71===t[188]&&71===t[376]}}]),e}();r.default=m},{17:17,21:21,25:25,26:26,28:28,30:30,46:46}],28:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var a=r.ErrorTypes={NETWORK_ERROR:"networkError",MEDIA_ERROR:"mediaError",MUX_ERROR:"muxError",OTHER_ERROR:"otherError"},i=r.ErrorDetails={MANIFEST_LOAD_ERROR:"manifestLoadError",MANIFEST_LOAD_TIMEOUT:"manifestLoadTimeOut",MANIFEST_PARSING_ERROR:"manifestParsingError",MANIFEST_INCOMPATIBLE_CODECS_ERROR:"manifestIncompatibleCodecsError",LEVEL_LOAD_ERROR:"levelLoadError",LEVEL_LOAD_TIMEOUT:"levelLoadTimeOut",LEVEL_SWITCH_ERROR:"levelSwitchError",AUDIO_TRACK_LOAD_ERROR:"audioTrackLoadError",AUDIO_TRACK_LOAD_TIMEOUT:"audioTrackLoadTimeOut",FRAG_LOAD_ERROR:"fragLoadError",FRAG_LOOP_LOADING_ERROR:"fragLoopLoadingError",FRAG_LOAD_TIMEOUT:"fragLoadTimeOut",FRAG_DECRYPT_ERROR:"fragDecryptError",FRAG_PARSING_ERROR:"fragParsingError",REMUX_ALLOC_ERROR:"remuxAllocError",KEY_LOAD_ERROR:"keyLoadError",KEY_LOAD_TIMEOUT:"keyLoadTimeOut",BUFFER_ADD_CODEC_ERROR:"bufferAddCodecError",BUFFER_APPEND_ERROR:"bufferAppendError",BUFFER_APPENDING_ERROR:"bufferAppendingError",BUFFER_STALLED_ERROR:"bufferStalledError",BUFFER_FULL_ERROR:"bufferFullError",BUFFER_SEEK_OVER_HOLE:"bufferSeekOverHole",BUFFER_NUDGE_ON_STALL:"bufferNudgeOnStall",INTERNAL_EXCEPTION:"internalException",WEBVTT_EXCEPTION:"webVTTException"}},{}],29:[function(e,t,r){"use strict";function a(e){return e&&e.__esModule?e:{default:e}}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(r,"__esModule",{value:!0});var n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},o=function(){function e(e,t){for(var r=0;r<t.length;r++){var a=t[r];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}return function(t,r,a){return r&&e(t.prototype,r),a&&e(t,a),t}}(),s=e(46),l=e(28),u=e(30),d=a(u),f=function(){function e(t){i(this,e),this.hls=t,this.onEvent=this.onEvent.bind(this);for(var r=arguments.length,a=Array(r>1?r-1:0),n=1;n<r;n++)a[n-1]=arguments[n];this.handledEvents=a,this.useGenericHandler=!0,this.registerListeners()}return o(e,[{key:"destroy",value:function e(){this.unregisterListeners()}},{key:"isEventHandler",value:function e(){return"object"===n(this.handledEvents)&&this.handledEvents.length&&"function"==typeof this.onEvent}},{key:"registerListeners",value:function e(){this.isEventHandler()&&this.handledEvents.forEach(function(e){if("hlsEventGeneric"===e)throw new Error("Forbidden event name: "+e);this.hls.on(e,this.onEvent)}.bind(this))}},{key:"unregisterListeners",value:function e(){this.isEventHandler()&&this.handledEvents.forEach(function(e){this.hls.off(e,this.onEvent)}.bind(this))}},{key:"onEvent",value:function e(t,r){this.onEventGeneric(t,r)}},{key:"onEventGeneric",value:function e(t,r){var a=function e(t,r){var a="on"+t.replace("hls","");if("function"!=typeof this[a])throw new Error("Event "+t+" has no generic handler in this "+this.constructor.name+" class (tried "+a+")");return this[a].bind(this,r)};try{a.call(this,t,r).call()}catch(e){s.logger.error("internal error happened while processing "+t+":"+e.message),this.hls.trigger(d.default.ERROR,{type:l.ErrorTypes.OTHER_ERROR,details:l.ErrorDetails.INTERNAL_EXCEPTION,fatal:!1,event:t,err:e})}}}]),e}();r.default=f},{28:28,30:30,46:46}],30:[function(e,t,r){"use strict";t.exports={MEDIA_ATTACHING:"hlsMediaAttaching",MEDIA_ATTACHED:"hlsMediaAttached",MEDIA_DETACHING:"hlsMediaDetaching",MEDIA_DETACHED:"hlsMediaDetached",BUFFER_RESET:"hlsBufferReset",BUFFER_CODECS:"hlsBufferCodecs",BUFFER_CREATED:"hlsBufferCreated",BUFFER_APPENDING:"hlsBufferAppending",BUFFER_APPENDED:"hlsBufferAppended",BUFFER_EOS:"hlsBufferEos",BUFFER_FLUSHING:"hlsBufferFlushing",BUFFER_FLUSHED:"hlsBufferFlushed",MANIFEST_LOADING:"hlsManifestLoading",MANIFEST_LOADED:"hlsManifestLoaded",MANIFEST_PARSED:"hlsManifestParsed",LEVEL_SWITCH:"hlsLevelSwitch",LEVEL_SWITCHING:"hlsLevelSwitching",LEVEL_SWITCHED:"hlsLevelSwitched",LEVEL_LOADING:"hlsLevelLoading",LEVEL_LOADED:"hlsLevelLoaded",LEVEL_UPDATED:"hlsLevelUpdated",LEVEL_PTS_UPDATED:"hlsLevelPtsUpdated",AUDIO_TRACKS_UPDATED:"hlsAudioTracksUpdated",AUDIO_TRACK_SWITCH:"hlsAudioTrackSwitch",AUDIO_TRACK_SWITCHING:"hlsAudioTrackSwitching",AUDIO_TRACK_SWITCHED:"hlsAudioTrackSwitched",AUDIO_TRACK_LOADING:"hlsAudioTrackLoading",AUDIO_TRACK_LOADED:"hlsAudioTrackLoaded",SUBTITLE_TRACKS_UPDATED:"hlsSubtitleTracksUpdated",SUBTITLE_TRACK_SWITCH:"hlsSubtitleTrackSwitch",SUBTITLE_TRACK_LOADING:"hlsSubtitleTrackLoading",SUBTITLE_TRACK_LOADED:"hlsSubtitleTrackLoaded",SUBTITLE_FRAG_PROCESSED:"hlsSubtitleFragProcessed",INIT_PTS_FOUND:"hlsInitPtsFound",FRAG_LOADING:"hlsFragLoading",FRAG_LOAD_PROGRESS:"hlsFragLoadProgress",FRAG_LOAD_EMERGENCY_ABORTED:"hlsFragLoadEmergencyAborted",FRAG_LOADED:"hlsFragLoaded",FRAG_DECRYPTED:"hlsFragDecrypted",FRAG_PARSING_INIT_SEGMENT:"hlsFragParsingInitSegment",FRAG_PARSING_USERDATA:"hlsFragParsingUserdata",FRAG_PARSING_METADATA:"hlsFragParsingMetadata",FRAG_PARSING_DATA:"hlsFragParsingData",FRAG_PARSED:"hlsFragParsed",FRAG_BUFFERED:"hlsFragBuffered",FRAG_CHANGED:"hlsFragChanged",FPS_DROP:"hlsFpsDrop",FPS_DROP_LEVEL_CAPPING:"hlsFpsDropLevelCapping",ERROR:"hlsError",DESTROYING:"hlsDestroying",KEY_LOADING:"hlsKeyLoading",KEY_LOADED:"hlsKeyLoaded",STREAM_STATE_TRANSITION:"hlsStreamStateTransition"}},{}],31:[function(e,t,r){"use strict";function a(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(r,"__esModule",{value:!0});var i=function(){function e(e,t){for(var r=0;r<t.length;r++){var a=t[r];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}return function(t,r,a){return r&&e(t.prototype,r),a&&e(t,a),t}}(),n=function(){function e(){a(this,e)}return i(e,null,[{key:"getSilentFrame",value:function e(t,r){switch(t){case"mp4a.40.2":if(1===r)return new Uint8Array([0,200,0,128,35,128]);if(2===r)return new Uint8Array([33,0,73,144,2,25,0,35,128]);if(3===r)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,142]);if(4===r)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,128,44,128,8,2,56]);if(5===r)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,56]);if(6===r)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,0,178,0,32,8,224]);break;default:if(1===r)return new Uint8Array([1,64,34,128,163,78,230,128,186,8,0,0,0,28,6,241,193,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(2===r)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(3===r)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94])}return null}}]),e}();r.default=n},{}],32:[function(e,t,r){"use strict";var a={isBuffered:function e(t,r){if(t)for(var a=t.buffered,i=0;i<a.length;i++)if(r>=a.start(i)&&r<=a.end(i))return!0;return!1},bufferInfo:function e(t,r,a){if(t){var i=t.buffered,n=[],o;for(o=0;o<i.length;o++)n.push({start:i.start(o),end:i.end(o)});return this.bufferedInfo(n,r,a)}return{len:0,start:r,end:r,nextStart:void 0}},bufferedInfo:function e(t,r,a){var i=[],n,o,s,l,u;for(t.sort(function(e,t){var r=e.start-t.start;return r||t.end-e.end}),u=0;u<t.length;u++){var d=i.length;if(d){var f=i[d-1].end;t[u].start-f<a?t[u].end>f&&(i[d-1].end=t[u].end):i.push(t[u])}else i.push(t[u])}for(u=0,n=0,o=s=r;u<i.length;u++){var h=i[u].start,c=i[u].end;if(r+a>=h&&r<c)o=h,s=c,n=s-r;else if(r+a<h){l=h;break}}return{len:n,start:o,end:s,nextStart:l}}};t.exports=a},{}],33:[function(e,t,r){"use strict";var a=e(46),i={mergeDetails:function e(t,r){var n=Math.max(t.startSN,r.startSN)-r.startSN,o=Math.min(t.endSN,r.endSN)-r.startSN,s=r.startSN-t.startSN,l=t.fragments,u=r.fragments,d=0,f;if(o<n)return void(r.PTSKnown=!1);for(var h=n;h<=o;h++){var c=l[s+h],v=u[h];v&&c&&(d=c.cc-v.cc,isNaN(c.startPTS)||(v.start=v.startPTS=c.startPTS,v.endPTS=c.endPTS,v.duration=c.duration,v.backtracked=c.backtracked,v.dropped=c.dropped,f=v))}if(d)for(a.logger.log("discontinuity sliding from playlist, take drift into account"),h=0;h<u.length;h++)u[h].cc+=d;if(f)i.updateFragPTSDTS(r,f,f.startPTS,f.endPTS,f.startDTS,f.endDTS);else if(s>=0&&s<l.length){var g=l[s].start;for(h=0;h<u.length;h++)u[h].start+=g}r.PTSKnown=t.PTSKnown},updateFragPTSDTS:function e(t,r,a,n,o,s){if(!isNaN(r.startPTS)){var l=Math.abs(r.startPTS-a);isNaN(r.deltaPTS)?r.deltaPTS=l:r.deltaPTS=Math.max(l,r.deltaPTS),a=Math.min(a,r.startPTS),n=Math.max(n,r.endPTS),o=Math.min(o,r.startDTS),s=Math.max(s,r.endDTS)}var u=a-r.start;r.start=r.startPTS=a,r.endPTS=n,r.startDTS=o,r.endDTS=s,r.duration=n-a;var d=r.sn;if(!t||d<t.startSN||d>t.endSN)return 0;var f,h,c;for(f=d-t.startSN,h=t.fragments,r=h[f],c=f;c>0;c--)i.updatePTS(h,c,c-1);for(c=f;c<h.length-1;c++)i.updatePTS(h,c,c+1);return t.PTSKnown=!0,u},updatePTS:function e(t,r,i){var n=t[r],o=t[i],s=o.startPTS;isNaN(s)?o.start=i>r?n.start+n.duration:Math.max(n.start-o.duration,0):i>r?(n.duration=s-n.start,n.duration<0&&a.logger.warn("negative duration computed for frag "+n.sn+",level "+n.level+", there should be some duration drift between playlist and fragment!")):(o.duration=n.start-s,o.duration<0&&a.logger.warn("negative duration computed for frag "+o.sn+",level "+o.level+", there should be some duration drift between playlist and fragment!"))}};t.exports=i},{46:46}],34:[function(e,t,r){"use strict";function a(e){return e&&e.__esModule?e:{default:e}}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(r,"__esModule",{value:!0});var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var a=t[r];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}return function(t,r,a){return r&&e(t.prototype,r),a&&e(t,a),t}}(),o=e(2),s=a(o),l=e(30),u=a(l),d=e(28),f=e(38),h=a(f),c=e(36),v=a(c),g=e(37),p=a(g),y=e(11),m=a(y),E=e(10),b=a(E),_=e(9),R=a(_),S=e(46),T=e(1),L=a(T),A=e(4),k=function(){function e(){var t=this,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};i(this,e);var a=e.DefaultConfig;if((r.liveSyncDurationCount||r.liveMaxLatencyDurationCount)&&(r.liveSyncDuration||r.liveMaxLatencyDuration))throw new Error("Illegal hls.js config: don't mix up liveSyncDurationCount/liveMaxLatencyDurationCount and liveSyncDuration/liveMaxLatencyDuration");for(var n in a)n in r||(r[n]=a[n]);if(void 0!==r.liveMaxLatencyDurationCount&&r.liveMaxLatencyDurationCount<=r.liveSyncDurationCount)throw new Error('Illegal hls.js config: "liveMaxLatencyDurationCount" must be gt "liveSyncDurationCount"');if(void 0!==r.liveMaxLatencyDuration&&(r.liveMaxLatencyDuration<=r.liveSyncDuration||void 0===r.liveSyncDuration))throw new Error('Illegal hls.js config: "liveMaxLatencyDuration" must be gt "liveSyncDuration"');(0,S.enableLogs)(r.debug),this.config=r,this._autoLevelCapping=-1;var o=this.observer=new L.default;o.trigger=function e(t){for(var r=arguments.length,a=Array(r>1?r-1:0),i=1;i<r;i++)a[i-1]=arguments[i];o.emit.apply(o,[t,t].concat(a))},o.off=function e(t){for(var r=arguments.length,a=Array(r>1?r-1:0),i=1;i<r;i++)a[i-1]=arguments[i];o.removeListener.apply(o,[t].concat(a))},this.on=o.on.bind(o),this.off=o.off.bind(o),this.trigger=o.trigger.bind(o);var s=this.abrController=new r.abrController(this),l=new r.bufferController(this),u=new r.capLevelController(this),d=new r.fpsController(this),f=new h.default(this),c=new v.default(this),g=new p.default(this),y=new R.default(this),E=this.levelController=new b.default(this),_=this.streamController=new m.default(this),T=[E,_],A=r.audioStreamController;A&&T.push(new A(this)),this.networkControllers=T;var k=[f,c,g,s,l,u,d,y];if(A=r.audioTrackController){var D=new A(this);this.audioTrackController=D,k.push(D)}if(A=r.subtitleTrackController){var w=new A(this);this.subtitleTrackController=w,k.push(w)}[r.subtitleStreamController,r.timelineController].forEach(function(e){e&&k.push(new e(t))}),this.coreComponents=k}return n(e,null,[{key:"isSupported",value:function e(){var t=window.MediaSource=window.MediaSource||window.WebKitMediaSource,r=window.SourceBuffer=window.SourceBuffer||window.WebKitSourceBuffer,a=t&&"function"==typeof t.isTypeSupported&&t.isTypeSupported('video/mp4; codecs="avc1.42E01E,mp4a.40.2"'),i=!r||r.prototype&&"function"==typeof r.prototype.appendBuffer&&"function"==typeof r.prototype.remove;return a&&i}},{key:"version",get:function e(){return"0.7.9"}},{key:"Events",get:function e(){return u.default}},{key:"ErrorTypes",get:function e(){return d.ErrorTypes}},{key:"ErrorDetails",get:function e(){return d.ErrorDetails}},{key:"DefaultConfig",get:function t(){return e.defaultConfig?e.defaultConfig:A.hlsDefaultConfig},set:function t(r){e.defaultConfig=r}}]),n(e,[{key:"destroy",value:function e(){S.logger.log("destroy"),this.trigger(u.default.DESTROYING),this.detachMedia(),this.coreComponents.concat(this.networkControllers).forEach(function(e){e.destroy()}),this.url=null,this.observer.removeAllListeners(),this._autoLevelCapping=-1}},{key:"attachMedia",value:function e(t){S.logger.log("attachMedia"),this.media=t,this.trigger(u.default.MEDIA_ATTACHING,{media:t})}},{key:"detachMedia",value:function e(){S.logger.log("detachMedia"),this.trigger(u.default.MEDIA_DETACHING),this.media=null}},{key:"loadSource",value:function e(t){t=s.default.buildAbsoluteURL(window.location.href,t,{alwaysNormalize:!0}),S.logger.log("loadSource:"+t),this.url=t,this.trigger(u.default.MANIFEST_LOADING,{url:t})}},{key:"startLoad",value:function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:-1;S.logger.log("startLoad("+t+")"),this.networkControllers.forEach(function(e){e.startLoad(t)})}},{key:"stopLoad",value:function e(){S.logger.log("stopLoad"),this.networkControllers.forEach(function(e){e.stopLoad()})}},{key:"swapAudioCodec",value:function e(){S.logger.log("swapAudioCodec"),this.streamController.swapAudioCodec()}},{key:"recoverMediaError",value:function e(){S.logger.log("recoverMediaError");var t=this.media;this.detachMedia(),this.attachMedia(t)}},{key:"levels",get:function e(){return this.levelController.levels}},{key:"currentLevel",get:function e(){return this.streamController.currentLevel},set:function e(t){S.logger.log("set currentLevel:"+t),this.loadLevel=t,this.streamController.immediateLevelSwitch()}},{key:"nextLevel",get:function e(){return this.streamController.nextLevel},set:function e(t){S.logger.log("set nextLevel:"+t),this.levelController.manualLevel=t,this.streamController.nextLevelSwitch()}},{key:"loadLevel",get:function e(){return this.levelController.level},set:function e(t){S.logger.log("set loadLevel:"+t),this.levelController.manualLevel=t}},{key:"nextLoadLevel",get:function e(){return this.levelController.nextLoadLevel},set:function e(t){this.levelController.nextLoadLevel=t}},{key:"firstLevel",get:function e(){return Math.max(this.levelController.firstLevel,this.minAutoLevel)},set:function e(t){S.logger.log("set firstLevel:"+t),this.levelController.firstLevel=t}},{key:"startLevel",get:function e(){return this.levelController.startLevel},set:function e(t){S.logger.log("set startLevel:"+t);var r=this;-1!==t&&(t=Math.max(t,r.minAutoLevel)),r.levelController.startLevel=t}},{key:"autoLevelCapping",get:function e(){return this._autoLevelCapping},set:function e(t){S.logger.log("set autoLevelCapping:"+t),this._autoLevelCapping=t}},{key:"autoLevelEnabled",get:function e(){return-1===this.levelController.manualLevel}},{key:"manualLevel",get:function e(){return this.levelController.manualLevel}},{key:"minAutoLevel",get:function e(){for(var t=this,r=t.levels,a=t.config.minAutoBitrate,i=r?r.length:0,n=0;n<i;n++){var o=r[n].realBitrate?Math.max(r[n].realBitrate,r[n].bitrate):r[n].bitrate;if(o>a)return n}return 0}},{key:"maxAutoLevel",get:function e(){var t=this,r=t.levels,a=t.autoLevelCapping,i=void 0;return i=-1===a&&r&&r.length?r.length-1:a}},{key:"nextAutoLevel",get:function e(){var t=this;return Math.min(Math.max(t.abrController.nextAutoLevel,t.minAutoLevel),t.maxAutoLevel)},set:function e(t){var r=this;r.abrController.nextAutoLevel=Math.max(r.minAutoLevel,t)}},{key:"audioTracks",get:function e(){var t=this.audioTrackController;return t?t.audioTracks:[]}},{key:"audioTrack",get:function e(){var t=this.audioTrackController;return t?t.audioTrack:-1},set:function e(t){var r=this.audioTrackController;r&&(r.audioTrack=t)}},{key:"liveSyncPosition",get:function e(){return this.streamController.liveSyncPosition}},{key:"subtitleTracks",get:function e(){var t=this.subtitleTrackController;return t?t.subtitleTracks:[]}},{key:"subtitleTrack",get:function e(){var t=this.subtitleTrackController;return t?t.subtitleTrack:-1},set:function e(t){var r=this.subtitleTrackController;r&&(r.subtitleTrack=t)}}]),e}();r.default=k},{1:1,10:10,11:11,2:2,28:28,30:30,36:36,37:37,38:38,4:4,46:46,9:9}],35:[function(e,t,r){"use strict";t.exports=e(34).default},{34:34}],36:[function(e,t,r){"use strict";function a(e){return e&&e.__esModule?e:{default:e}}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function n(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function o(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(r,"__esModule",{value:!0});var s=function(){function e(e,t){for(var r=0;r<t.length;r++){var a=t[r];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}return function(t,r,a){return r&&e(t.prototype,r),a&&e(t,a),t}}(),l=e(30),u=a(l),d=e(29),f=a(d),h=e(28),c=e(46),v=function(e){function t(e){i(this,t);var r=n(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,u.default.FRAG_LOADING));return r.loaders={},r}return o(t,e),s(t,[{key:"destroy",value:function e(){var t=this.loaders;for(var r in t){var a=t[r];a&&a.destroy()}this.loaders={},f.default.prototype.destroy.call(this)}},{key:"onFragLoading",value:function e(t){var r=t.frag,a=r.type,i=this.loaders[a],n=this.hls.config;r.loaded=0,i&&(c.logger.warn("abort previous fragment loader for type:"+a),i.abort()),i=this.loaders[a]=r.loader=void 0!==n.fLoader?new n.fLoader(n):new n.loader(n);var o=void 0,s=void 0,l=void 0;o={url:r.url,frag:r,responseType:"arraybuffer",progressData:!1};var u=r.byteRangeStartOffset,d=r.byteRangeEndOffset;isNaN(u)||isNaN(d)||(o.rangeStart=u,o.rangeEnd=d),s={timeout:n.fragLoadingTimeOut,maxRetry:0,retryDelay:0,maxRetryDelay:n.fragLoadingMaxRetryTimeout},l={onSuccess:this.loadsuccess.bind(this),onError:this.loaderror.bind(this),onTimeout:this.loadtimeout.bind(this),onProgress:this.loadprogress.bind(this)},i.load(o,s,l)}},{key:"loadsuccess",value:function e(t,r,a){var i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,n=t.data,o=a.frag;o.loader=void 0,this.loaders[o.type]=void 0,this.hls.trigger(u.default.FRAG_LOADED,{payload:n,frag:o,stats:r,networkDetails:i})}},{key:"loaderror",value:function e(t,r){var a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,i=r.loader;i&&i.abort(),this.loaders[r.type]=void 0,this.hls.trigger(u.default.ERROR,{type:h.ErrorTypes.NETWORK_ERROR,details:h.ErrorDetails.FRAG_LOAD_ERROR,fatal:!1,frag:r.frag,response:t,networkDetails:a})}},{key:"loadtimeout",value:function e(t,r){var a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,i=r.loader;i&&i.abort(),this.loaders[r.type]=void 0,this.hls.trigger(u.default.ERROR,{type:h.ErrorTypes.NETWORK_ERROR,details:h.ErrorDetails.FRAG_LOAD_TIMEOUT,fatal:!1,frag:r.frag,networkDetails:a})}},{key:"loadprogress",value:function e(t,r,a){var i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,n=r.frag;n.loaded=t.loaded,this.hls.trigger(u.default.FRAG_LOAD_PROGRESS,{frag:n,stats:t,networkDetails:i})}}]),t}(f.default);r.default=v},{28:28,29:29,30:30,46:46}],37:[function(e,t,r){"use strict";function a(e){return e&&e.__esModule?e:{default:e}}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function n(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function o(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(r,"__esModule",{value:!0});var s=function(){function e(e,t){for(var r=0;r<t.length;r++){var a=t[r];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}return function(t,r,a){return r&&e(t.prototype,r),a&&e(t,a),t}}(),l=e(30),u=a(l),d=e(29),f=a(d),h=e(28),c=e(46),v=function(e){function t(e){i(this,t);var r=n(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,u.default.KEY_LOADING));return r.loaders={},r.decryptkey=null,r.decrypturl=null,r}return o(t,e),s(t,[{key:"destroy",value:function e(){for(var t in this.loaders){var r=this.loaders[t];r&&r.destroy()}this.loaders={},f.default.prototype.destroy.call(this)}},{key:"onKeyLoading",value:function e(t){var r=t.frag,a=r.type,i=this.loaders[a],n=r.decryptdata,o=n.uri;if(o!==this.decrypturl||null===this.decryptkey){var s=this.hls.config;i&&(c.logger.warn("abort previous key loader for type:"+a),i.abort()),r.loader=this.loaders[a]=new s.loader(s),this.decrypturl=o,this.decryptkey=null;var l=void 0,d=void 0,f=void 0;l={url:o,frag:r,responseType:"arraybuffer"},d={timeout:s.fragLoadingTimeOut,maxRetry:s.fragLoadingMaxRetry,retryDelay:s.fragLoadingRetryDelay,maxRetryDelay:s.fragLoadingMaxRetryTimeout},f={onSuccess:this.loadsuccess.bind(this),onError:this.loaderror.bind(this),onTimeout:this.loadtimeout.bind(this)},r.loader.load(l,d,f)}else this.decryptkey&&(n.key=this.decryptkey,this.hls.trigger(u.default.KEY_LOADED,{frag:r}))}},{key:"loadsuccess",value:function e(t,r,a){var i=a.frag;this.decryptkey=i.decryptdata.key=new Uint8Array(t.data),i.loader=void 0,this.loaders[i.type]=void 0,this.hls.trigger(u.default.KEY_LOADED,{frag:i})}},{key:"loaderror",value:function e(t,r){var a=r.frag,i=a.loader;i&&i.abort(),this.loaders[r.type]=void 0,this.hls.trigger(u.default.ERROR,{type:h.ErrorTypes.NETWORK_ERROR,details:h.ErrorDetails.KEY_LOAD_ERROR,fatal:!1,frag:a,response:t})}},{key:"loadtimeout",value:function e(t,r){var a=r.frag,i=a.loader;i&&i.abort(),this.loaders[r.type]=void 0,this.hls.trigger(u.default.ERROR,{type:h.ErrorTypes.NETWORK_ERROR,details:h.ErrorDetails.KEY_LOAD_TIMEOUT,fatal:!1,frag:a})}}]),t}(f.default);r.default=v},{28:28,29:29,30:30,46:46}],38:[function(e,t,r){"use strict";function a(e){return e&&e.__esModule?e:{default:e}}function i(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function n(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(r,"__esModule",{value:!0});var s=function(){function e(e,t){for(var r=0;r<t.length;r++){var a=t[r];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}return function(t,r,a){return r&&e(t.prototype,r),a&&e(t,a),t}}(),l=e(2),u=a(l),d=e(30),f=a(d),h=e(29),c=a(h),v=e(28),g=e(42),p=a(g),y=e(46),m=/#EXT-X-STREAM-INF:([^\n\r]*)[\r\n]+([^\r\n]+)/g,E=/#EXT-X-MEDIA:(.*)/g,b=new RegExp([/#EXTINF:(\d*(?:\.\d+)?)(?:,(.*)\s+)?/.source,/|(?!#)(\S+)/.source,/|#EXT-X-BYTERANGE:*(.+)/.source,/|#EXT-X-PROGRAM-DATE-TIME:(.+)/.source,/|#.*/.source].join(""),"g"),_=/(?:(?:#(EXTM3U))|(?:#EXT-X-(PLAYLIST-TYPE):(.+))|(?:#EXT-X-(MEDIA-SEQUENCE): *(\d+))|(?:#EXT-X-(TARGETDURATION): *(\d+))|(?:#EXT-X-(KEY):(.+))|(?:#EXT-X-(START):(.+))|(?:#EXT-X-(ENDLIST))|(?:#EXT-X-(DISCONTINUITY-SEQ)UENCE:(\d+))|(?:#EXT-X-(DIS)CONTINUITY))|(?:#EXT-X-(VERSION):(\d+))|(?:#EXT-X-(MAP):(.+))|(?:(#)(.*):(.*))|(?:(#)(.*))(?:.*)\r?\n?/,R=function(){function e(){o(this,e),this.method=null,this.key=null,this.iv=null,this._uri=null}return s(e,[{key:"uri",get:function e(){return!this._uri&&this.reluri&&(this._uri=u.default.buildAbsoluteURL(this.baseuri,this.reluri,{alwaysNormalize:!0})),this._uri}}]),e}(),S=function(){function e(){o(this,e),this._url=null,this._byteRange=null,this._decryptdata=null,this.tagList=[]}return s(e,[{key:"createInitializationVector",value:function e(t){for(var r=new Uint8Array(16),a=12;a<16;a++)r[a]=t>>8*(15-a)&255;return r}},{key:"fragmentDecryptdataFromLevelkey",value:function e(t,r){var a=t;return t&&t.method&&t.uri&&!t.iv&&(a=new R,a.method=t.method,a.baseuri=t.baseuri,a.reluri=t.reluri,a.iv=this.createInitializationVector(r)),a}},{key:"cloneObj",value:function e(t){return JSON.parse(JSON.stringify(t))}},{key:"url",get:function e(){return!this._url&&this.relurl&&(this._url=u.default.buildAbsoluteURL(this.baseurl,this.relurl,{alwaysNormalize:!0})),this._url},set:function e(t){this._url=t}},{key:"programDateTime",get:function e(){return!this._programDateTime&&this.rawProgramDateTime&&(this._programDateTime=new Date(Date.parse(this.rawProgramDateTime))),this._programDateTime}},{key:"byteRange",get:function e(){if(!this._byteRange){var t=this._byteRange=[];if(this.rawByteRange){var r=this.rawByteRange.split("@",2);if(1===r.length){var a=this.lastByteRangeEndOffset;t[0]=a||0}else t[0]=parseInt(r[1]);t[1]=parseInt(r[0])+t[0]}}return this._byteRange}},{key:"byteRangeStartOffset",get:function e(){return this.byteRange[0]}},{key:"byteRangeEndOffset",get:function e(){return this.byteRange[1]}},{key:"decryptdata",get:function e(){return this._decryptdata||(this._decryptdata=this.fragmentDecryptdataFromLevelkey(this.levelkey,this.sn)),this._decryptdata}}]),e}(),T=function(e){function t(e){o(this,t);var r=i(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,f.default.MANIFEST_LOADING,f.default.LEVEL_LOADING,f.default.AUDIO_TRACK_LOADING,f.default.SUBTITLE_TRACK_LOADING));return r.loaders={},r}return n(t,e),s(t,[{key:"destroy",value:function e(){for(var t in this.loaders){var r=this.loaders[t];r&&r.destroy()}this.loaders={},c.default.prototype.destroy.call(this)}},{key:"onManifestLoading",value:function e(t){this.load(t.url,{type:"manifest"})}},{key:"onLevelLoading",value:function e(t){this.load(t.url,{type:"level",level:t.level,id:t.id})}},{key:"onAudioTrackLoading",value:function e(t){this.load(t.url,{type:"audioTrack",id:t.id})}},{key:"onSubtitleTrackLoading",value:function e(t){this.load(t.url,{type:"subtitleTrack",id:t.id})}},{key:"load",value:function e(t,r){var a=this.loaders[r.type];if(a){var i=a.context;if(i&&i.url===t)return void y.logger.trace("playlist request ongoing");y.logger.warn("abort previous loader for type:"+r.type),a.abort()}var n=this.hls.config,o=void 0,s=void 0,l=void 0,u=void 0;"manifest"===r.type?(o=n.manifestLoadingMaxRetry,s=n.manifestLoadingTimeOut,l=n.manifestLoadingRetryDelay,u=n.manifestLoadingMaxRetryTimeout):(o=n.levelLoadingMaxRetry,s=n.levelLoadingTimeOut,l=n.levelLoadingRetryDelay,u=n.levelLoadingMaxRetryTimeout,y.logger.log("loading playlist for "+r.type+" "+(r.level||r.id))),a=this.loaders[r.type]=r.loader=void 0!==n.pLoader?new n.pLoader(n):new n.loader(n),r.url=t,r.responseType="";var d=void 0,f=void 0;d={timeout:s,maxRetry:o,retryDelay:l,maxRetryDelay:u},f={onSuccess:this.loadsuccess.bind(this),onError:this.loaderror.bind(this),onTimeout:this.loadtimeout.bind(this)},a.load(r,d,f)}},{key:"resolve",value:function e(t,r){return u.default.buildAbsoluteURL(r,t,{alwaysNormalize:!0})}},{key:"parseMasterPlaylist",value:function e(t,r){var a=[],i=void 0;for(m.lastIndex=0;null!=(i=m.exec(t));){var n={},o=n.attrs=new p.default(i[1]);n.url=this.resolve(i[2],r);var s=o.decimalResolution("RESOLUTION");s&&(n.width=s.width,n.height=s.height),n.bitrate=o.decimalInteger("AVERAGE-BANDWIDTH")||o.decimalInteger("BANDWIDTH"),n.name=o.NAME;var l=o.CODECS;if(l){l=l.split(/[ ,]+/);for(var u=0;u<l.length;u++){var d=l[u];-1!==d.indexOf("avc1")?n.videoCodec=this.avc1toavcoti(d):-1!==d.indexOf("hvc1")?n.videoCodec=d:n.audioCodec=d}}a.push(n)}return a}},{key:"parseMasterPlaylistMedia",value:function e(t,r,a){var i=void 0,n=[],o=0;for(E.lastIndex=0;null!=(i=E.exec(t));){var s={},l=new p.default(i[1]);l.TYPE===a&&(s.groupId=l["GROUP-ID"],s.name=l.NAME,s.type=a,s.default="YES"===l.DEFAULT,s.autoselect="YES"===l.AUTOSELECT,s.forced="YES"===l.FORCED,l.URI&&(s.url=this.resolve(l.URI,r)),s.lang=l.LANGUAGE,s.name||(s.name=s.lang),s.id=o++,n.push(s))}return n}},{key:"avc1toavcoti",value:function e(t){var r,a=t.split(".");return a.length>2?(r=a.shift()+".",r+=parseInt(a.shift()).toString(16),r+=("000"+parseInt(a.shift()).toString(16)).substr(-4)):r=t,r}},{key:"parseLevelPlaylist",value:function e(t,r,a,i){var n=0,o=0,s={type:null,version:null,url:r,fragments:[],live:!0,startSN:0},l=new R,u=0,d=null,f=new S,h,c;for(b.lastIndex=0;null!==(h=b.exec(t));){var v=h[1];if(v){f.duration=parseFloat(v);var g=(" "+h[2]).slice(1);f.title=g||null,f.tagList.push(g?["INF",v,g]:["INF",v])}else if(h[3]){if(!isNaN(f.duration)){var m=n++;f.type=i,f.start=o,f.levelkey=l,f.sn=m,f.level=a,f.cc=u,f.baseurl=r,f.relurl=(" "+h[3]).slice(1),s.fragments.push(f),d=f,o+=f.duration,f=new S}}else if(h[4]){if(f.rawByteRange=(" "+h[4]).slice(1),d){var E=d.byteRangeEndOffset;E&&(f.lastByteRangeEndOffset=E)}}else if(h[5])f.rawProgramDateTime=(" "+h[5]).slice(1),f.tagList.push(["PROGRAM-DATE-TIME",f.rawProgramDateTime]);else{for(h=h[0].match(_),c=1;c<h.length&&void 0===h[c];c++);var T=(" "+h[c+1]).slice(1),L=(" "+h[c+2]).slice(1);switch(h[c]){case"#":f.tagList.push(L?[T,L]:[T]);break;case"PLAYLIST-TYPE":s.type=T.toUpperCase();break;case"MEDIA-SEQUENCE":n=s.startSN=parseInt(T);break;case"TARGETDURATION":s.targetduration=parseFloat(T);break;case"VERSION":s.version=parseInt(T);break;case"EXTM3U":break;case"ENDLIST":s.live=!1;break;case"DIS":u++,f.tagList.push(["DIS"]);break;case"DISCONTINUITY-SEQ":u=parseInt(T);break;case"KEY":var A=T,k=new p.default(A),D=k.enumeratedString("METHOD"),w=k.URI,O=k.hexadecimalInteger("IV");D&&(l=new R,w&&["AES-128","SAMPLE-AES"].indexOf(D)>=0&&(l.method=D,l.baseuri=r,l.reluri=w,l.key=null,l.iv=O));break;case"START":var P=T,C=new p.default(P),M=C.decimalFloatingPoint("TIME-OFFSET");isNaN(M)||(s.startTimeOffset=M);break;case"MAP":var x=new p.default(T);f.relurl=x.URI,f.rawByteRange=x.BYTERANGE,f.baseurl=r,f.level=a,f.type=i,f.sn="initSegment",s.initSegment=f,f=new S;break;default:y.logger.warn("line parsed but not handled: "+h)}}}return f=d,f&&!f.relurl&&(s.fragments.pop(),o-=f.duration),s.totalduration=o,s.averagetargetduration=o/s.fragments.length,s.endSN=n-1,s}},{key:"loadsuccess",value:function e(t,r,a){var i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,n=t.data,o=t.url,s=a.type,l=a.id,u=a.level,d=this.hls;if(this.loaders[s]=void 0,void 0!==o&&0!==o.indexOf("data:")||(o=a.url),r.tload=performance.now(),0===n.indexOf("#EXTM3U"))if(n.indexOf("#EXTINF:")>0){var h="audioTrack"!==s&&"subtitleTrack"!==s,c=isNaN(u)?isNaN(l)?0:l:u,g=this.parseLevelPlaylist(n,o,c,"audioTrack"===s?"audio":"subtitleTrack"===s?"subtitle":"main");g.tload=r.tload,"manifest"===s&&d.trigger(f.default.MANIFEST_LOADED,{levels:[{url:o,details:g}],audioTracks:[],url:o,stats:r,networkDetails:i}),r.tparsed=performance.now(),g.targetduration?h?d.trigger(f.default.LEVEL_LOADED,{details:g,level:u||0,id:l||0,stats:r,networkDetails:i}):"audioTrack"===s?d.trigger(f.default.AUDIO_TRACK_LOADED,{details:g,id:l,stats:r,networkDetails:i}):"subtitleTrack"===s&&d.trigger(f.default.SUBTITLE_TRACK_LOADED,{details:g,id:l,stats:r,networkDetails:i}):d.trigger(f.default.ERROR,{type:v.ErrorTypes.NETWORK_ERROR,details:v.ErrorDetails.MANIFEST_PARSING_ERROR,fatal:!0,url:o,reason:"invalid targetduration",networkDetails:i})}else{var p=this.parseMasterPlaylist(n,o);if(p.length){var m=this.parseMasterPlaylistMedia(n,o,"AUDIO"),E=this.parseMasterPlaylistMedia(n,o,"SUBTITLES");if(m.length){var b=!1;m.forEach(function(e){e.url||(b=!0)}),!1===b&&p[0].audioCodec&&!p[0].attrs.AUDIO&&(y.logger.log("audio codec signaled in quality level, but no embedded audio track signaled, create one"),m.unshift({type:"main",name:"main"}))}d.trigger(f.default.MANIFEST_LOADED,{levels:p,audioTracks:m,subtitles:E,url:o,stats:r,networkDetails:i})}else d.trigger(f.default.ERROR,{type:v.ErrorTypes.NETWORK_ERROR,details:v.ErrorDetails.MANIFEST_PARSING_ERROR,fatal:!0,url:o,reason:"no level found in manifest",networkDetails:i})}else d.trigger(f.default.ERROR,{type:v.ErrorTypes.NETWORK_ERROR,details:v.ErrorDetails.MANIFEST_PARSING_ERROR,fatal:!0,url:o,reason:"no EXTM3U delimiter",networkDetails:i})}},{key:"loaderror",value:function e(t,r){var a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,i,n,o=r.loader;switch(r.type){case"manifest":i=v.ErrorDetails.MANIFEST_LOAD_ERROR,n=!0;break;case"level":i=v.ErrorDetails.LEVEL_LOAD_ERROR,n=!1;break;case"audioTrack":i=v.ErrorDetails.AUDIO_TRACK_LOAD_ERROR,n=!1}o&&(o.abort(),this.loaders[r.type]=void 0),this.hls.trigger(f.default.ERROR,{type:v.ErrorTypes.NETWORK_ERROR,details:i,fatal:n,url:o.url,loader:o,response:t,context:r,networkDetails:a})}},{key:"loadtimeout",value:function e(t,r){var a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,i,n,o=r.loader;switch(r.type){case"manifest":i=v.ErrorDetails.MANIFEST_LOAD_TIMEOUT,n=!0;break;case"level":i=v.ErrorDetails.LEVEL_LOAD_TIMEOUT,n=!1;break;case"audioTrack":i=v.ErrorDetails.AUDIO_TRACK_LOAD_TIMEOUT,n=!1}o&&(o.abort(),this.loaders[r.type]=void 0),this.hls.trigger(f.default.ERROR,{type:v.ErrorTypes.NETWORK_ERROR,details:i,fatal:n,url:o.url,loader:o,context:r,networkDetails:a})}}]),t}(c.default);r.default=T},{2:2,28:28,29:29,30:30,42:42,46:46}],39:[function(e,t,r){"use strict";function a(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(r,"__esModule",{value:!0});var i=function(){function e(e,t){for(var r=0;r<t.length;r++){var a=t[r];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}return function(t,r,a){return r&&e(t.prototype,r),a&&e(t,a),t}}(),n=Math.pow(2,32)-1,o=function(){function e(){a(this,e)}return i(e,null,[{key:"init",value:function t(){e.types={avc1:[],avcC:[],btrt:[],dinf:[],dref:[],esds:[],ftyp:[],hdlr:[],mdat:[],mdhd:[],mdia:[],mfhd:[],minf:[],moof:[],moov:[],mp4a:[],".mp3":[],mvex:[],mvhd:[],pasp:[],sdtp:[],stbl:[],stco:[],stsc:[],stsd:[],stsz:[],stts:[],tfdt:[],tfhd:[],traf:[],trak:[],trun:[],trex:[],tkhd:[],vmhd:[],smhd:[]};var r;for(r in e.types)e.types.hasOwnProperty(r)&&(e.types[r]=[r.charCodeAt(0),r.charCodeAt(1),r.charCodeAt(2),r.charCodeAt(3)]);var a=new Uint8Array([0,0,0,0,0,0,0,0,118,105,100,101,0,0,0,0,0,0,0,0,0,0,0,0,86,105,100,101,111,72,97,110,100,108,101,114,0]),i=new Uint8Array([0,0,0,0,0,0,0,0,115,111,117,110,0,0,0,0,0,0,0,0,0,0,0,0,83,111,117,110,100,72,97,110,100,108,101,114,0]);e.HDLR_TYPES={video:a,audio:i};var n=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,12,117,114,108,32,0,0,0,1]),o=new Uint8Array([0,0,0,0,0,0,0,0]);e.STTS=e.STSC=e.STCO=o,e.STSZ=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0]),e.VMHD=new Uint8Array([0,0,0,1,0,0,0,0,0,0,0,0]),e.SMHD=new Uint8Array([0,0,0,0,0,0,0,0]),e.STSD=new Uint8Array([0,0,0,0,0,0,0,1]);var s=new Uint8Array([105,115,111,109]),l=new Uint8Array([97,118,99,49]),u=new Uint8Array([0,0,0,1]);e.FTYP=e.box(e.types.ftyp,s,u,s,l),e.DINF=e.box(e.types.dinf,e.box(e.types.dref,n))}},{key:"box",value:function e(t){for(var r=Array.prototype.slice.call(arguments,1),a=8,i=r.length,n=i,o;i--;)a+=r[i].byteLength;for(o=new Uint8Array(a),o[0]=a>>24&255,o[1]=a>>16&255,o[2]=a>>8&255,o[3]=255&a,o.set(t,4),i=0,a=8;i<n;i++)o.set(r[i],a),a+=r[i].byteLength;return o}},{key:"hdlr",value:function t(r){return e.box(e.types.hdlr,e.HDLR_TYPES[r])}},{key:"mdat",value:function t(r){return e.box(e.types.mdat,r)}},{key:"mdhd",value:function t(r,a){a*=r;var i=Math.floor(a/(n+1)),o=Math.floor(a%(n+1));return e.box(e.types.mdhd,new Uint8Array([1,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,r>>24&255,r>>16&255,r>>8&255,255&r,i>>24,i>>16&255,i>>8&255,255&i,o>>24,o>>16&255,o>>8&255,255&o,85,196,0,0]))}},{key:"mdia",value:function t(r){return e.box(e.types.mdia,e.mdhd(r.timescale,r.duration),e.hdlr(r.type),e.minf(r))}},{key:"mfhd",value:function t(r){return e.box(e.types.mfhd,new Uint8Array([0,0,0,0,r>>24,r>>16&255,r>>8&255,255&r]))}},{key:"minf",value:function t(r){return"audio"===r.type?e.box(e.types.minf,e.box(e.types.smhd,e.SMHD),e.DINF,e.stbl(r)):e.box(e.types.minf,e.box(e.types.vmhd,e.VMHD),e.DINF,e.stbl(r))}},{key:"moof",value:function t(r,a,i){return e.box(e.types.moof,e.mfhd(r),e.traf(i,a))}},{key:"moov",value:function t(r){for(var a=r.length,i=[];a--;)i[a]=e.trak(r[a]);return e.box.apply(null,[e.types.moov,e.mvhd(r[0].timescale,r[0].duration)].concat(i).concat(e.mvex(r)))}},{key:"mvex",value:function t(r){for(var a=r.length,i=[];a--;)i[a]=e.trex(r[a]);return e.box.apply(null,[e.types.mvex].concat(i))}},{key:"mvhd",value:function t(r,a){a*=r;var i=Math.floor(a/(n+1)),o=Math.floor(a%(n+1)),s=new Uint8Array([1,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,r>>24&255,r>>16&255,r>>8&255,255&r,i>>24,i>>16&255,i>>8&255,255&i,o>>24,o>>16&255,o>>8&255,255&o,0,1,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,255,255,255,255]);return e.box(e.types.mvhd,s)}},{key:"sdtp",value:function t(r){var a=r.samples||[],i=new Uint8Array(4+a.length),n,o;for(o=0;o<a.length;o++)n=a[o].flags,i[o+4]=n.dependsOn<<4|n.isDependedOn<<2|n.hasRedundancy;return e.box(e.types.sdtp,i)}},{key:"stbl",value:function t(r){return e.box(e.types.stbl,e.stsd(r),e.box(e.types.stts,e.STTS),e.box(e.types.stsc,e.STSC),e.box(e.types.stsz,e.STSZ),e.box(e.types.stco,e.STCO))}},{key:"avc1",value:function t(r){var a=[],i=[],n,o,s;for(n=0;n<r.sps.length;n++)o=r.sps[n],s=o.byteLength,a.push(s>>>8&255),a.push(255&s),a=a.concat(Array.prototype.slice.call(o));for(n=0;n<r.pps.length;n++)o=r.pps[n],s=o.byteLength,i.push(s>>>8&255),i.push(255&s),i=i.concat(Array.prototype.slice.call(o));var l=e.box(e.types.avcC,new Uint8Array([1,a[3],a[4],a[5],255,224|r.sps.length].concat(a).concat([r.pps.length]).concat(i))),u=r.width,d=r.height,f=r.pixelRatio[0],h=r.pixelRatio[1];return e.box(e.types.avc1,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,u>>8&255,255&u,d>>8&255,255&d,0,72,0,0,0,72,0,0,0,0,0,0,0,1,18,100,97,105,108,121,109,111,116,105,111,110,47,104,108,115,46,106,115,0,0,0,0,0,0,0,0,0,0,0,0,0,0,24,17,17]),l,e.box(e.types.btrt,new Uint8Array([0,28,156,128,0,45,198,192,0,45,198,192])),e.box(e.types.pasp,new Uint8Array([f>>24,f>>16&255,f>>8&255,255&f,h>>24,h>>16&255,h>>8&255,255&h])))}},{key:"esds",value:function e(t){var r=t.config.length;return new Uint8Array([0,0,0,0,3,23+r,0,1,0,4,15+r,64,21,0,0,0,0,0,0,0,0,0,0,0,5].concat([r]).concat(t.config).concat([6,1,2]))}},{key:"mp4a",value:function t(r){var a=r.samplerate;return e.box(e.types.mp4a,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,r.channelCount,0,16,0,0,0,0,a>>8&255,255&a,0,0]),e.box(e.types.esds,e.esds(r)))}},{key:"mp3",value:function t(r){var a=r.samplerate;return e.box(e.types[".mp3"],new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,r.channelCount,0,16,0,0,0,0,a>>8&255,255&a,0,0]))}},{key:"stsd",value:function t(r){return"audio"===r.type?r.isAAC||"mp3"!==r.codec?e.box(e.types.stsd,e.STSD,e.mp4a(r)):e.box(e.types.stsd,e.STSD,e.mp3(r)):e.box(e.types.stsd,e.STSD,e.avc1(r))}},{key:"tkhd",value:function t(r){var a=r.id,i=r.duration*r.timescale,o=r.width,s=r.height,l=Math.floor(i/(n+1)),u=Math.floor(i%(n+1));return e.box(e.types.tkhd,new Uint8Array([1,0,0,7,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,a>>24&255,a>>16&255,a>>8&255,255&a,0,0,0,0,l>>24,l>>16&255,l>>8&255,255&l,u>>24,u>>16&255,u>>8&255,255&u,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,o>>8&255,255&o,0,0,s>>8&255,255&s,0,0]))}},{key:"traf",value:function t(r,a){var i=e.sdtp(r),o=r.id,s=Math.floor(a/(n+1)),l=Math.floor(a%(n+1));return e.box(e.types.traf,e.box(e.types.tfhd,new Uint8Array([0,0,0,0,o>>24,o>>16&255,o>>8&255,255&o])),e.box(e.types.tfdt,new Uint8Array([1,0,0,0,s>>24,s>>16&255,s>>8&255,255&s,l>>24,l>>16&255,l>>8&255,255&l])),e.trun(r,i.length+16+20+8+16+8+8),i)}},{key:"trak",value:function t(r){return r.duration=r.duration||4294967295,e.box(e.types.trak,e.tkhd(r),e.mdia(r))}},{key:"trex",value:function t(r){var a=r.id;return e.box(e.types.trex,new Uint8Array([0,0,0,0,a>>24,a>>16&255,a>>8&255,255&a,0,0,0,1,0,0,0,0,0,0,0,0,0,1,0,1]))}},{key:"trun",value:function t(r,a){var i=r.samples||[],n=i.length,o=12+16*n,s=new Uint8Array(o),l,u,d,f,h,c;for(a+=8+o,s.set([0,0,15,1,n>>>24&255,n>>>16&255,n>>>8&255,255&n,a>>>24&255,a>>>16&255,a>>>8&255,255&a],0),l=0;l<n;l++)u=i[l],d=u.duration,f=u.size,h=u.flags,c=u.cts,s.set([d>>>24&255,d>>>16&255,d>>>8&255,255&d,f>>>24&255,f>>>16&255,f>>>8&255,255&f,h.isLeading<<2|h.dependsOn,h.isDependedOn<<6|h.hasRedundancy<<4|h.paddingValue<<1|h.isNonSync,61440&h.degradPrio,15&h.degradPrio,c>>>24&255,c>>>16&255,c>>>8&255,255&c],12+16*l);return e.box(e.types.trun,s)}},{key:"initSegment",value:function t(r){e.types||e.init();var a=e.moov(r),i;return i=new Uint8Array(e.FTYP.byteLength+a.byteLength),i.set(e.FTYP),i.set(a,e.FTYP.byteLength),i}}]),e}();r.default=o},{}],40:[function(e,t,r){"use strict";function a(e){return e&&e.__esModule?e:{default:e}}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(r,"__esModule",{value:!0});var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var a=t[r];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}return function(t,r,a){return r&&e(t.prototype,r),a&&e(t,a),t}}(),o=e(31),s=a(o),l=e(30),u=a(l),d=e(46),f=e(39),h=a(f),c=e(28),v=1e4,g=function(){function e(t,r,a,n){i(this,e),this.observer=t,this.config=r,this.typeSupported=a;var o=navigator.userAgent;this.isSafari=n&&n.indexOf("Apple")>-1&&o&&!o.match("CriOS"),this.ISGenerated=!1}return n(e,[{key:"destroy",value:function e(){}},{key:"resetTimeStamp",value:function e(t){this._initPTS=this._initDTS=t}},{key:"resetInitSegment",value:function e(){this.ISGenerated=!1}},{key:"remux",value:function e(t,r,a,i,n,o,s){if(this.ISGenerated||this.generateIS(t,r,n),this.ISGenerated)if(t.samples.length){t.timescale||(d.logger.warn("regenerate InitSegment as audio detected"),this.generateIS(t,r,n));var l=this.remuxAudio(t,n,o,s);if(r.samples.length){var f=void 0;l&&(f=l.endPTS-l.startPTS),r.timescale||(d.logger.warn("regenerate InitSegment as video detected"),this.generateIS(t,r,n)),this.remuxVideo(r,n,o,f,s)}}else{var h=void 0;r.samples.length&&(h=this.remuxVideo(r,n,o,s)),h&&t.codec&&this.remuxEmptyAudio(t,n,o,h)}a.samples.length&&this.remuxID3(a,n),i.samples.length&&this.remuxText(i,n),this.observer.trigger(u.default.FRAG_PARSED)}},{key:"generateIS",value:function e(t,r,a){var i=this.observer,n=t.samples,o=r.samples,s=this.typeSupported,l="audio/mp4",f={},v={tracks:f},g=void 0===this._initPTS,p,y;if(g&&(p=y=1/0),t.config&&n.length&&(t.timescale=t.samplerate,d.logger.log("audio sampling rate : "+t.samplerate),t.isAAC||(s.mpeg?(l="audio/mpeg",t.codec=""):s.mp3&&(t.codec="mp3")),f.audio={container:l,codec:t.codec,initSegment:!t.isAAC&&s.mpeg?new Uint8Array:h.default.initSegment([t]),metadata:{channelCount:t.channelCount}},g&&(p=y=n[0].pts-t.inputTimeScale*a)),r.sps&&r.pps&&o.length){var m=r.inputTimeScale;r.timescale=m,f.video={container:"video/mp4",codec:r.codec,initSegment:h.default.initSegment([r]),metadata:{width:r.width,height:r.height}},g&&(p=Math.min(p,o[0].pts-m*a),y=Math.min(y,o[0].dts-m*a),this.observer.trigger(u.default.INIT_PTS_FOUND,{initPTS:p}))}Object.keys(f).length?(i.trigger(u.default.FRAG_PARSING_INIT_SEGMENT,v),this.ISGenerated=!0,g&&(this._initPTS=p,this._initDTS=y)):i.trigger(u.default.ERROR,{type:c.ErrorTypes.MEDIA_ERROR,details:c.ErrorDetails.FRAG_PARSING_ERROR,fatal:!1,reason:"no audio/video samples found"})}},{key:"remuxVideo",value:function e(t,r,a,i,n){var o=8,s=t.timescale,l,f,v,g,p,y,m,E,b=t.samples,_=[],R=b.length,S=this._PTSNormalize,T=this._initDTS,L=this.nextAvcDts,A=this.isSafari;A&&(a|=b.length&&L&&(n&&Math.abs(r-L/s)<.1||Math.abs(b[0].pts-L-T)<s/5)),a||(L=r*s),b.forEach(function(e){e.pts=S(e.pts-T,L),e.dts=S(e.dts-T,L)}),b.sort(function(e,t){var r=e.dts-t.dts,a=e.pts-t.pts;return r||(a||e.id-t.id)});var k=b.reduce(function(e,t){return Math.max(Math.min(e,t.pts-t.dts),-18e3)},0);if(k<0){d.logger.warn("PTS < DTS detected in video samples, shifting DTS by "+Math.round(k/90)+" ms to overcome this issue");for(var D=0;D<b.length;D++)b[D].dts+=k}var w=b[0];p=Math.max(w.dts,0),g=Math.max(w.pts,0);var O=Math.round((p-L)/90);a&&O&&(O>1?d.logger.log("AVC:"+O+" ms hole between fragments detected,filling it"):O<-1&&d.logger.log("AVC:"+-O+" ms overlapping between fragments detected"),p=L,b[0].dts=p,g=Math.max(g-O,L),b[0].pts=g,d.logger.log("Video/PTS/DTS adjusted: "+Math.round(g/90)+"/"+Math.round(p/90)+",delta:"+O+" ms")),y=p,w=b[b.length-1],E=Math.max(w.dts,0),m=Math.max(w.pts,0,E),A&&(l=Math.round((E-p)/(b.length-1)));for(var P=0,C=0,M=0;M<R;M++){for(var x=b[M],I=x.units,F=I.length,N=0,U=0;U<F;U++)N+=I[U].data.length;C+=N,P+=F,x.length=N,x.dts=A?p+M*l:Math.max(x.dts,p),x.pts=Math.max(x.pts,x.dts)}var B=C+4*P+8;try{f=new Uint8Array(B)}catch(e){return void this.observer.trigger(u.default.ERROR,{type:c.ErrorTypes.MUX_ERROR,details:c.ErrorDetails.REMUX_ALLOC_ERROR,fatal:!1,bytes:B,reason:"fail allocating video mdat "+B})}var G=new DataView(f.buffer);G.setUint32(0,B),f.set(h.default.types.mdat,4);for(var j=0;j<R;j++){for(var H=b[j],V=H.units,W=0,K=void 0,z=0,q=V.length;z<q;z++){var Y=V[z],X=Y.data,Q=Y.data.byteLength;G.setUint32(o,Q),o+=4,f.set(X,o),o+=Q,W+=4+Q}if(A)K=Math.max(0,l*Math.round((H.pts-H.dts)/l));else{if(j<R-1)l=b[j+1].dts-H.dts;else{var J=this.config,Z=H.dts-b[j>0?j-1:j].dts;if(J.stretchShortVideoTrack){var $=J.maxBufferHole,ee=J.maxSeekHole,te=Math.floor(Math.min($,ee)*s),re=(i?g+i*s:this.nextAudioPts)-H.pts;re>te?(l=re-Z,l<0&&(l=Z),d.logger.log("It is approximately "+re/90+" ms to the next segment; using duration "+l/90+" ms for the last video frame.")):l=Z}else l=Z}K=Math.round(H.pts-H.dts)}_.push({size:W,duration:l,cts:K,flags:{isLeading:0,isDependedOn:0,hasRedundancy:0,degradPrio:0,dependsOn:H.key?2:1,isNonSync:H.key?0:1}})}this.nextAvcDts=E+l;var ae=t.dropped;if(t.len=0,t.nbNalu=0,t.dropped=0,_.length&&navigator.userAgent.toLowerCase().indexOf("chrome")>-1){var ie=_[0].flags;ie.dependsOn=2,ie.isNonSync=0}t.samples=_,v=h.default.moof(t.sequenceNumber++,p,t),t.samples=[];var ne={data1:v,data2:f,startPTS:g/s,endPTS:(m+l)/s,startDTS:p/s,endDTS:this.nextAvcDts/s,type:"video",nb:_.length,dropped:ae};return this.observer.trigger(u.default.FRAG_PARSING_DATA,ne),ne}},{key:"remuxAudio",value:function e(t,r,a,i){var n=t.inputTimeScale,o=t.timescale,l=n/o,f=t.isAAC?1024:1152,v=f*l,g=this._PTSNormalize,p=this._initDTS,y=!t.isAAC&&this.typeSupported.mpeg,m,E,b,_,R,S,T,L=t.samples,A=[],k=this.nextAudioPts;if(a|=L.length&&k&&(i&&Math.abs(r-k/n)<.1||Math.abs(L[0].pts-k-p)<20*v),a||(k=r*n),L.forEach(function(e){e.pts=e.dts=g(e.pts-p,k)}),L.sort(function(e,t){return e.pts-t.pts}),i&&t.isAAC)for(var D=0,w=k;D<L.length;){var O=L[D],P,C=O.pts;P=C-w;var M=Math.abs(1e3*P/n);if(P<=-v)d.logger.warn("Dropping 1 audio frame @ "+(w/n).toFixed(3)+"s due to "+M+" ms overlap."),L.splice(D,1),t.len-=O.unit.length;else if(P>=v&&M<1e4&&w){var x=Math.round(P/v);d.logger.warn("Injecting "+x+" audio frame @ "+(w/n).toFixed(3)+"s due to "+Math.round(1e3*P/n)+" ms gap.");for(var I=0;I<x;I++){var F=Math.max(w,0);b=s.default.getSilentFrame(t.manifestCodec||t.codec,t.channelCount),b||(d.logger.log("Unable to get silent frame for given audio codec; duplicating last frame instead."),b=O.unit.subarray()),L.splice(D,0,{unit:b,pts:F,dts:F}),t.len+=b.length,w+=v,D++}O.pts=O.dts=w,w+=v,D++}else Math.abs(P),O.pts=O.dts=w,w+=v,D++}for(var N=0,U=L.length;N<U;N++){var B=L[N],G=B.unit,j=B.pts;if(void 0!==T)E.duration=Math.round((j-T)/l);else{var H=Math.round(1e3*(j-k)/n),V=0;if(a&&t.isAAC&&H){if(H>0&&H<1e4)V=Math.round((j-k)/v),d.logger.log(H+" ms hole between AAC samples detected,filling it"),V>0&&(b=s.default.getSilentFrame(t.manifestCodec||t.codec,t.channelCount),b||(b=G.subarray()),t.len+=V*b.length);else if(H<-12){d.logger.log("drop overlapping AAC sample, expected/parsed/delta:"+(k/n).toFixed(3)+"s/"+(j/n).toFixed(3)+"s/"+-H+"ms"),t.len-=G.byteLength;continue}j=k}if(S=Math.max(0,j),!(t.len>0))return;var W=y?t.len:t.len+8;m=y?0:8;try{_=new Uint8Array(W)}catch(e){return void this.observer.trigger(u.default.ERROR,{type:c.ErrorTypes.MUX_ERROR,details:c.ErrorDetails.REMUX_ALLOC_ERROR,fatal:!1,bytes:W,reason:"fail allocating audio mdat "+W})}if(!y){var K=new DataView(_.buffer);K.setUint32(0,W),_.set(h.default.types.mdat,4)}for(var z=0;z<V;z++)b=s.default.getSilentFrame(t.manifestCodec||t.codec,t.channelCount),b||(d.logger.log("Unable to get silent frame for given audio codec; duplicating this frame instead."),b=G.subarray()),_.set(b,m),m+=b.byteLength,E={size:b.byteLength,cts:0,duration:1024,flags:{isLeading:0,isDependedOn:0,hasRedundancy:0,degradPrio:0,dependsOn:1}},A.push(E)}_.set(G,m);var q=G.byteLength;m+=q,E={size:q,cts:0,duration:0,flags:{isLeading:0,isDependedOn:0,hasRedundancy:0,degradPrio:0,dependsOn:1}},A.push(E),T=j}var Y=0,X=A.length;if(X>=2&&(Y=A[X-2].duration,E.duration=Y),X){this.nextAudioPts=k=T+l*Y,t.len=0,t.samples=A,R=y?new Uint8Array:h.default.moof(t.sequenceNumber++,S/l,t),t.samples=[];var Q=S/n,J=k/n,Z={data1:R,data2:_,startPTS:Q,endPTS:J,startDTS:Q,endDTS:J,type:"audio",nb:X};return this.observer.trigger(u.default.FRAG_PARSING_DATA,Z),Z}return null}},{key:"remuxEmptyAudio",value:function e(t,r,a,i){var n=t.inputTimeScale,o=t.samplerate?t.samplerate:n,l=n/o,u=this.nextAudioPts,f=(void 0!==u?u:i.startDTS*n)+this._initDTS,h=i.endDTS*n+this._initDTS,c=1024,v=1024*l,g=Math.ceil((h-f)/v),p=s.default.getSilentFrame(t.manifestCodec||t.codec,t.channelCount);if(d.logger.warn("remux empty Audio"),!p)return void d.logger.trace("Unable to remuxEmptyAudio since we were unable to get a silent frame for given audio codec!");for(var y=[],m=0;m<g;m++){var E=f+m*v;y.push({unit:p,pts:E,dts:E}),t.len+=p.length}t.samples=y,this.remuxAudio(t,r,a)}},{key:"remuxID3",value:function e(t,r){var a=t.samples.length,i,n=t.inputTimeScale,o=this._initPTS,s=this._initDTS;if(a){for(var l=0;l<a;l++)i=t.samples[l],i.pts=(i.pts-o)/n,i.dts=(i.dts-s)/n;this.observer.trigger(u.default.FRAG_PARSING_METADATA,{samples:t.samples})}t.samples=[],r=r}},{key:"remuxText",value:function e(t,r){t.samples.sort(function(e,t){return e.pts-t.pts});var a=t.samples.length,i,n=t.inputTimeScale,o=this._initPTS;if(a){for(var s=0;s<a;s++)i=t.samples[s],i.pts=(i.pts-o)/n;this.observer.trigger(u.default.FRAG_PARSING_USERDATA,{samples:t.samples})}t.samples=[],r=r}},{key:"_PTSNormalize",value:function e(t,r){var a;if(void 0===r)return t;for(a=r<t?-8589934592:8589934592;Math.abs(t-r)>4294967296;)t+=a;return t}}]),e}();r.default=g},{28:28,30:30,31:31,39:39,46:46}],41:[function(e,t,r){"use strict";function a(e){return e&&e.__esModule?e:{default:e}}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(r,"__esModule",{value:!0});var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var a=t[r];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}return function(t,r,a){return r&&e(t.prototype,r),a&&e(t,a),t}}(),o=e(30),s=a(o),l=function(){function e(t){i(this,e),this.observer=t}return n(e,[{key:"destroy",value:function e(){}},{key:"resetTimeStamp",value:function e(){}},{key:"resetInitSegment",value:function e(){}},{key:"remux",value:function e(t,r,a,i,n,o,l,u){var d=this.observer,f="";t&&(f+="audio"),r&&(f+="video"),d.trigger(s.default.FRAG_PARSING_DATA,{data1:u,startPTS:n,startDTS:n,type:f,nb:1,dropped:0}),d.trigger(s.default.FRAG_PARSED)}}]),e}();r.default=l},{30:30}],42:[function(e,t,r){"use strict";function a(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(r,"__esModule",{value:!0});var i=function(){function e(e,t){for(var r=0;r<t.length;r++){var a=t[r];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}return function(t,r,a){return r&&e(t.prototype,r),a&&e(t,a),t}}(),n=/^(\d+)x(\d+)$/,o=/\s*(.+?)\s*=((?:\".*?\")|.*?)(?:,|$)/g,s=function(){function e(t){a(this,e),"string"==typeof t&&(t=e.parseAttrList(t));for(var r in t)t.hasOwnProperty(r)&&(this[r]=t[r])}return i(e,[{key:"decimalInteger",value:function e(t){var r=parseInt(this[t],10);return r>Number.MAX_SAFE_INTEGER?1/0:r}},{key:"hexadecimalInteger",value:function e(t){if(this[t]){var r=(this[t]||"0x").slice(2);r=(1&r.length?"0":"")+r;for(var a=new Uint8Array(r.length/2),i=0;i<r.length/2;i++)a[i]=parseInt(r.slice(2*i,2*i+2),16);return a}return null}},{key:"hexadecimalIntegerAsNumber",value:function e(t){var r=parseInt(this[t],16);return r>Number.MAX_SAFE_INTEGER?1/0:r}},{key:"decimalFloatingPoint",value:function e(t){return parseFloat(this[t])}},{key:"enumeratedString",value:function e(t){return this[t]}},{key:"decimalResolution",value:function e(t){var r=n.exec(this[t]);if(null!==r)return{width:parseInt(r[1],10),height:parseInt(r[2],10)}}}],[{key:"parseAttrList",value:function e(t){var r,a={};for(o.lastIndex=0;null!==(r=o.exec(t));){var i=r[2],n='"';0===i.indexOf('"')&&i.lastIndexOf('"')===i.length-1&&(i=i.slice(1,-1)),a[r[1]]=i}return a}}]),e}();r.default=s},{}],43:[function(e,t,r){"use strict";var a={search:function e(t,r){for(var a=0,i=t.length-1,n=null,o=null;a<=i;){n=(a+i)/2|0,o=t[n];var s=r(o);if(s>0)a=n+1;else{if(!(s<0))return o;i=n-1}}return null}};t.exports=a},{}],44:[function(e,t,r){"use strict";function a(e){return e&&e.__esModule?e:{default:e}}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(r,"__esModule",{value:!0});var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var a=t[r];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}return function(t,r,a){return r&&e(t.prototype,r),a&&e(t,a),t}}(),o=e(45),s=a(o),l=function(){function e(t,r,a,n){i(this,e),this.hls=t,this.defaultEstimate_=n,this.minWeight_=.001,this.minDelayMs_=50,this.slow_=new s.default(r),this.fast_=new s.default(a)}return n(e,[{key:"sample",value:function e(t,r){t=Math.max(t,this.minDelayMs_);var a=8e3*r/t,i=t/1e3;this.fast_.sample(i,a),this.slow_.sample(i,a)}},{key:"canEstimate",value:function e(){var t=this.fast_;return t&&t.getTotalWeight()>=this.minWeight_}},{key:"getEstimate",value:function e(){return this.canEstimate()?Math.min(this.fast_.getEstimate(),this.slow_.getEstimate()):this.defaultEstimate_}},{key:"destroy",value:function e(){}}]),e}();r.default=l},{45:45}],45:[function(e,t,r){"use strict";function a(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(r,"__esModule",{value:!0});var i=function(){function e(e,t){for(var r=0;r<t.length;r++){var a=t[r];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}return function(t,r,a){return r&&e(t.prototype,r),a&&e(t,a),t}}(),n=function(){function e(t){a(this,e),this.alpha_=t?Math.exp(Math.log(.5)/t):0,this.estimate_=0,this.totalWeight_=0}return i(e,[{key:"sample",value:function e(t,r){var a=Math.pow(this.alpha_,t);this.estimate_=r*(1-a)+a*this.estimate_,this.totalWeight_+=t}},{key:"getTotalWeight",value:function e(){return this.totalWeight_}},{key:"getEstimate",value:function e(){if(this.alpha_){var t=1-Math.pow(this.alpha_,this.totalWeight_);return this.estimate_/t}return this.estimate_}}]),e}();r.default=n},{}],46:[function(e,t,r){"use strict";function a(){}function i(e,t){return t="["+e+"] > "+t}function n(e){var t=self.console[e];return t?function(){for(var r=arguments.length,a=Array(r),n=0;n<r;n++)a[n]=arguments[n];a[0]&&(a[0]=i(e,a[0])),t.apply(self.console,a)}:a}function o(e){for(var t=arguments.length,r=Array(t>1?t-1:0),a=1;a<t;a++)r[a-1]=arguments[a];r.forEach(function(t){u[t]=e[t]?e[t].bind(e):n(t)})}Object.defineProperty(r,"__esModule",{value:!0});var s="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},l={trace:a,debug:a,log:a,warn:a,info:a,error:a},u=l,d=r.enableLogs=function e(t){if(!0===t||"object"===(void 0===t?"undefined":s(t))){o(t,"debug","log","info","warn","error");try{u.log()}catch(e){u=l}}else u=l},f=r.logger=u},{}],47:[function(e,t,r){"use strict";var a={toString:function e(t){for(var r="",a=t.length,i=0;i<a;i++)r+="["+t.start(i).toFixed(3)+","+t.end(i).toFixed(3)+"]";return r}};t.exports=a},{}],48:[function(e,t,r){"use strict";function a(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(r,"__esModule",{value:!0});var i=function(){function e(e,t){for(var r=0;r<t.length;r++){var a=t[r];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}return function(t,r,a){return r&&e(t.prototype,r),a&&e(t,a),t}}(),n=e(46),o=function(){function e(t){a(this,e),t&&t.xhrSetup&&(this.xhrSetup=t.xhrSetup)}return i(e,[{key:"destroy",value:function e(){this.abort(),this.loader=null}},{key:"abort",value:function e(){var t=this.loader;t&&4!==t.readyState&&(this.stats.aborted=!0,t.abort()),window.clearTimeout(this.requestTimeout),this.requestTimeout=null,window.clearTimeout(this.retryTimeout),this.retryTimeout=null}},{key:"load",value:function e(t,r,a){this.context=t,this.config=r,this.callbacks=a,this.stats={trequest:performance.now(),retry:0},this.retryDelay=r.retryDelay,this.loadInternal()}},{key:"loadInternal",value:function e(){var t,r=this.context;t="undefined"!=typeof XDomainRequest?this.loader=new XDomainRequest:this.loader=new XMLHttpRequest;var a=this.stats;a.tfirst=0,a.loaded=0;var i=this.xhrSetup;try{if(i)try{i(t,r.url)}catch(e){t.open("GET",r.url,!0),i(t,r.url)}t.readyState||t.open("GET",r.url,!0)}catch(e){return void this.callbacks.onError({code:t.status,text:e.message},r,t)}r.rangeEnd&&t.setRequestHeader("Range","bytes="+r.rangeStart+"-"+(r.rangeEnd-1)),t.onreadystatechange=this.readystatechange.bind(this),t.onprogress=this.loadprogress.bind(this),t.responseType=r.responseType,this.requestTimeout=window.setTimeout(this.loadtimeout.bind(this),this.config.timeout),t.send()}},{key:"readystatechange",value:function e(t){var r=t.currentTarget,a=r.readyState,i=this.stats,o=this.context,s=this.config;if(!i.aborted&&a>=2)if(window.clearTimeout(this.requestTimeout),0===i.tfirst&&(i.tfirst=Math.max(performance.now(),i.trequest)),4===a){var l=r.status;if(l>=200&&l<300){i.tload=Math.max(i.tfirst,performance.now());var u=void 0,d=void 0;"arraybuffer"===o.responseType?(u=r.response,d=u.byteLength):(u=r.responseText,d=u.length),i.loaded=i.total=d;var f={url:r.responseURL,data:u};this.callbacks.onSuccess(f,i,o,r)}else i.retry>=s.maxRetry||l>=400&&l<499?(n.logger.error(l+" while loading "+o.url),this.callbacks.onError({code:l,text:r.statusText},o,r)):(n.logger.warn(l+" while loading "+o.url+", retrying in "+this.retryDelay+"..."),this.destroy(),this.retryTimeout=window.setTimeout(this.loadInternal.bind(this),this.retryDelay),this.retryDelay=Math.min(2*this.retryDelay,s.maxRetryDelay),i.retry++)}else this.requestTimeout=window.setTimeout(this.loadtimeout.bind(this),s.timeout)}},{key:"loadtimeout",value:function e(){n.logger.warn("timeout while loading "+this.context.url),this.callbacks.onTimeout(this.stats,this.context,null)}},{key:"loadprogress",value:function e(t){var r=t.currentTarget,a=this.stats;a.loaded=t.loaded,t.lengthComputable&&(a.total=t.total);var i=this.callbacks.onProgress;i&&i(a,this.context,null,r)}}]),e}();r.default=o},{46:46}]},{},[35])(35)})},434:function(e,t,r){var a,i=function(){function e(e,t){if(!i[e]){i[e]={};for(var r=0;r<e.length;r++)i[e][e.charAt(r)]=r}return i[e][t]}var t=String.fromCharCode,r="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",a="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+-$",i={},n={compressToBase64:function(e){if(null==e)return"";var t=n._compress(e,6,function(e){return r.charAt(e)});switch(t.length%4){default:case 0:return t;case 1:return t+"===";case 2:return t+"==";case 3:return t+"="}},decompressFromBase64:function(t){return null==t?"":""==t?null:n._decompress(t.length,32,function(a){return e(r,t.charAt(a))})},compressToUTF16:function(e){return null==e?"":n._compress(e,15,function(e){return t(e+32)})+" "},decompressFromUTF16:function(e){return null==e?"":""==e?null:n._decompress(e.length,16384,function(t){return e.charCodeAt(t)-32})},compressToUint8Array:function(e){for(var t=n.compress(e),r=new Uint8Array(2*t.length),a=0,i=t.length;a<i;a++){var o=t.charCodeAt(a);r[2*a]=o>>>8,r[2*a+1]=o%256}return r},decompressFromUint8Array:function(e){if(null===e||void 0===e)return n.decompress(e);for(var r=new Array(e.length/2),a=0,i=r.length;a<i;a++)r[a]=256*e[2*a]+e[2*a+1];var o=[];return r.forEach(function(e){o.push(t(e))}),n.decompress(o.join(""))},compressToEncodedURIComponent:function(e){return null==e?"":n._compress(e,6,function(e){return a.charAt(e)})},decompressFromEncodedURIComponent:function(t){return null==t?"":""==t?null:(t=t.replace(/ /g,"+"),n._decompress(t.length,32,function(r){return e(a,t.charAt(r))}))},compress:function(e){return n._compress(e,16,function(e){return t(e)})},_compress:function(e,t,r){if(null==e)return"";var a,i,n={},o={},s="",l="",u="",d=2,f=3,h=2,c=[],v=0,g=0,p;for(p=0;p<e.length;p+=1)if(s=e.charAt(p),Object.prototype.hasOwnProperty.call(n,s)||(n[s]=f++,o[s]=!0),l=u+s,Object.prototype.hasOwnProperty.call(n,l))u=l;else{if(Object.prototype.hasOwnProperty.call(o,u)){if(u.charCodeAt(0)<256){for(a=0;a<h;a++)v<<=1,g==t-1?(g=0,c.push(r(v)),v=0):g++;for(i=u.charCodeAt(0),a=0;a<8;a++)v=v<<1|1&i,g==t-1?(g=0,c.push(r(v)),v=0):g++,i>>=1}else{for(i=1,a=0;a<h;a++)v=v<<1|i,g==t-1?(g=0,c.push(r(v)),v=0):g++,i=0;for(i=u.charCodeAt(0),a=0;a<16;a++)v=v<<1|1&i,g==t-1?(g=0,c.push(r(v)),v=0):g++,i>>=1}d--,0==d&&(d=Math.pow(2,h),h++),delete o[u]}else for(i=n[u],a=0;a<h;a++)v=v<<1|1&i,g==t-1?(g=0,c.push(r(v)),v=0):g++,i>>=1;d--,0==d&&(d=Math.pow(2,h),h++),n[l]=f++,u=String(s)}if(""!==u){if(Object.prototype.hasOwnProperty.call(o,u)){if(u.charCodeAt(0)<256){for(a=0;a<h;a++)v<<=1,g==t-1?(g=0,c.push(r(v)),v=0):g++;for(i=u.charCodeAt(0),a=0;a<8;a++)v=v<<1|1&i,g==t-1?(g=0,c.push(r(v)),v=0):g++,i>>=1}else{for(i=1,a=0;a<h;a++)v=v<<1|i,g==t-1?(g=0,c.push(r(v)),v=0):g++,i=0;for(i=u.charCodeAt(0),a=0;a<16;a++)v=v<<1|1&i,g==t-1?(g=0,c.push(r(v)),v=0):g++,i>>=1}d--,0==d&&(d=Math.pow(2,h),h++),delete o[u]}else for(i=n[u],a=0;a<h;a++)v=v<<1|1&i,g==t-1?(g=0,c.push(r(v)),v=0):g++,i>>=1;d--,0==d&&(d=Math.pow(2,h),h++)}for(i=2,a=0;a<h;a++)v=v<<1|1&i,g==t-1?(g=0,c.push(r(v)),v=0):g++,i>>=1;for(;;){if(v<<=1,g==t-1){c.push(r(v));break}g++}return c.join("")},decompress:function(e){return null==e?"":""==e?null:n._decompress(e.length,32768,function(t){return e.charCodeAt(t)})},_decompress:function(e,r,a){var i=[],n,o=4,s=4,l=3,u="",d=[],f,h,c,v,g,p,y,m={val:a(0),position:r,index:1};for(f=0;f<3;f+=1)i[f]=f;for(c=0,g=Math.pow(2,2),p=1;p!=g;)v=m.val&m.position,m.position>>=1,0==m.position&&(m.position=r,m.val=a(m.index++)),c|=(v>0?1:0)*p,p<<=1;switch(n=c){case 0:for(c=0,g=Math.pow(2,8),p=1;p!=g;)v=m.val&m.position,m.position>>=1,0==m.position&&(m.position=r,m.val=a(m.index++)),c|=(v>0?1:0)*p,p<<=1;y=t(c);break;case 1:for(c=0,g=Math.pow(2,16),p=1;p!=g;)v=m.val&m.position,m.position>>=1,0==m.position&&(m.position=r,m.val=a(m.index++)),c|=(v>0?1:0)*p,p<<=1;y=t(c);break;case 2:return""}for(i[3]=y,h=y,d.push(y);;){if(m.index>e)return"";for(c=0,g=Math.pow(2,l),p=1;p!=g;)v=m.val&m.position,m.position>>=1,0==m.position&&(m.position=r,m.val=a(m.index++)),c|=(v>0?1:0)*p,p<<=1;switch(y=c){case 0:for(c=0,g=Math.pow(2,8),p=1;p!=g;)v=m.val&m.position,m.position>>=1,0==m.position&&(m.position=r,m.val=a(m.index++)),c|=(v>0?1:0)*p,p<<=1;i[s++]=t(c),y=s-1,o--;break;case 1:for(c=0,g=Math.pow(2,16),p=1;p!=g;)v=m.val&m.position,m.position>>=1,0==m.position&&(m.position=r,m.val=a(m.index++)),c|=(v>0?1:0)*p,p<<=1;i[s++]=t(c),y=s-1,o--;break;case 2:return d.join("")}if(0==o&&(o=Math.pow(2,l),l++),i[y])u=i[y];else{if(y!==s)return null;u=h+h.charAt(0)}d.push(u),i[s++]=h+u.charAt(0),o--,h=u,0==o&&(o=Math.pow(2,l),l++)}}};return n}();void 0!==(a=function(){return i}.call(t,r,t,e))&&(e.exports=a)}});